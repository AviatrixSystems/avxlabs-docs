
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab 4 - Beefing up security &#8212; Aviatrix Flight School</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/lab4';</script>
    <link rel="icon" href="../_static/aviatrix-favicon-32.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab 5 - Infrastructure as Code (Bonus Lab)" href="lab5.html" />
    <link rel="prev" title="Lab 3 - Expanding to multi-cloud" href="lab3.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/aviatrix-logo.png" class="logo__image only-light" alt="Aviatrix Flight School - Home"/>
    <script>document.write(`<img src="../_static/aviatrix-logo.png" class="logo__image only-dark" alt="Aviatrix Flight School - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="home.html">
                    Welcome to Aviatrix Flight School!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lab1.html">Lab 1 - Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">Lab 2 - Office Connectivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">Lab 3 - Expanding to multi-cloud</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab 4 - Beefing up security</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab5.html">Lab 5 - Infrastructure as Code (Bonus Lab)</a></li>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/lab4.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 4 - Beefing up security</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-1-microsegmentation-inter-vpc">Lab 4.1 - Microsegmentation - Inter VPC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validate">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-results">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-2-microsegmentation-intra-vpc">Lab 4.2 - Microsegmentation - Intra VPC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-3-internet-access-aws-shared">Lab 4.3 - Internet access - AWS Shared</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-4-enable-source-nat">Lab 4.4 - Enable Source NAT</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-5-configure-domain-filtering">Lab 4.5 - Configure domain filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-6-configure-url-filtering">Lab 4.6 - Configure URL Filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-7-firenet">Lab 4.7 - Firenet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-8-firewall-logging">Lab 4.8 - Firewall logging</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-9-enable-inspection">Lab 4.9 - Enable inspection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-summary">Lab 4 Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-4-beefing-up-security">
<h1>Lab 4 - Beefing up security<a class="headerlink" href="#lab-4-beefing-up-security" title="Link to this heading">#</a></h1>
<p>Lab time: ~60 minutes</p>
<p><strong><em>Scenario</em></strong>:  FS Corp has just hired a new CISO. They appreciate all the connectivity and guardrails that you have put in place with network segmentation, but their security requirements are more stringent! In this lab, you’re going to beef up the security level using Aviatrix’ security capabilities.</p>
<section id="lab-4-1-microsegmentation-inter-vpc">
<h2>Lab 4.1 - Microsegmentation - Inter VPC<a class="headerlink" href="#lab-4-1-microsegmentation-inter-vpc" title="Link to this heading">#</a></h2>
<section id="description">
<h3>Description<a class="headerlink" href="#description" title="Link to this heading">#</a></h3>
<p>Because of the connection policy between the DMZ and prod, the AWS AppGW is currently able to reach not just the webserver, but also the app and db servers directly. This is undesirable, so the CISO has demanded you apply microsegmentation policies, to only allow specifically required traffic.</p>
</section>
<section id="validate">
<h3>Validate<a class="headerlink" href="#validate" title="Link to this heading">#</a></h3>
<p>We have prepared and installed a microsegmentation policy already. Lets review and modify it.</p>
<ul class="simple">
<li><p>Browse to <strong><em>Security -&gt; Distributed Cloud Firewall -&gt; Rules</em></strong></p></li>
<li><p>Look at the policy to get an understanding of which rules are set up</p></li>
<li><p>Edit the last policy <strong><em>DefaultAllowAll</em></strong> and set enforcement to off and hit save</p></li>
</ul>
<p><img alt="Disable Allow All" src="../_images/lab4-disable-allow-all.png" /><br />
<em>Fig. Disable allow all</em></p>
<p>You should now see that the rule is modified (highlighted in amber).</p>
<ul class="simple">
<li><p>Commit the change by clicking the commit button</p></li>
</ul>
<p><img alt="Commit changes" src="../_images/lab4-commit.png" /><br />
<em>Fig. Commit changes</em></p>
<ul class="simple">
<li><p>Check the connectivity on the web app and Office dashboards</p></li>
</ul>
</section>
<section id="expected-results">
<h3>Expected Results<a class="headerlink" href="#expected-results" title="Link to this heading">#</a></h3>
<p>After enforcing our ruleset as a result of disabling the DefaultAllowAll rule, we should see a change in connectivity. The developer in the office can still access their applications. But the AppGW in the web application can no longer reach the app and db server directly, as seen below.</p>
<p><img alt="Result" src="../_images/lab41-result.png" /><br />
<em>Fig. Result</em></p>
</section>
</section>
<section id="lab-4-2-microsegmentation-intra-vpc">
<h2>Lab 4.2 - Microsegmentation - Intra VPC<a class="headerlink" href="#lab-4-2-microsegmentation-intra-vpc" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>Description<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Now that we have solved the undesired access from the AppGW to the app and db servers, you may have noticed that the web server is still able to directly access the db server. This despite the fact that there is no rule that allows this traffic in our distributed firewall policy. How is this possible?</p>
<p>The rules of the distributed firewall are deployed on the Aviatrix spoke gateways. Blocking traffic from the DMZ to the prod VPC can be enforced, because the traffic is traversing these gateways.
Traffic between the web and db server, remains within the prod VPC however, and does not traverse the spoke gateway, where it can be enforced. Not to fear however, the Aviatrix controller can automatically enforce this microsegmentation by orchestrating the AWS Security Groups for us!</p>
</section>
<section id="id2">
<h3>Validate<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>This feature is enabled on a per VPC basis.</p>
<ul class="simple">
<li><p>Browse to <strong><em>Security -&gt; Distributed Cloud Firewall -&gt; Settings</em></strong></p></li>
<li><p>Click on <strong><em>Manage</em></strong></p></li>
<li><p>Enable the feature on the aws-prod vpc as shown below</p></li>
</ul>
<p><img alt="Result" src="../_images/lab42-enable-intra-vnet-microsegmentation.png" /><br />
<em>Fig. Enable Microsegmentation</em></p>
<ul class="simple">
<li><p>Check the connectivity dashboard for the web app</p></li>
</ul>
</section>
<section id="id3">
<h3>Expected Results<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>After about 2-3 minutes, you should see that the webserver can no longer connect to the db server. The reason this takes a little longer than the previous rules to take effect, is because these changes are made within AWS itself and not on the Aviatrix gateway. You can check the status of the synchronization when you click on <strong><em>Manage</em></strong> again:</p>
<p><img alt="Sync-Status" src="../_images/lab4-nsg-sync-status.png" /><br />
<em>Fig. Sync Status</em></p>
<p>Once this is completed, you should see the microsegmentation reflected in the connectivity status:</p>
<p><img alt="Result" src="../_images/lab42-result.png" /><br />
<em>Fig. Result</em></p>
</section>
</section>
<section id="lab-4-3-internet-access-aws-shared">
<h2>Lab 4.3 - Internet access - AWS Shared<a class="headerlink" href="#lab-4-3-internet-access-aws-shared" title="Link to this heading">#</a></h2>
<section id="id4">
<h3>Description<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>The aws-shared server needs access to the internet to access software updates. We don’t want to enable full access to the internet though. We will be using the Aviatrix egress filtering capability to control the destinations it can reach. We will use a connectivity dashboard on the aws-shared server to monitor the connectivity.</p>
</section>
<section id="id5">
<h3>Validate<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Open the Remote Access Server and open the <strong>RDP - Client</strong> (or navigate to <code class="docutils literal notranslate"><span class="pre">https://client.pod[#].aviatrixlab.com</span></code>). This is the on-prem Host.</p></li>
<li><p>Open up the Firefox browser on the RDP desktop</p></li>
<li><p>Navigate to the egress connectivity dashboard <code class="docutils literal notranslate"><span class="pre">http://aws-shared/egress</span></code></p></li>
</ul>
<blockquote>
<div><p>Does the aws-shared server have access to the internet?</p>
</div></blockquote>
</section>
<section id="id6">
<h3>Expected Results<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<p>As you can see, there is currently no connectivity possible. All egress connections are failing.</p>
<p><img alt="No Internet Access" src="../_images/lab4-no-internet.png" /><br />
<em>Fig. No Internet Access</em></p>
</section>
</section>
<section id="lab-4-4-enable-source-nat">
<h2>Lab 4.4 - Enable Source NAT<a class="headerlink" href="#lab-4-4-enable-source-nat" title="Link to this heading">#</a></h2>
<section id="id7">
<h3>Description<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p>By enabling source NAT on the aws-shared spoke gateway, we provide a path towards the internet through the spoke gateway.</p>
</section>
<section id="id8">
<h3>Validate<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Go to <strong><em>Cloud Fabric -&gt; Gateways -&gt; Spoke Gateways</em></strong> and click on <strong><em>aws-shared</em></strong>.</p></li>
<li><p>Go to the settings pane and under SNAT enable NAT and save the settings.</p></li>
<li><p>Check connectivity on the dashboard again.</p></li>
</ul>
<blockquote>
<div><p>Does the aws-shared server have access to the internet now?</p>
</div></blockquote>
</section>
<section id="id9">
<h3>Expected Results<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>As you can see, all connectivity towards the internet is now allowed. With this setting enabled, the spoke gateway makes a great and cost effective replacement for cloud native NAT gateways.</p>
<p><img alt="Internet Access" src="../_images/lab4-nat-enabled.png" /><br />
<em>Fig. Internet Access</em></p>
</section>
</section>
<section id="lab-4-5-configure-domain-filtering">
<h2>Lab 4.5 - Configure domain filtering<a class="headerlink" href="#lab-4-5-configure-domain-filtering" title="Link to this heading">#</a></h2>
<section id="id10">
<h3>Description<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<p>Now that we have enabled internet access for aws-shared through NAT translation on the spoke gateway, we want to make sure only trusted destinations are accessible. In this lab we will enable domain based filtering.</p>
</section>
<section id="id11">
<h3>Validate<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Browse to <strong><em>Security -&gt; Distributed Cloud Firewall -&gt; WebGroups</em></strong> and check out the pre-configured WebGroup called <strong><em>allowed-web-group</em></strong>.</p></li>
</ul>
<p><img alt="WebGroup" src="../_images/lab4-webgroup.png" /><br />
<em>Fig. WebGroup</em></p>
<blockquote>
<div><p>Which domains are configured in this WebGroup?</p>
</div></blockquote>
<ul class="simple">
<li><p>In the distributed firewalling rules, edit the policy with name <strong><em>aws_shared_web_traffic</em></strong>.</p></li>
<li><p>Under WebGroups, select <strong><em>allowed-web-group</em></strong> and save the rule.</p></li>
</ul>
<p><img alt="Add WebGroup" src="../_images/lab4-add-webgroup.png" /><br />
<em>Fig. Add WebGroup</em></p>
<ul class="simple">
<li><p>Hit the commit button, to apply the change.</p></li>
</ul>
<blockquote>
<div><p>Which domains can the aws-shared server access now? Check on the connectivity dashboard.</p>
</div></blockquote>
</section>
<section id="id12">
<h3>Expected Results<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<p>After applying the changes, you should see that the aws-shared server can only access the desired destinations. All other access to the internet has been blocked.
Only access to Github doesn’t quite work as expected. Let’s fix that in the next lab.</p>
<p><img alt="Domains blocked" src="../_images/lab4-domains-blocked.png" /><br />
<em>Fig. Domains blocked</em></p>
</section>
</section>
<section id="lab-4-6-configure-url-filtering">
<h2>Lab 4.6 - Configure URL Filtering<a class="headerlink" href="#lab-4-6-configure-url-filtering" title="Link to this heading">#</a></h2>
<section id="id13">
<h3>Description<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<p>This scenario is a bit more advanced. We need to allow access to our github repo, but the CISO doesn’t like the idea of opening up connectivity to all of Github. We need to figure out a way to specifically allow a URL.</p>
</section>
<section id="id14">
<h3>Validate<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Browse to <strong><em>Security -&gt; Distributed Cloud Firewall -&gt; WebGroups</em></strong> and check out the pre-configured WebGroup called <strong><em>allowed-web-group</em></strong>.</p></li>
</ul>
<blockquote>
<div><p>What is the URL configured in this WebGroup?</p>
</div></blockquote>
<ul class="simple">
<li><p>In the distributed firewalling rules, edit the policy with name <strong><em>aws_shared_web_traffic</em></strong> again.</p></li>
<li><p>Under WebGroups, add <strong><em>github-url</em></strong>.</p></li>
<li><p>Enable TLS decryption. This is required for the inspection engine to see the full URL in the https request.</p></li>
</ul>
<p><img alt="Add URL filtering" src="../_images/lab4-url-filter-enabled.png" /><br />
<em>Fig. Add URL filtering</em></p>
<ul class="simple">
<li><p>Save the rule and commit the change.</p></li>
</ul>
<blockquote>
<div><p>Which domains can the aws-shared server access now? Check on the connectivity dashboard.</p>
</div></blockquote>
</section>
<section id="id15">
<h3>Expected Results<a class="headerlink" href="#id15" title="Link to this heading">#</a></h3>
<p>We have successfully enabled access to our specific repository, without allowing traffic to other parts of Github.</p>
<p><img alt="URL Filtering working" src="../_images/lab4-url-filter-working.png" /><br />
<em>Fig. URL Filtering working</em></p>
</section>
</section>
<section id="lab-4-7-firenet">
<h2>Lab 4.7 - Firenet<a class="headerlink" href="#lab-4-7-firenet" title="Link to this heading">#</a></h2>
<section id="id16">
<h3>Description<a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<p>As you have been able to see in the previous labs, Aviatrix provides a ton of security features. We haven’t even gone into some of the other security capabilities of the platform, like TLS decryption, IDS and anomaly behavior detection. However, in some scenarios you need an external solution. For example, if all your organisation’s security operations are standardized around a 3rd party NGFW solution, it may be required to implement such a solution in the cloud as well. It can be challenging to implement a virtual appliance like a NGFW in the cloud, as this was never designed from the ground up to be used like this. Aviatrix makes is easy to incorporate such an appliance in the network, and does so in a consistent way across multiple clouds. This feature is called Firenet.</p>
<p>We have already deployed a firewall instance in the lab. In order for Firenet to work properly, we need to tell the controller about it. In this lab you will accomplish this.</p>
</section>
<section id="id17">
<h3>Validate<a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Browse to <strong><em>Security -&gt; Firenet -&gt; Firewall</em></strong> and click on the <strong><em>+</em></strong> sign of the add firewall button.</p></li>
<li><p>Click associate existing firewall.</p></li>
</ul>
<p><img alt="Associate existing firewall" src="../_images/lab4-associate-existing-firewall-add.png" /><br />
<em>Fig. Associate existing firewall</em></p>
<ul class="simple">
<li><p>In the pane that opened, add the configuration as shown on the screenshot. Most information shows up when you click on the pull down menu’s. Note the 6-digit suffix for the <code class="docutils literal notranslate"><span class="pre">resource</span> <span class="pre">group</span></code> and <code class="docutils literal notranslate"><span class="pre">firewall</span> <span class="pre">id</span></code> will be different than the screenshot.</p></li>
</ul>
<p><img alt="Existing firewall configuration" src="../_images/lab4-associate-existing-firewall.png" /><br />
<em>Fig. Existing firewall configuration</em></p>
<ul class="simple">
<li><p>Click Associate</p></li>
</ul>
</section>
<section id="id18">
<h3>Expected Results<a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<p>After a few minutes we should see the firewall in the list with a green status indication:</p>
<p><img alt="Associate firewall result" src="../_images/lab4-associate-firewall-result.png" /><br />
<em>Fig. Associate firewall result</em></p>
</section>
</section>
<section id="lab-4-8-firewall-logging">
<h2>Lab 4.8 - Firewall logging<a class="headerlink" href="#lab-4-8-firewall-logging" title="Link to this heading">#</a></h2>
<section id="id19">
<h3>Description<a class="headerlink" href="#id19" title="Link to this heading">#</a></h3>
<p>View the Firewall Logs</p>
</section>
<section id="id20">
<h3>Validate<a class="headerlink" href="#id20" title="Link to this heading">#</a></h3>
<p>Access the Firewall logs by navigating to:</p>
<p><strong>URL:</strong>  <code class="docutils literal notranslate"><span class="pre">https://fw.pod[x].aviatrixlab.com</span></code></p>
<ul class="simple">
<li><p><em>Remember to replace <span style="color:orange"><strong>[#]</strong></span> with your pod ID</em></p></li>
</ul>
</section>
<section id="id21">
<h3>Expected Results<a class="headerlink" href="#id21" title="Link to this heading">#</a></h3>
<p>Since we have not yet enabled any inspection, the logs should be empty.</p>
<p><img alt="Empty firewall logs" src="../_images/lab1-firewall.png" /><br />
<em>Fig. Empty firewall logs</em></p>
</section>
</section>
<section id="lab-4-9-enable-inspection">
<h2>Lab 4.9 - Enable inspection<a class="headerlink" href="#lab-4-9-enable-inspection" title="Link to this heading">#</a></h2>
<section id="id22">
<h3>Description<a class="headerlink" href="#id22" title="Link to this heading">#</a></h3>
<p>The CISO has put in place a requirement that all traffic from the office needs to be inspected, before it can enter the spoke VPCs. In this lab we will enable inspection for traffic coming from the office VPN connection.</p>
</section>
<section id="id23">
<h3>Validate<a class="headerlink" href="#id23" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Navigate to <strong><em>Security -&gt; Firenet</em></strong> and click on <strong><em>aws-transit-west</em></strong>.</p></li>
<li><p>Browse to the policy tab.</p></li>
<li><p>Under Inspection Policies, select <strong><em>aws-to-office</em></strong> and click <strong><em>Actions -&gt; Add</em></strong></p></li>
</ul>
<p><img alt="Screenshot" src="../_images/lab4-add-firenet-policy.png" /><br />
<em>Fig. Associate an Existing Firewall Instance</em></p>
<ul class="simple">
<li><p>Open the <strong>Firewall Logs</strong> and see whether the traffic is now being routed over the firewall (this may take a few minutes, click the refresh button)</p></li>
<li><p>Firewall logs are available at <code class="docutils literal notranslate"><span class="pre">https://fw.pod[#].aviatrixlab.com</span></code></p></li>
</ul>
</section>
<section id="id24">
<h3>Expected Results<a class="headerlink" href="#id24" title="Link to this heading">#</a></h3>
<p>You should start seeing entries like the screenshot below.</p>
<p><img alt="FW Logs" src="../_images/lab5-fw-logs-azure-dev.png" /><br />
<em>Fig. FW Logs</em></p>
</section>
</section>
<section id="lab-4-summary">
<h2>Lab 4 Summary<a class="headerlink" href="#lab-4-summary" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>You have enabled microsegmentation between VPCs.</p></li>
<li><p>You have enabled microsegmentation within VPCs, to allow for native SG orchestration.</p></li>
<li><p>You have enabled access to the internet in a VPC by using the Aviatrix spoke gateway as a NAT gateway.</p></li>
<li><p>You have added domain based filtering to trusted destinations only.</p></li>
<li><p>You have set up URL based filtering to allow only very specific parts of websites.</p></li>
<li><p>You have integrated a 3rd party NGFW into the network, for even more extensive filtering.</p></li>
<li><p>You have satisfied all the CISO’s requests. Great job!</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lab3.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab 3 - Expanding to multi-cloud</p>
      </div>
    </a>
    <a class="right-next"
       href="lab5.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab 5 - Infrastructure as Code (Bonus Lab)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-1-microsegmentation-inter-vpc">Lab 4.1 - Microsegmentation - Inter VPC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validate">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-results">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-2-microsegmentation-intra-vpc">Lab 4.2 - Microsegmentation - Intra VPC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-3-internet-access-aws-shared">Lab 4.3 - Internet access - AWS Shared</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-4-enable-source-nat">Lab 4.4 - Enable Source NAT</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-5-configure-domain-filtering">Lab 4.5 - Configure domain filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-6-configure-url-filtering">Lab 4.6 - Configure URL Filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-7-firenet">Lab 4.7 - Firenet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-8-firewall-logging">Lab 4.8 - Firewall logging</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-9-enable-inspection">Lab 4.9 - Enable inspection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-4-summary">Lab 4 Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aviatrix Flight School
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>