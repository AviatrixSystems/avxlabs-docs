
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab 2 - Office Connectivity &#8212; Aviatrix ACE Associate</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/lab2';</script>
    <link rel="icon" href="../_static/aviatrix-favicon-32.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab 3 - Expanding to multi-cloud" href="lab3.html" />
    <link rel="prev" title="Lab 1 - Getting Started" href="lab1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/aviatrix-logo.png" class="logo__image only-light" alt="Aviatrix ACE Associate - Home"/>
    <img src="../_static/aviatrix-logo.png" class="logo__image only-dark pst-js-only" alt="Aviatrix ACE Associate - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="home.html">
                    Welcome to ACE Associate Lab
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lab1.html">Lab 1 - Getting Started</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab 2 - Office Connectivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">Lab 3 - Expanding to multi-cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">Lab 4 - Beefing up security</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab5.html">Lab 5 - Infrastructure as Code (Bonus Lab)</a></li>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/lab2.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 2 - Office Connectivity</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-1-connection-to-the-office">Lab 2.1 - Connection to the Office</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validate">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-results">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-2-approve-the-learned-routes">Lab 2.2 - Approve the Learned Routes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-office-connectivity-tests">Lab 2.3 - Office Connectivity Tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-4-verify-the-flow-logs">Lab 2.4 - Verify the Flow Logs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-5-check-office-connectivity">Lab 2.5 - Check office connectivity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-6-enable-network-segmentation">Lab 2.6 - Enable Network Segmentation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-7-create-network-domains">Lab 2.7 - Create Network Domains</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-8-check-office-connectivity">Lab 2.8 - Check office connectivity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-9-create-a-connection-policy">Lab 2.9 - Create a connection policy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-10-check-office-connectivity">Lab 2.10 - Check office connectivity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-11-fix-azure-application">Lab 2.11 - Fix Azure application</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-summary">Lab 2 Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-2-office-connectivity">
<h1>Lab 2 - Office Connectivity<a class="headerlink" href="#lab-2-office-connectivity" title="Link to this heading">#</a></h1>
<p>Lab time: ~45 minutes</p>
<p><strong><em>Scenario</em></strong>:  Your development team needs direct access to the azure-build server in Azure. This requires a VPN connection from the office, into the cloud infrastructure.</p>
<p>During this lab we will build and verify the connectivity to your office.</p>
<figure class="align-center" id="id31">
<a class="reference internal image-reference" href="../_images/lab-2.png"><img alt="../_images/lab-2.png" src="../_images/lab-2.png" style="height: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">Azure Deployment</span><a class="headerlink" href="#id31" title="Link to this image">#</a></p>
</figcaption>
</figure>
<section id="lab-2-1-connection-to-the-office">
<h2>Lab 2.1 - Connection to the Office<a class="headerlink" href="#lab-2-1-connection-to-the-office" title="Link to this heading">#</a></h2>
<section id="description">
<h3>Description<a class="headerlink" href="#description" title="Link to this heading">#</a></h3>
<p>Your on-prem Network team has already configured an IPSec tunnel on the office router, pointing to your Aviatrix Transit Gateway deployed in the Azure Transit VNET. In this lab you will need to configure the tunnel in the Aviatrix Transit Gateway for the tunnel to establish connectivity.</p>
</section>
<section id="validate">
<h3>Validate<a class="headerlink" href="#validate" title="Link to this heading">#</a></h3>
<p>In order to connect your Multicloud environment to the office, we will create an <strong><em>External Connection</em></strong>. This allows you to create a secure connectivity between the Cloud and the office with dynamic routing (BGP).</p>
<p>Now let’s add the office connection. In Copilot, navigate to <strong><em>Networking –&gt; Connectivity –&gt; External Connections (S2C)</em></strong>. Click the <strong><code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">External</span> <span class="pre">Connection</span> <span class="pre">To</span></code></strong> button to add a new connection. Afterwards, select the <code class="docutils literal notranslate"><span class="pre">&quot;External</span> <span class="pre">Device&quot;</span></code> option from the drop-down window.</p>
<figure class="align-center" id="id32">
<a class="reference internal image-reference" href="../_images/lab-2-ext.png"><img alt="../_images/lab-2-ext.png" src="../_images/lab-2-ext.png" style="height: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">External Device connection</span><a class="headerlink" href="#id32" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Name</strong></p></td>
<td><p>azure-to-office</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Connect Using</strong></p></td>
<td><p>BGP</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Type</strong></p></td>
<td><p>IPSec</p></td>
</tr>
<tr class="row-even"><td><p><strong>Local Gateway</strong></p></td>
<td><p>azure-transit</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Local ASN</strong></p></td>
<td><p>65pod[#] <em>For Pods 1-9, double pad the pod# with an additional 0 (ie. 65004). For Pods 10-99 single pad (ie. 65010). For Pods &gt; 100, no padding is needed (ie. 65100)</em></p></td>
</tr>
<tr class="row-even"><td><p><strong>Remote Gateway IP</strong></p></td>
<td><p><ip-address> <em>Please open a terminal session from your own pc and resolve the following FQDN to its IP address <code class="docutils literal notranslate"><span class="pre">onprem.pod[#].aviatrixlab.com</span></code>. Do NOT enter the FQDN on this field. Instead enter the IP address</em></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Remote ASN</strong></p></td>
<td><p>65000</p></td>
</tr>
<tr class="row-even"><td><p><strong>Local Tunnel IP</strong></p></td>
<td><p>169.254.100.2/30</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Remote Tunnel IP</strong></p></td>
<td><p>169.254.100.1/30</p></td>
</tr>
<tr class="row-even"><td><p><strong>Pre-shared Key</strong></p></td>
<td><p>mapleleafs</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>It should look something like the example below. Make sure to put in your own remote gateway IP and AS number.</p>
<figure class="align-center" id="id33">
<img alt="../_images/lab2-pod.png" src="../_images/lab2-pod.png" />
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Resolve the symbolic name with the “host” command</span><a class="headerlink" href="#id33" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For Linux/Mac you can use the <code class="docutils literal notranslate"><span class="pre">&quot;host&quot;</span></code> command.</p>
<p>For Windows you can use the <code class="docutils literal notranslate"><span class="pre">&quot;nslookup&quot;</span></code> command.</p>
</div>
<figure class="align-center" id="id34">
<img alt="../_images/lab2-configure-ipsec.png" src="../_images/lab2-configure-ipsec.png" />
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">Configure BGPoverIPsec</span><a class="headerlink" href="#id34" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Hit <strong><em>Save</em></strong> to execute the changes.</p></li>
</ul>
<p>After 1-2 minutes, you should see that the connection to the office is configured and up (green).</p>
<figure class="align-center" id="id35">
<a class="reference internal image-reference" href="../_images/lab2-tunnel-up.png"><img alt="../_images/lab2-tunnel-up.png" src="../_images/lab2-tunnel-up.png" style="height: 200px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Tunnel up</span><a class="headerlink" href="#id35" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In order to test connectivity between cloud and the office, a test VM is available in the office with the FQDN <code class="docutils literal notranslate"><span class="pre">client-int.pod[#].aviatrixlab.com</span></code>. The IPSec tunnel is up, but maybe there is another blocker that prevents connectivity. Try the following test:</p>
<ul class="simple">
<li><p>From CoPilot, navigate to <strong><em>Diagnostics–&gt;Diagnostic Tools</em></strong></p></li>
<li><p>Click on <code class="docutils literal notranslate"><span class="pre">Gateway</span> <span class="pre">Instance</span></code> drop-down and select the <strong><em>azure-transit</em></strong> node.</p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Ping</span></code> in the vertical tabs and enter the hostname <code class="docutils literal notranslate"><span class="pre">client-int.pod[#].aviatrixlab.com</span></code> in the <code class="docutils literal notranslate"><span class="pre">Destination</span> <span class="pre">(IP</span> <span class="pre">/</span> <span class="pre">Host</span> <span class="pre">Name)</span></code> box. Then, click the <strong><code class="docutils literal notranslate"><span class="pre">Run</span></code></strong> button in the upper-right.</p></li>
</ul>
<figure class="align-center" id="id36">
<a class="reference internal image-reference" href="../_images/lab2-onprem-ping.png"><img alt="../_images/lab2-onprem-ping.png" src="../_images/lab2-onprem-ping.png" style="height: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Diagnostic Tools</span><a class="headerlink" href="#id36" title="Link to this image">#</a></p>
</figcaption>
</figure>
<blockquote>
<div><p>Was the ping successful?</p>
</div></blockquote>
</section>
<section id="expected-results">
<h3>Expected Results<a class="headerlink" href="#expected-results" title="Link to this heading">#</a></h3>
<p>The Site2Cloud connection should be green and the BGP session should be established.  Still, connectivity tests should fail due to the route filtering on the transit which we will fix in the next step.</p>
<p>Our lab environment now looks like this:</p>
<figure class="align-center" id="id37">
<a class="reference internal image-reference" href="../_images/lab2-topology1.png"><img alt="../_images/lab2-topology1.png" src="../_images/lab2-topology1.png" style="height: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 22 </span><span class="caption-text">Topology with On-Prem Connectivity</span><a class="headerlink" href="#id37" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="lab-2-2-approve-the-learned-routes">
<h2>Lab 2.2 - Approve the Learned Routes<a class="headerlink" href="#lab-2-2-approve-the-learned-routes" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>Description<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Aviatrix allows you to filter dynamically learned routes from external sites, and the azure-transit Gateway deployed in this lab has <strong>Route Approval</strong> enabled.  We want to approve the summarized route learned from on-prem.</p>
</section>
<section id="id2">
<h3>Validate<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Browse to the transit gateway settings in Copilot, under <strong><em>Cloud Fabric -&gt; Gateways -&gt; Transit Gateways</em></strong> and click on <strong><em>azure-transit</em></strong>.</p></li>
</ul>
<figure class="align-center" id="id38">
<a class="reference internal image-reference" href="../_images/lab2-transitclick.png"><img alt="../_images/lab2-transitclick.png" src="../_images/lab2-transitclick.png" style="height: 200px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 23 </span><span class="caption-text">azure-transit</span><a class="headerlink" href="#id38" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Navigate to the <strong>Approval</strong> tab and approve the pending CIDR.</p></li>
</ul>
<p>If no CIDR’s are showing up here, validate that the BGP peering has established under <strong><em>Troubleshoot -&gt; Cloud Routes -&gt; BGP Info</em></strong>. If the peering is down, you likely made a configuration error.</p>
<figure class="align-center" id="id39">
<a class="reference internal image-reference" href="../_images/lab2-route-approval-2.png"><img alt="../_images/lab2-route-approval-2.png" src="../_images/lab2-route-approval-2.png" style="height: 200px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 24 </span><span class="caption-text">Approve route</span><a class="headerlink" href="#id39" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id40">
<a class="reference internal image-reference" href="../_images/lab2-approve.png"><img alt="../_images/lab2-approve.png" src="../_images/lab2-approve.png" style="height: 200px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">Successful update</span><a class="headerlink" href="#id40" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Back to <strong><em>Diagnostics–&gt;Diagnostic Tools</em></strong></p></li>
<li><p>Click on <code class="docutils literal notranslate"><span class="pre">Gateway</span> <span class="pre">Instance</span></code> drop-down and again select the <strong><em>azure-transit</em></strong> node.</p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Ping</span></code> in the vertical tabs and enter the hostname <code class="docutils literal notranslate"><span class="pre">client-int.pod[#].aviatrixlab.com</span></code> in the <code class="docutils literal notranslate"><span class="pre">Destination</span> <span class="pre">(IP</span> <span class="pre">/</span> <span class="pre">Host</span> <span class="pre">Name)</span></code> box. Again, click the <strong><code class="docutils literal notranslate"><span class="pre">Run</span></code></strong> button in the upper-right.</p></li>
</ul>
<blockquote>
<div><p>Was the ping successful this time?</p>
</div></blockquote>
</section>
<section id="id3">
<h3>Expected Results<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>After adding the connection to on-prem and approving the learned routes, the connectivity tests should be successful. The process of route approval allows you to be in charge of the learned routes!</p>
</section>
</section>
<section id="lab-2-3-office-connectivity-tests">
<h2>Lab 2.3 - Office Connectivity Tests<a class="headerlink" href="#lab-2-3-office-connectivity-tests" title="Link to this heading">#</a></h2>
<section id="id4">
<h3>Description<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>At this point, the office is connected to the Aviatrix Transit Gateway in Azure. This should provide the developers with connectivity to the azure-build server.</p>
</section>
<section id="id5">
<h3>Validate<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Open the Remote Access Server and open the <strong>RDP - Client</strong> (or navigate to <code class="docutils literal notranslate"><span class="pre">https://client.pod[#].aviatrixlab.com</span></code>). This is the on-prem Host.</p></li>
<li><p>Open up the <code class="docutils literal notranslate"><span class="pre">Min</span></code> browser on the RDP desktop</p></li>
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">http://azure-build.pod[#].aviatrixlab.com</span></code> or just <code class="docutils literal notranslate"><span class="pre">http://azure-build</span></code></p></li>
</ul>
</section>
<section id="id6">
<h3>Expected Results<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>You should see something similar to the following screenshot. Note you’re connecting across the site2cloud connection to the dmz spoke via the transit gateway.</p></li>
<li><p>Remember the <strong>source port</strong> for the next exercise</p></li>
</ul>
<figure class="align-center" id="id41">
<a class="reference internal image-reference" href="../_images/lab2-priv-conn-test.png"><img alt="../_images/lab2-priv-conn-test.png" src="../_images/lab2-priv-conn-test.png" style="height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 26 </span><span class="caption-text"><a class="reference external" href="http://azure-build">http://azure-build</a></span><a class="headerlink" href="#id41" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="lab-2-4-verify-the-flow-logs">
<h2>Lab 2.4 - Verify the Flow Logs<a class="headerlink" href="#lab-2-4-verify-the-flow-logs" title="Link to this heading">#</a></h2>
<section id="id7">
<h3>Description<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p>CoPilot provides very rich visibility into all traffic going across the Aviatrix overlay network.  Once you generate some traffic, this should be visible in CoPilot.</p>
</section>
<section id="id8">
<h3>Validate<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Open <strong>CoPilot</strong> -&gt; <strong>Monitor</strong> -&gt; <strong>FlowIQ</strong> and click <strong>Last 60 Minutes</strong> to update the Date Range Filters</p></li>
<li><p>Using the source port from the previous lab, let’s create the following filter:</p>
<ul>
<li><p>Click on the “+” button inside the <strong>Filters</strong> box.</p></li>
</ul>
</li>
<li><p>Under <strong>Matches all conditions (AND)</strong>, select the metric <strong>Source Port</strong>.</p>
<ul>
<li><p>Select <strong>equals</strong></p></li>
<li><p>Then, enter the source port from the website of the previous exercise and hit <strong><em>Apply</em></strong>. The Overview immediately filters to your criteria.</p></li>
</ul>
</li>
</ul>
<blockquote>
<div><p>New flow records might appear 1-2 minutes after they occurred, so just click on <strong>Refresh Data</strong> a few times to refresh the time period</p>
</div></blockquote>
<figure class="align-center" id="id42">
<a class="reference internal image-reference" href="../_images/lab2-flowiq-filter.png"><img alt="../_images/lab2-flowiq-filter.png" src="../_images/lab2-flowiq-filter.png" style="height: 200px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 27 </span><span class="caption-text">FlowIQ Filter</span><a class="headerlink" href="#id42" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="id9">
<h3>Expected Results<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>By filtering on the source port, you should be able to see all of the details behind the traffic generated from on-prem.</p></li>
</ul>
<figure class="align-center" id="id43">
<a class="reference internal image-reference" href="../_images/lab2-flowiq-overview.png"><img alt="../_images/lab2-flowiq-overview.png" src="../_images/lab2-flowiq-overview.png" style="height: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 28 </span><span class="caption-text">FlowIQ Overview</span><a class="headerlink" href="#id43" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>By clicking on the <strong>Records</strong> tab, you will see the raw flow records</p></li>
<li><p>The most relevant fields are shown by default, but you can create custom views and show additional metadata relating to the traffic flows</p></li>
</ul>
<figure class="align-center" id="id44">
<a class="reference internal image-reference" href="../_images/lab2-flowiq-records.png"><img alt="../_images/lab2-flowiq-records.png" src="../_images/lab2-flowiq-records.png" style="height: 200px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 29 </span><span class="caption-text">FlowIQ Records</span><a class="headerlink" href="#id44" title="Link to this image">#</a></p>
</figcaption>
</figure>
<blockquote>
<div><p><strong>Note</strong> - Gateway and Interface Names show up after a specific polling interval.  If the Gateway or Spoke Attachment is newly created, the fields will be displayed after the configured CoPilot polling interval (default is one hour)</p>
</div></blockquote>
<ul class="simple">
<li><p>By looking at the flow records, you can trace the path that a flow took and also see over which gateways the flow crossed</p></li>
</ul>
</section>
</section>
<section id="lab-2-5-check-office-connectivity">
<h2>Lab 2.5 - Check office connectivity<a class="headerlink" href="#lab-2-5-check-office-connectivity" title="Link to this heading">#</a></h2>
<section id="id10">
<h3>Description<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<p>While we have achieved our objective of providing the development team with access to the azure-build server, perhaps we have given them more access than desirable. Let’s verify this.</p>
</section>
<section id="id11">
<h3>Validate<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Open the Remote Access Server and open the <strong>RDP - Client</strong> (or navigate to <code class="docutils literal notranslate"><span class="pre">https://client.pod[#].aviatrixlab.com</span></code>). This is the on-prem Host.</p></li>
<li><p>Open up the <code class="docutils literal notranslate"><span class="pre">Min</span></code> browser on the RDP desktop</p></li>
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">http://localhost</span></code></p></li>
</ul>
<blockquote>
<div><p>Do we have access to more destinations than expected?</p>
</div></blockquote>
</section>
<section id="id12">
<h3>Expected Results<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>As you can see, you now have access to all servers in Azure.</p></li>
</ul>
<figure class="align-center" id="id45">
<img alt="../_images/lab2-full-access.png" src="../_images/lab2-full-access.png" />
<figcaption>
<p><span class="caption-number">Fig. 30 </span><span class="caption-text">Full Access</span><a class="headerlink" href="#id45" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="lab-2-6-enable-network-segmentation">
<h2>Lab 2.6 - Enable Network Segmentation<a class="headerlink" href="#lab-2-6-enable-network-segmentation" title="Link to this heading">#</a></h2>
<section id="id13">
<h3>Description<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<p>Now that we have established, that too much network access to the Azure environment has been granted to the development team, let’s limit the exposure and reduce the security risks.</p>
</section>
<section id="id14">
<h3>Validate<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>In the Copilot, go to <strong><em>Networking -&gt; Network Segmentation -&gt; Network Domains</em></strong>. and click the <code class="docutils literal notranslate"><span class="pre">Transit</span> <span class="pre">Gateways</span></code> button.</p></li>
<li><p>In the transit gateway pane, enable segmentation for azure-transit and then click on <strong>Save</strong>.</p></li>
</ul>
<figure class="align-center" id="id46">
<img alt="../_images/lab2-enable-segmentation.png" src="../_images/lab2-enable-segmentation.png" />
<figcaption>
<p><span class="caption-number">Fig. 31 </span><span class="caption-text">Transit Segmentation</span><a class="headerlink" href="#id46" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id47">
<img alt="../_images/lab2-enable-segmentation-2.png" src="../_images/lab2-enable-segmentation-2.png" />
<figcaption>
<p><span class="caption-number">Fig. 32 </span><span class="caption-text">Enable Segmentation</span><a class="headerlink" href="#id47" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="id15">
<h3>Expected Results<a class="headerlink" href="#id15" title="Link to this heading">#</a></h3>
<p>Now that segmentation is enabled on azure-transit, we can continue and build out Network Domains.</p>
</section>
</section>
<section id="lab-2-7-create-network-domains">
<h2>Lab 2.7 - Create Network Domains<a class="headerlink" href="#lab-2-7-create-network-domains" title="Link to this heading">#</a></h2>
<section id="id16">
<h3>Description<a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<p>Let’s create some network domains, which can be used for segmentation.</p>
</section>
<section id="id17">
<h3>Validate<a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<p>In CoPilot, go to <strong><em>Networking -&gt; Network Segmentation -&gt; Network Domains</em></strong>. As you can see, we don’t have any network domains set up currently. Use the <strong><em>+ Network Domains</em></strong> button to add the following domains and associations:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Domain</p></th>
<th class="head text-left"><p>Association</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Office</p></td>
<td class="text-left"><p>azure-to-office</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Azure-Build</p></td>
<td class="text-left"><p>azure-build</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Azure-Prod</p></td>
<td class="text-left"><p>azure-prod</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Azure-DMZ</p></td>
<td class="text-left"><p>azure-dmz</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id48">
<a class="reference internal image-reference" href="../_images/lab2-add-network-domains.png"><img alt="../_images/lab2-add-network-domains.png" src="../_images/lab2-add-network-domains.png" style="height: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 33 </span><span class="caption-text">Add network domains</span><a class="headerlink" href="#id48" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="id18">
<h3>Expected Results<a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<p>After adding the network domains and associations, you should see the following in Copilot:</p>
<figure class="align-center" id="id49">
<img alt="../_images/lab2-network-domains-result.png" src="../_images/lab2-network-domains-result.png" />
<figcaption>
<p><span class="caption-number">Fig. 34 </span><span class="caption-text">Network domains result</span><a class="headerlink" href="#id49" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="lab-2-8-check-office-connectivity">
<h2>Lab 2.8 - Check office connectivity<a class="headerlink" href="#lab-2-8-check-office-connectivity" title="Link to this heading">#</a></h2>
<section id="id19">
<h3>Description<a class="headerlink" href="#id19" title="Link to this heading">#</a></h3>
<p>Now that we have implemented network segmentation, let’s verify that we have limited the connectivity for developers in the office.</p>
</section>
<section id="id20">
<h3>Validate<a class="headerlink" href="#id20" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Go back to the Office connectivity dashboard and check the connectivity status.</p></li>
</ul>
<blockquote>
<div><p>Were these connections successful?</p>
</div></blockquote>
</section>
<section id="id21">
<h3>Expected Results<a class="headerlink" href="#id21" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>None of the connections should succeed. We have successfully limited developer access to Azure, but now we have lost access to the build server as well!</p></li>
</ul>
<figure class="align-center" id="id50">
<img alt="../_images/lab1-connectivity-from-office.png" src="../_images/lab1-connectivity-from-office.png" />
<figcaption>
<p><span class="caption-number">Fig. 35 </span><span class="caption-text">Office connectivity</span><a class="headerlink" href="#id50" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="lab-2-9-create-a-connection-policy">
<h2>Lab 2.9 - Create a connection policy<a class="headerlink" href="#lab-2-9-create-a-connection-policy" title="Link to this heading">#</a></h2>
<section id="id22">
<h3>Description<a class="headerlink" href="#id22" title="Link to this heading">#</a></h3>
<p>In order for our developers to be able to access the build server again, we need to create a connection policy, that allows traffic between the Office network domain and the Azure-Build network domain. In addition, the build server needs access to the azure-web and azure-app server. So we’re going to need a connection policy for that as well!</p>
</section>
<section id="id23">
<h3>Validate<a class="headerlink" href="#id23" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Edit the <strong><em>Azure-Build</em></strong> network domain under <strong><em>Networking -&gt; Network Segmentation -&gt; Network Domains</em></strong> in Copilot.</p></li>
</ul>
<figure class="align-center" id="id51">
<a class="reference internal image-reference" href="../_images/lab2-edit-network-domain.png"><img alt="../_images/lab2-edit-network-domain.png" src="../_images/lab2-edit-network-domain.png" style="height: 200px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 36 </span><span class="caption-text">Edit network domain</span><a class="headerlink" href="#id51" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Now add the <strong><em>Office</em></strong> and <strong><em>Azure-Prod</em></strong> domain as a connected domain.</p></li>
</ul>
<figure class="align-center" id="id52">
<img alt="../_images/lab2-add-connected-network-domain.png" src="../_images/lab2-add-connected-network-domain.png" />
<figcaption>
<p><span class="caption-number">Fig. 37 </span><span class="caption-text">Add network domain connection</span><a class="headerlink" href="#id52" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="id24">
<h3>Expected Results<a class="headerlink" href="#id24" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The network domains should now be connected to each other, as shown on the screenshot below.</p></li>
<li><p>Another great place to visualize the connectivity between network domains is <strong><em>Networking -&gt; Network Segmentation-&gt; Overview</em></strong>.</p></li>
</ul>
<figure class="align-center" id="id53">
<img alt="../_images/lab2-add-connected-network-domain-result.png" src="../_images/lab2-add-connected-network-domain-result.png" />
<figcaption>
<p><span class="caption-number">Fig. 38 </span><span class="caption-text">Add Network domain connection</span><a class="headerlink" href="#id53" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id54">
<a class="reference internal image-reference" href="../_images/lab2-network-domain-overview.png"><img alt="../_images/lab2-network-domain-overview.png" src="../_images/lab2-network-domain-overview.png" style="height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 39 </span><span class="caption-text">Network domain overview</span><a class="headerlink" href="#id54" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="lab-2-10-check-office-connectivity">
<h2>Lab 2.10 - Check office connectivity<a class="headerlink" href="#lab-2-10-check-office-connectivity" title="Link to this heading">#</a></h2>
<section id="id25">
<h3>Description<a class="headerlink" href="#id25" title="Link to this heading">#</a></h3>
<p>Now that we have implemented the connectivity policies, let’s verify that we have limited the connectivity for developers in the office.</p>
</section>
<section id="id26">
<h3>Validate<a class="headerlink" href="#id26" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Go back to the Office connectivity dashboard and check the connectivity status.</p></li>
</ul>
<blockquote>
<div><p>Were these connections successful?</p>
</div></blockquote>
</section>
<section id="id27">
<h3>Expected Results<a class="headerlink" href="#id27" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The developers in the office now should only have access to the build server!</p></li>
</ul>
<figure class="align-center" id="id55">
<img alt="../_images/lab2-access-to-build-only.png" src="../_images/lab2-access-to-build-only.png" />
<figcaption>
<p><span class="caption-number">Fig. 40 </span><span class="caption-text">Office connectivity</span><a class="headerlink" href="#id55" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="lab-2-11-fix-azure-application">
<h2>Lab 2.11 - Fix Azure application<a class="headerlink" href="#lab-2-11-fix-azure-application" title="Link to this heading">#</a></h2>
<section id="id28">
<h3>Description<a class="headerlink" href="#id28" title="Link to this heading">#</a></h3>
<p>Now that we have enabled segmentation, we have not only limited connectivity from the office to Azure, but also between the network domains inside Azure. Since the application in Azure is dependent on connectivity between the DMZ and Prod VNET’s, we need to fix this.</p>
</section>
<section id="id29">
<h3>Validate<a class="headerlink" href="#id29" title="Link to this heading">#</a></h3>
<p>First check that the connectivity is indeed broken.</p>
<ul class="simple">
<li><p>Log on to the Remote Access Server and connect to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">http://azure-lb.pod[#].aviatrixlab.com/test</span></code></p></li>
</ul>
</li>
</ul>
<p>As you can see, the Web web application is now broken:</p>
<figure class="align-center" id="id56">
<img alt="../_images/lab2-app-connectivity-broken.png" src="../_images/lab2-app-connectivity-broken.png" />
<figcaption>
<p><span class="caption-number">Fig. 41 </span><span class="caption-text">Office connectivity</span><a class="headerlink" href="#id56" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Check the connection policies on the <strong><em>Networking -&gt; Network Segmentation-&gt; Overview</em></strong> page.</p></li>
</ul>
<p>Do you see a line connecting Azure-DMZ and Azure-Prod?</p>
<ul class="simple">
<li><p>Create a connection policy between <strong>Azure-DMZ</strong> and <strong>Azure-Prod</strong>, similar to what you did in lab 2.9.</p></li>
</ul>
<figure class="align-center" id="id57">
<img alt="../_images/lab2-add-connected-network-domain-2.png" src="../_images/lab2-add-connected-network-domain-2.png" />
<figcaption>
<p><span class="caption-number">Fig. 42 </span><span class="caption-text">Add connection policy</span><a class="headerlink" href="#id57" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Check that the connectivity is restored.</p>
<figure class="align-center" id="id58">
<img alt="../_images/lab1-connectivity-3tier-app.png" src="../_images/lab1-connectivity-3tier-app.png" />
<figcaption>
<p><span class="caption-number">Fig. 43 </span><span class="caption-text">Web app connectivity</span><a class="headerlink" href="#id58" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="id30">
<h3>Expected Results<a class="headerlink" href="#id30" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>After setting up the connectivity policy, you should be able to connect to all tiers of the Azure application again.</p></li>
</ul>
</section>
</section>
<section id="lab-2-summary">
<h2>Lab 2 Summary<a class="headerlink" href="#lab-2-summary" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Congratulations - you successfully connected your office to Azure</p></li>
<li><p>Not a single route table entry needed to be touched on the cloud provider side</p></li>
<li><p>You have end to end visibility into all network traffic</p></li>
<li><p>You have limited the scope of connectivity from the office, using network segmentation</p></li>
<li><p>You have reestablished connectivity between the Azure-DMZ and Azure-Prod VNET’s after implementing network segmentation.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lab1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab 1 - Getting Started</p>
      </div>
    </a>
    <a class="right-next"
       href="lab3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab 3 - Expanding to multi-cloud</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-1-connection-to-the-office">Lab 2.1 - Connection to the Office</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validate">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-results">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-2-approve-the-learned-routes">Lab 2.2 - Approve the Learned Routes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-office-connectivity-tests">Lab 2.3 - Office Connectivity Tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-4-verify-the-flow-logs">Lab 2.4 - Verify the Flow Logs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-5-check-office-connectivity">Lab 2.5 - Check office connectivity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-6-enable-network-segmentation">Lab 2.6 - Enable Network Segmentation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-7-create-network-domains">Lab 2.7 - Create Network Domains</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-8-check-office-connectivity">Lab 2.8 - Check office connectivity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-9-create-a-connection-policy">Lab 2.9 - Create a connection policy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-10-check-office-connectivity">Lab 2.10 - Check office connectivity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-11-fix-azure-application">Lab 2.11 - Fix Azure application</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">Validate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">Expected Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-summary">Lab 2 Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aviatrix ACE Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>