
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab-2: Aviatrix Cloud Firewall &#8212; Aviatrix Flight School</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=1d85937c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/lab2';</script>
    <link rel="icon" href="../_static/aviatrix-favicon-32.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab-3: Secure High-Performance Datacenter Edge" href="lab3.html" />
    <link rel="prev" title="Lab-1: Getting Started" href="lab1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Aviatrix_Logo_White_Gradient_RGB.svg" class="logo__image only-light" alt="Aviatrix Flight School - Home"/>
    <script>document.write(`<img src="../_static/Aviatrix_Logo_White_Gradient_RGB.svg" class="logo__image only-dark" alt="Aviatrix Flight School - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="home.html">
                    Welcome to Aviatrix Flight School!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lab1.html">Lab-1: Getting Started</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab-2: Aviatrix Cloud Firewall</a></li>

<li class="toctree-l1"><a class="reference internal" href="lab3.html">Lab-3: Secure High-Performance Datacenter Edge</a></li>

<li class="toctree-l1"><a class="reference internal" href="lab4.html">Lab-4: Observability and Troubleshooting</a></li>

<li class="toctree-l1"><a class="reference internal" href="lab5.html">Lab-5: Infrastructure as Code</a></li>

<li class="toctree-l1"><a class="reference internal" href="lab6.html">Lab-6: <em>(Optional)</em> Future State: Aviatrix Cloud Firewall as the complete connectivity and security platform for your cloud</a></li>

<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/lab2.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab-2: Aviatrix Cloud Firewall</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lab-2: Aviatrix Cloud Firewall</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-1-overview">Lab 2.1 - Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-2-deploying-spoke-gateways">Lab 2.2 - Deploying Spoke Gateways</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-enabling-aviatrix-nat-gateway">Lab 2.3 - Enabling Aviatrix Nat Gateway</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-1-enable-from-the-gateway-settings">Lab 2.3.1 - Enable from the Gateway Settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-2-enable-from-security-egress-section">Lab 2.3.2 - Enable from Security-&gt;Egress section</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-3-enable-via-terraform-as-part-of-ci-cd-pipeline">Lab 2.3.3 - Enable via Terraform as part of CI/CD pipeline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-4-deploy-egress-security">Lab 2.4 - Deploy Egress Security</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-5-security-group-orchestration">Lab 2.5 - Security Group Orchestration</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-lab-2">End of Lab 2</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-2-aviatrix-cloud-firewall">
<h1>Lab-2: Aviatrix Cloud Firewall<a class="headerlink" href="#lab-2-aviatrix-cloud-firewall" title="Link to this heading">#</a></h1>
<section id="lab-2-1-overview">
<h2>Lab 2.1 - Overview<a class="headerlink" href="#lab-2-1-overview" title="Link to this heading">#</a></h2>
<p>In this lab, we will focus on the Islands VPCs in the AWS deployment. Egress-VPC1 and Egress-VPC2. Egress-VPC3 will be excluded from this section, but we will re-visit in the last lab with infrastructure as a code coverage while discovering the terraform capabilities.</p>
<p>The logical topology is shown as below, where we have 3 Island  VPCs with Gatus Servers which are reaching out to internet via NAT Gateway without any egress filtering with native capabilities.</p>
<figure class="align-center" id="id1">
<img alt="../_images/15.png" src="../_images/15.png" />
<figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text">Lab Overview</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>We will be working on the VPCs shown below in this hands-on lab.</p>
<figure class="align-center" id="id2">
<img alt="../_images/21.png" src="../_images/21.png" />
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">VPC List</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The topology below will be visible after filtering with “unmanaged” button is toggled, as there are no Aviatrix gateways deployed in these VPCs, they are marked as unmanaged in the topology, once we start deploying the gateways they will be moved  to “managed” section.</p>
<figure class="align-center" id="id3">
<img alt="../_images/31.png" src="../_images/31.png" />
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Topology</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The VMs are the ones generating internet traffic, and our Aviatrix Nat Gateways  will control their egress traffic.</p>
<figure class="align-center" id="id4">
<img alt="../_images/41.png" src="../_images/41.png" />
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Testing Virtual Machines</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="lab-2-2-deploying-spoke-gateways">
<h2>Lab 2.2 - Deploying Spoke Gateways<a class="headerlink" href="#lab-2-2-deploying-spoke-gateways" title="Link to this heading">#</a></h2>
<p>Now we will enable Aviatrix to replace CSP-native NAT  Gateways for egress and after that we will secure the Island VPC.
Go to <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric</span> <span class="pre">-&gt;</span> <span class="pre">Gateways</span></code> and select <code class="docutils literal notranslate"><span class="pre">Spoke</span> <span class="pre">Gateways</span></code>. As there are no Spoke Gateways deployed, that page will look empty.</p>
<figure class="align-center" id="id5">
<img alt="../_images/51.png" src="../_images/51.png" />
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">Aviatrix Spoke Gateway Configuration Page</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Select <code class="docutils literal notranslate"><span class="pre">+Spoke</span> <span class="pre">Gateway</span></code> to deploy a new Aviatrix gateway. The required information to deploy the gateway can be collected from Cloud Assets section, as shown before. That already includes the Cloud, Region, and Availability Zone.</p>
<figure class="align-center" id="id6">
<img alt="../_images/61.png" src="../_images/61.png" />
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Creating Aviatrix Spoke Gateway</span><a class="headerlink" href="#id6" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>Egress-VPC1-GW</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Cloud</strong></p></td>
<td class="text-left"><p>AWS Standard</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Account</strong></p></td>
<td class="text-left"><p>aws-account</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Region</strong></p></td>
<td class="text-left"><p>eu-west-2 (London)</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>VPC/Vnet</strong></p></td>
<td class="text-left"><p>egress-vpc-1</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Instance Size</strong></p></td>
<td class="text-left"><p>t3.medium</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Attach to Subnet</strong></p></td>
<td class="text-left"><p>egress-vpc-1-public-eu-west-2a</p></td>
</tr>
</tbody>
</table>
</div>
<p>Aviatrix Spoke Gateway deployment progress can be monitored in the notifications section.</p>
<figure class="align-center" id="id7">
<img alt="../_images/71.png" src="../_images/71.png" />
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Aviatrix Gateway Creation Process</span><a class="headerlink" href="#id7" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>After clicking <code class="docutils literal notranslate"><span class="pre">Show</span> <span class="pre">All</span> <span class="pre">Active</span> <span class="pre">Operations</span></code> button, it will load the                  	    <code class="docutils literal notranslate"><span class="pre">Monitor-&gt;Notifications-&gt;Tasks-&gt;Active</span> <span class="pre">Gateway</span> <span class="pre">Operations</span></code> page. After clicking the <code class="docutils literal notranslate"><span class="pre">View</span> <span class="pre">Details</span></code> button page progress details can be seen.</p>
<figure class="align-center" id="id8">
<img alt="../_images/81.png" src="../_images/81.png" />
<figcaption>
<p><span class="caption-number">Fig. 22 </span><span class="caption-text">Aviatrix Gateway Creation Process</span><a class="headerlink" href="#id8" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Once the deployment is completed, it can be validated as shown below:</p>
<figure class="align-center" id="id9">
<img alt="../_images/91.png" src="../_images/91.png" />
<figcaption>
<p><span class="caption-number">Fig. 23 </span><span class="caption-text">Aviatrix Spoke Gateway</span><a class="headerlink" href="#id9" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>At this point we can also see the change occurred on Topology Map where our gateway in Egress-VPC-1 is visible, together with the Gatus-1 VM.</p>
<figure class="align-center" id="id10">
<img alt="../_images/101.png" src="../_images/101.png" />
<figcaption>
<p><span class="caption-number">Fig. 24 </span><span class="caption-text">Topology View</span><a class="headerlink" href="#id10" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Even though the Aviatrix Spoke Gateway is deployed, it won’t automatically replace the existing deployment, so this will be a hitless and controlled deployment. As you can see below, the VPC Route Table for private table on Availability zone 2b is still forwarding the traffic to Nat Gateway</p>
<figure class="align-center" id="id11">
<img alt="../_images/111.png" src="../_images/111.png" />
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">Checking VPC Route Table with Aviatrix Spoke Gateway</span><a class="headerlink" href="#id11" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id12">
<img alt="../_images/121.png" src="../_images/121.png" />
<figcaption>
<p><span class="caption-number">Fig. 26 </span><span class="caption-text">Checking VPC Route Table with AWS Console</span><a class="headerlink" href="#id12" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now repeat the same task above for deploying the second Aviatrix Spoke Gateway.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>Egress-VPC2-GW</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Cloud</strong></p></td>
<td class="text-left"><p>AWS Standard</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Account</strong></p></td>
<td class="text-left"><p>aws-account</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Region</strong></p></td>
<td class="text-left"><p>eu-west-2 (London)</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>VPC/Vnet</strong></p></td>
<td class="text-left"><p>egress-vpc-2</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Instance Size</strong></p></td>
<td class="text-left"><p>t3.medium</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Attach to Subnet</strong></p></td>
<td class="text-left"><p>egress-vpc-2-public-eu-west-2a</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id13">
<img alt="../_images/12_1.png" src="../_images/12_1.png" />
<figcaption>
<p><span class="caption-number">Fig. 27 </span><span class="caption-text">Aviatrix Gateway Creation Process</span><a class="headerlink" href="#id13" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Once the Aviatrix Gateway deployment finishes, you can check the VPC/VNET route table and see the private route table points to CSP NAT Gateway.</p>
<figure class="align-center" id="id14">
<img alt="../_images/12_2.png" src="../_images/12_2.png" />
<figcaption>
<p><span class="caption-number">Fig. 28 </span><span class="caption-text">Checking VPC Route Table with Aviatrix Spoke Gateway</span><a class="headerlink" href="#id14" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="lab-2-3-enabling-aviatrix-nat-gateway">
<h2>Lab 2.3 - Enabling Aviatrix Nat Gateway<a class="headerlink" href="#lab-2-3-enabling-aviatrix-nat-gateway" title="Link to this heading">#</a></h2>
<p>There are 3 ways to enable Aviatrix Nat Gateway.</p>
<ul class="simple">
<li><p>Enable from the Gateway Settings</p></li>
<li><p>Enable from Security-&gt;Egress section</p></li>
<li><p>Enable via Terraform as part of CI/CD pipeline</p></li>
</ul>
</section>
<section id="lab-2-3-1-enable-from-the-gateway-settings">
<h2>Lab 2.3.1 - Enable from the Gateway Settings<a class="headerlink" href="#lab-2-3-1-enable-from-the-gateway-settings" title="Link to this heading">#</a></h2>
<p>Go to the <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric</span> <span class="pre">-&gt;</span> <span class="pre">Gateways</span> <span class="pre">-&gt;</span> <span class="pre">Spoke</span> <span class="pre">Gateways</span></code> and choose the <code class="docutils literal notranslate"><span class="pre">Egress-VPC1-GW</span></code> from the list and click <code class="docutils literal notranslate"><span class="pre">Settings</span></code> of the <code class="docutils literal notranslate"><span class="pre">Spoke</span> <span class="pre">Gateway</span></code>. Then enable Network Address Translation <code class="docutils literal notranslate"><span class="pre">Source</span> <span class="pre">Nat</span></code> and <code class="docutils literal notranslate"><span class="pre">Save</span></code>.</p>
<figure class="align-center" id="id15">
<img alt="../_images/131.png" src="../_images/131.png" />
<figcaption>
<p><span class="caption-number">Fig. 29 </span><span class="caption-text">Aviatrix Spoke Gateway Settings</span><a class="headerlink" href="#id15" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Route Table change can be validated directly from Aviatrix CoPilot as shown below. As shown below, the default route was showing the Nat gateway as next-hop, but now the next-hop is changed to Aviatrix Spoke Gateway.</p>
<figure class="align-center" id="id16">
<img alt="../_images/141.png" src="../_images/141.png" />
<figcaption>
<p><span class="caption-number">Fig. 30 </span><span class="caption-text">Checking VPC Route Table Change with Aviatrix Spoke Gateway</span><a class="headerlink" href="#id16" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>And as per the screenshot below, you can see the operation is hitless. This action was only achieved the NAT Gateway replacement, now you can basically remove the Nat Gateway from AWS for this VPC and start saving from upkeeping costs of CSP Nat Gateway.</p>
<figure class="align-center" id="id17">
<img alt="../_images/151.png" src="../_images/151.png" />
<figcaption>
<p><span class="caption-number">Fig. 31 </span><span class="caption-text">Egress-1 Test Dashboard</span><a class="headerlink" href="#id17" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>As soon as we enable the Nat Gateway, we can start seeing the traffic flow details in the system, and now as next step we can start deploying rules to only allow desired egress traffic.</p>
</section>
<section id="lab-2-3-2-enable-from-security-egress-section">
<h2>Lab 2.3.2 - Enable from Security-&gt;Egress section<a class="headerlink" href="#lab-2-3-2-enable-from-security-egress-section" title="Link to this heading">#</a></h2>
<p>When we go to Security-&gt;Egress-&gt;Egress VPC/VNET and click “Enable Local Egress on VPC/Vnets”, we can choose the VPC where we have deployed our gateway and save, Aviatrix copilot will enable the Source Nat on the relevant Aviatrix Gateway and will take over the traffic.</p>
<figure class="align-center" id="id18">
<img alt="../_images/15_1.png" src="../_images/15_1.png" />
<figcaption>
<p><span class="caption-number">Fig. 32 </span><span class="caption-text">Aviatrix Local Egress</span><a class="headerlink" href="#id18" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id19">
<img alt="../_images/15_2.png" src="../_images/15_2.png" />
<figcaption>
<p><span class="caption-number">Fig. 33 </span><span class="caption-text">Enabling Aviatrix Local Egress on the Aviatrix Spoke Gateway</span><a class="headerlink" href="#id19" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id20">
<img alt="../_images/15_3.png" src="../_images/15_3.png" />
<figcaption>
<p><span class="caption-number">Fig. 34 </span><span class="caption-text">Confirm the Local Egress Enablement</span><a class="headerlink" href="#id20" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Once the Local egress is enabled , you can check the VPC/VNET route table and see the private route table points out to Aviatrix Spoke Gateway.</p>
<figure class="align-center" id="id21">
<img alt="../_images/15_4.png" src="../_images/15_4.png" />
<figcaption>
<p><span class="caption-number">Fig. 35 </span><span class="caption-text">Checking VPC Route Table Change with Aviatrix Spoke Gateway</span><a class="headerlink" href="#id21" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="lab-2-3-3-enable-via-terraform-as-part-of-ci-cd-pipeline">
<h2>Lab 2.3.3 - Enable via Terraform as part of CI/CD pipeline<a class="headerlink" href="#lab-2-3-3-enable-via-terraform-as-part-of-ci-cd-pipeline" title="Link to this heading">#</a></h2>
<p>We will come back to this topic at the last lab with Terraform.</p>
</section>
<section id="lab-2-4-deploy-egress-security">
<h2>Lab 2.4 - Deploy Egress Security<a class="headerlink" href="#lab-2-4-deploy-egress-security" title="Link to this heading">#</a></h2>
<p>Now we can continue embedding the egress security as the CSP Nat Gateways are replaced at this point.</p>
<p>Go to <code class="docutils literal notranslate"><span class="pre">Security-&gt;</span> <span class="pre">Distributed</span> <span class="pre">Cloud</span> <span class="pre">Firewall</span></code> and click begin button to start configuring firewall rules.</p>
<figure class="align-center" id="id22">
<img alt="../_images/16.png" src="../_images/16.png" />
<figcaption>
<p><span class="caption-number">Fig. 36 </span><span class="caption-text">Begin Using Distributed Cloud Firewall</span><a class="headerlink" href="#id22" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id23">
<img alt="../_images/17.png" src="../_images/17.png" />
<figcaption>
<p><span class="caption-number">Fig. 37 </span><span class="caption-text">Monitoring traffic via Distributed Cloud Firewall</span><a class="headerlink" href="#id23" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>SmartGroups is a very flexible tool that will allow the systems to classify and group the resources for easy management. The Aviatrix platform can classify the resources based on multiple attributes  as shown below. For this lab, we will use CSP-tags.</p>
<figure class="align-center" id="id24">
<img alt="../_images/18.png" src="../_images/18.png" />
<figcaption>
<p><span class="caption-number">Fig. 38 </span><span class="caption-text">SmartGroup</span><a class="headerlink" href="#id24" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Choose the Virtual Machine option and then tier and app tag. And click save that will create a Smart Group to group for the DCF.</p>
<p>For the egress, aws-instance-1 and aws-instance-1b is sharing the same rules, so we can group them in a single SmartGroups.</p>
<figure class="align-center" id="id25">
<img alt="../_images/19.png" src="../_images/19.png" />
<figcaption>
<p><span class="caption-number">Fig. 39 </span><span class="caption-text">Test Virtual Machines</span><a class="headerlink" href="#id25" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>SG-Egress-VPC-1</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Tier</strong></p></td>
<td class="text-left"><p>app</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id26">
<img alt="../_images/20.png" src="../_images/20.png" />
<figcaption>
<p><span class="caption-number">Fig. 40 </span><span class="caption-text">SmartGroup Creation</span><a class="headerlink" href="#id26" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>After clicking the Preview button, all the included resources will be listed.</p>
<figure class="align-center" id="id27">
<img alt="../_images/211.png" src="../_images/211.png" />
<figcaption>
<p><span class="caption-number">Fig. 41 </span><span class="caption-text">SmartGroup Preview Resources</span><a class="headerlink" href="#id27" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id28">
<img alt="../_images/22.png" src="../_images/22.png" />
<figcaption>
<p><span class="caption-number">Fig. 42 </span><span class="caption-text">SmartGroup Preview Resources</span><a class="headerlink" href="#id28" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now we will go to WebGroups to define the domains that will be allowed to the resources.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>WG-Egress-VPC-1</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Type</strong></p></td>
<td class="text-left"><p>Domains</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Domains/URLS</strong></p></td>
<td class="text-left"><p>*.terraform.io</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Domains/URLS</strong></p></td>
<td class="text-left"><p><a class="reference external" href="http://github.com">github.com</a></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Domains/URLS</strong></p></td>
<td class="text-left"><p><a class="reference external" href="http://ubuntu.com">ubuntu.com</a></p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id29">
<img alt="../_images/23.png" src="../_images/23.png" />
<figcaption>
<p><span class="caption-number">Fig. 43 </span><span class="caption-text">WebGroup Creation</span><a class="headerlink" href="#id29" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Here we will define the DCF rule to allow SG-Egress-VPC-1 resources to have specific access only to selected domains in the WG-Egress-VPC-1 smartgroup.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>Allow-Egress-Domains</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Source Groups</strong></p></td>
<td class="text-left"><p>SG-Egress-VPC-1</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Destination Groups</strong></p></td>
<td class="text-left"><p>Public Internet</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>WebGroups</strong></p></td>
<td class="text-left"><p>WG-Egress-VPC-1</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Protocol</strong></p></td>
<td class="text-left"><p>Any</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Enforcement</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Logging</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Action</strong></p></td>
<td class="text-left"><p>Permit</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Priority</strong></p></td>
<td class="text-left"><p>10</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id30">
<img alt="../_images/24.png" src="../_images/24.png" />
<figcaption>
<p><span class="caption-number">Fig. 44 </span><span class="caption-text">Creating Egress Filtering Rule</span><a class="headerlink" href="#id30" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Then click Commit to push the configuration to the system.</p>
<figure class="align-center" id="id31">
<img alt="../_images/25.png" src="../_images/25.png" />
<figcaption>
<p><span class="caption-number">Fig. 45 </span><span class="caption-text">Creating Egress Filtering Rule</span><a class="headerlink" href="#id31" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>You might think, the system is not correctly blocking, that’s true, because to keep the environment controlled and safe, there is a Greenfield rule that allows the traffic. We will just go ahead and Turn Off the Enforcement for the Greenfield Rule, and commit.</p>
<figure class="align-center" id="id32">
<img alt="../_images/26.png" src="../_images/26.png" />
<figcaption>
<p><span class="caption-number">Fig. 46 </span><span class="caption-text">Disable Greenfield Rule</span><a class="headerlink" href="#id32" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now the rules will apply correctly, and the egress traffic will be limited to the selected domains only.</p>
<figure class="align-center" id="id33">
<img alt="../_images/27.png" src="../_images/27.png" />
<figcaption>
<p><span class="caption-number">Fig. 47 </span><span class="caption-text">Egress-1 Dashboard confirms egress filtering</span><a class="headerlink" href="#id33" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>To troubleshoot issues or get more insights, you can also add a deny rule with low priority to see which traffic is denied.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>DENY</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Source Groups</strong></p></td>
<td class="text-left"><p>Anywhere</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Destination Groups</strong></p></td>
<td class="text-left"><p>Public Internet</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>WebGroups</strong></p></td>
<td class="text-left"><p>All-Web</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Protocol</strong></p></td>
<td class="text-left"><p>Any</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Action</strong></p></td>
<td class="text-left"><p>Deny</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Enforcement</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Logging</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Priority</strong></p></td>
<td class="text-left"><p>50000</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id34">
<img alt="../_images/28.png" src="../_images/28.png" />
<figcaption>
<p><span class="caption-number">Fig. 48 </span><span class="caption-text">Adding an explicit Deny rule with logging enabled</span><a class="headerlink" href="#id34" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Below, you can see which traffic is allowed and which one is denied, that will match with the Gatus-1 dashboard reporting.</p>
<figure class="align-center" id="id35">
<img alt="../_images/29.png" src="../_images/29.png" />
<figcaption>
<p><span class="caption-number">Fig. 49 </span><span class="caption-text">Monitoring Explicit Deny rule in action</span><a class="headerlink" href="#id35" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The traffic can also be monitored from the FQDN Monitoring based on the VPC/Vnet selection as shown below.</p>
<figure class="align-center" id="id36">
<img alt="../_images/30.png" src="../_images/30.png" />
<figcaption>
<p><span class="caption-number">Fig. 50 </span><span class="caption-text">Monitoring via FQDN Monitoring section</span><a class="headerlink" href="#id36" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>For the next example, if we  want to keep the same domains reachable, we only need to add the new resources to the SmartGroups, and then the system will automatically apply the same rules to the traffic flow. We will edit the existing SmartGroup <code class="docutils literal notranslate"><span class="pre">SG-Egress-VPC-1</span></code> with the information as shown below in the table.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>SG-Egress-VPC-1-2</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>environment</strong></p></td>
<td class="text-left"><p>dev</p></td>
</tr>
</tbody>
</table>
</div>
<p><code class="docutils literal notranslate"><span class="pre">aws-instance-2</span></code> resource has tag of <code class="docutils literal notranslate"><span class="pre">dev</span></code> as <code class="docutils literal notranslate"><span class="pre">environment</span></code>. Now we can just add one more resource type <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">Machine</span></code>, and fill with required information, then in the preview, all included resources can be seen.</p>
<figure class="align-center" id="id37">
<img alt="../_images/37.png" src="../_images/37.png" />
<figcaption>
<p><span class="caption-number">Fig. 51 </span><span class="caption-text">Creating a new SmartGroup for Egress-2 instance</span><a class="headerlink" href="#id37" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id38">
<img alt="../_images/38.png" src="../_images/38.png" />
<figcaption>
<p><span class="caption-number">Fig. 52 </span><span class="caption-text">Egress-2 Dashboard confirms egress filtering</span><a class="headerlink" href="#id38" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="lab-2-5-security-group-orchestration">
<h2>Lab 2.5 - Security Group Orchestration<a class="headerlink" href="#lab-2-5-security-group-orchestration" title="Link to this heading">#</a></h2>
<p>In case you want to manage VM/Instance communication inside the same VPC/VNET, Aviatrix can help managing the security groups, that doesn’t require Source Nat to be enabled. As soon as the Aviatrix Gateway is deployed CoPilot can start orchestrating the SGs in the deployed VPC/Vnet.</p>
<p>This feature first needs to be enabled in the required VPC/VNET. This feature requires planning, as all inbound traffic will be blocked, and Aviatrix DCF will be managing the rules in the SGs/NSGs.</p>
<figure class="align-center" id="id39">
<img alt="../_images/39.png" src="../_images/39.png" />
<figcaption>
<p><span class="caption-number">Fig. 53 </span><span class="caption-text">Enabling Security Group Orchestration for a selected VPC</span><a class="headerlink" href="#id39" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In our deployment, there are 2 aws-instances (aws-instance-1 and aws-instance-1b) that are deployed on private subnet and 1 Gatus VM that is deployed in public subnet. So, the permissions should be set accordingly.</p>
<p>Create the SmartGroups for all instances and create firewall rules to allow or block traffic. As aws-instance-1 and aws-instance-1b is deployed in 2 different availability zones the traffic between them will be blocked. Similarly, the Gatus server will also try to reach from different subnet, so that traffic will also be blocked.</p>
<p>We need to create 2 new SmartGroups and 2 new DCF rules to demonstrate this lab.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>Gatus-1</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>aws-gatus-1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>SG-Egress-VPC-1-Resources</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>aws-instance-1</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>aws-instance-1b</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id40">
<img alt="../_images/40.png" src="../_images/40.png" />
<figcaption>
<p><span class="caption-number">Fig. 54 </span><span class="caption-text">SmartGroup Creation for Gatus-1 VM</span><a class="headerlink" href="#id40" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id41">
<img alt="../_images/411.png" src="../_images/411.png" />
<figcaption>
<p><span class="caption-number">Fig. 55 </span><span class="caption-text">SmartGroup Creation for AWS-instances in Egress-1 VPC</span><a class="headerlink" href="#id41" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><strong><em>DCF Rule-1</em>:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>Allow-Gatus-1-to-AWS-Instance-1-1b</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Source Groups</strong></p></td>
<td class="text-left"><p>Gatus-1</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Destination Groups</strong></p></td>
<td class="text-left"><p>SG-VPC-1-Resources</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Protocol</strong></p></td>
<td class="text-left"><p>Any</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Action</strong></p></td>
<td class="text-left"><p>Permit</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>SG Orchestration</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Enforcement</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Logging</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Priority</strong></p></td>
<td class="text-left"><p>0</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong><em>DCF Rule-2</em>:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>Allow-HTTP-Intra-VPC-1</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Source Groups</strong></p></td>
<td class="text-left"><p>SG-VPC-1-Resources</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Destination Groups</strong></p></td>
<td class="text-left"><p>SG-VPC-1-Resources</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Protocol</strong></p></td>
<td class="text-left"><p>TCP/80</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Action</strong></p></td>
<td class="text-left"><p>Permit</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>SG Orchestration</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Enforcement</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Logging</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Priority</strong></p></td>
<td class="text-left"><p>1</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id42">
<img alt="../_images/42.png" src="../_images/42.png" />
<figcaption>
<p><span class="caption-number">Fig. 56 </span><span class="caption-text">Creating the DCF rules</span><a class="headerlink" href="#id42" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Once both rules are created, commit the change and then you can see all the traffic will stop between these 2 instances other than TCP/80 traffic.</p>
<p>This operation will be slower than the regular DCF operation as Aviatrix needs to push the changes through CSP APIs to deploy these rules.</p>
<figure class="align-center" id="id43">
<img alt="../_images/43.png" src="../_images/43.png" />
<figcaption>
<p><span class="caption-number">Fig. 57 </span><span class="caption-text">Egress-1 Dashboard confirms intra-vpc traffic filtering</span><a class="headerlink" href="#id43" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><code class="docutils literal notranslate"><span class="pre">Turn</span> <span class="pre">on</span> <span class="pre">enforcement</span> <span class="pre">for</span> <span class="pre">Greenfield-Rule</span> <span class="pre">before</span> <span class="pre">proceeding</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">next</span> <span class="pre">lab!</span></code></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="end-of-lab-2">
<h1>End of Lab 2<a class="headerlink" href="#end-of-lab-2" title="Link to this heading">#</a></h1>
<p>Ok, that’s the end of Lab 2. Great job! We will come back to this part at the last lab with some terraform magic!</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lab1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab-1: Getting Started</p>
      </div>
    </a>
    <a class="right-next"
       href="lab3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab-3: Secure High-Performance Datacenter Edge</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lab-2: Aviatrix Cloud Firewall</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-1-overview">Lab 2.1 - Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-2-deploying-spoke-gateways">Lab 2.2 - Deploying Spoke Gateways</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-enabling-aviatrix-nat-gateway">Lab 2.3 - Enabling Aviatrix Nat Gateway</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-1-enable-from-the-gateway-settings">Lab 2.3.1 - Enable from the Gateway Settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-2-enable-from-security-egress-section">Lab 2.3.2 - Enable from Security-&gt;Egress section</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-3-3-enable-via-terraform-as-part-of-ci-cd-pipeline">Lab 2.3.3 - Enable via Terraform as part of CI/CD pipeline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-4-deploy-egress-security">Lab 2.4 - Deploy Egress Security</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-2-5-security-group-orchestration">Lab 2.5 - Security Group Orchestration</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-lab-2">End of Lab 2</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aviatrix Flight School
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>