
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab-3: Secure High-Performance Datacenter Edge &#8212; Aviatrix Flight School</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=1d85937c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/lab3';</script>
    <link rel="icon" href="../_static/aviatrix-favicon-32.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab-4: Observability and Troubleshooting" href="lab4.html" />
    <link rel="prev" title="Lab-2: Aviatrix Cloud Firewall" href="lab2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Aviatrix_Logo_White_Gradient_RGB.svg" class="logo__image only-light" alt="Aviatrix Flight School - Home"/>
    <script>document.write(`<img src="../_static/Aviatrix_Logo_White_Gradient_RGB.svg" class="logo__image only-dark" alt="Aviatrix Flight School - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="home.html">
                    Welcome to Aviatrix Flight School!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lab1.html">Lab-1: Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">Lab-2: Aviatrix Cloud Firewall</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab-3: Secure High-Performance Datacenter Edge</a></li>

<li class="toctree-l1"><a class="reference internal" href="lab4.html">Lab-4: Observability and Troubleshooting</a></li>

<li class="toctree-l1"><a class="reference internal" href="lab5.html">Lab-5: Infrastructure as Code</a></li>

<li class="toctree-l1"><a class="reference internal" href="lab6.html">Lab-6: <em>(Optional)</em> Future State: Aviatrix Cloud Firewall as the complete connectivity and security platform for your cloud</a></li>

<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/lab3.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab-3: Secure High-Performance Datacenter Edge</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lab-3: Secure High-Performance Datacenter Edge</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-1-connecting-aviatrix-gateways-on-azure-and-aws">Lab 3.1 - Connecting Aviatrix Gateways on Azure and AWS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-2-connecting-aviatrix-edge-gateway-to-azure-and-aws">Lab 3.2 - Connecting Aviatrix Edge Gateway to Azure and AWS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-3-resiliency">Lab 3.3 - Resiliency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-connection-between-on-prem-to-azure-goes-down"><em>What if connection between On-Prem to Azure goes down?</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-connection-between-on-prem-to-aws-goes-down"><em>What if connection between On-Prem to AWS goes down?</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-connection-between-aws-to-azure-goes-down"><em>What if connection between AWS to Azure goes down?</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-4-route-filtering">Lab 3.4 - Route Filtering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-5-macro-segmentation">Lab 3.5 - Macro-Segmentation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-6-micro-segmentation-with-distributed-cloud-firewall">Lab 3.6 - Micro-Segmentation with Distributed Cloud Firewall</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-lab-3">End of Lab 3</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-3-secure-high-performance-datacenter-edge">
<h1>Lab-3: Secure High-Performance Datacenter Edge<a class="headerlink" href="#lab-3-secure-high-performance-datacenter-edge" title="Link to this heading">#</a></h1>
<p>On-Prem to Cloud demands high throughput, and threats mandate securing the data whether on-disk or on-the-fly. Aviatrix Secure High-Performance Datacenter Edge provides you the line-rate encrypted connectivity helping customers overcome IPSec throughput limitation or CSP-native route count limitations and many more with its converged manner. With Aviatrix Edge, now cloud will come to customer’s on-premises environments.</p>
<figure class="align-center" id="id1">
<img alt="../_images/110.png" src="../_images/110.png" />
<figcaption>
<p><span class="caption-number">Fig. 58 </span><span class="caption-text">Lab Overview</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>We will be focusing on the right side for this activity. This activity will include connecting brownfield environment to on-prem site with low friction. The Aviatrix Transit Gateway in AWS is connecting to AWS TGW, and Aviatrix Transit Gateway in Azure is connected to Azure Route Server.</p>
<figure class="align-center" id="id2">
<img alt="../_images/210.png" src="../_images/210.png" />
<figcaption>
<p><span class="caption-number">Fig. 59 </span><span class="caption-text">Topology View</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Servers on these 3 sites are trying to establish connectivity between each other. Once the connections between the gateways are established the servers should be able to reach out to each other.</p>
<figure class="align-center" id="id3">
<img alt="../_images/32.png" src="../_images/32.png" />
<figcaption>
<p><span class="caption-number">Fig. 60 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id4">
<img alt="../_images/44.png" src="../_images/44.png" />
<figcaption>
<p><span class="caption-number">Fig. 61 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id5">
<img alt="../_images/52.png" src="../_images/52.png" />
<figcaption>
<p><span class="caption-number">Fig. 62 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
<section id="lab-3-1-connecting-aviatrix-gateways-on-azure-and-aws">
<h2>Lab 3.1 - Connecting Aviatrix Gateways on Azure and AWS<a class="headerlink" href="#lab-3-1-connecting-aviatrix-gateways-on-azure-and-aws" title="Link to this heading">#</a></h2>
<p>In this activity we will establish connectivity between multi-cloud environments.
Go to <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric</span> <span class="pre">-&gt;</span> <span class="pre">Gateways</span> <span class="pre">-&gt;</span> <span class="pre">Transit</span> <span class="pre">Gateways</span></code> and then choose either of the gateway to establish connectivity to the other.</p>
<figure class="align-center" id="id6">
<img alt="../_images/62.png" src="../_images/62.png" />
<figcaption>
<p><span class="caption-number">Fig. 63 </span><span class="caption-text">Aviatrix Transit Gateway Section</span><a class="headerlink" href="#id6" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Click <code class="docutils literal notranslate"><span class="pre">+Attachment</span></code> button.</p>
<figure class="align-center" id="id7">
<img alt="../_images/72.png" src="../_images/72.png" />
<figcaption>
<p><span class="caption-number">Fig. 64 </span><span class="caption-text">Aviatrix Transit Gateway Connection</span><a class="headerlink" href="#id7" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Choose the transit gateway that needs to be connected, and click Save</p>
<figure class="align-center" id="id8">
<img alt="../_images/82.png" src="../_images/82.png" />
<figcaption>
<p><span class="caption-number">Fig. 65 </span><span class="caption-text">Aviatrix Transit Gateway Connection</span><a class="headerlink" href="#id8" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Progress can be monitored in the notifications page.</p>
<figure class="align-center" id="id9">
<img alt="../_images/92.png" src="../_images/92.png" />
<figcaption>
<p><span class="caption-number">Fig. 66 </span><span class="caption-text">Aviatrix Transit Gateway Connection Progress</span><a class="headerlink" href="#id9" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Topology will start building the connection and once it’s completed it will move from red to green in the map.</p>
<figure class="align-center" id="id10">
<img alt="../_images/102.png" src="../_images/102.png" />
<figcaption>
<p><span class="caption-number">Fig. 67 </span><span class="caption-text">Topology View while building the connection</span><a class="headerlink" href="#id10" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id11">
<img alt="../_images/112.png" src="../_images/112.png" />
<figcaption>
<p><span class="caption-number">Fig. 68 </span><span class="caption-text">Topology View after the connection is built</span><a class="headerlink" href="#id11" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>After the connection is established and the routes are exchanged, the network will converge and there will be end-to-end reachability between the resources which reside  on Azure and AWS.</p>
<figure class="align-center" id="id12">
<img alt="../_images/122.png" src="../_images/122.png" />
<figcaption>
<p><span class="caption-number">Fig. 69 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id12" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id13">
<img alt="../_images/132.png" src="../_images/132.png" />
<figcaption>
<p><span class="caption-number">Fig. 70 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id13" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Route tables on the transit gateways can also be checked in <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric-&gt;Gateways-&gt;Transit</span> <span class="pre">Gateways</span></code> and then choose your desired gateway and go to <code class="docutils literal notranslate"><span class="pre">Gateway</span> <span class="pre">Routes</span></code>, there the routes can be observed.</p>
<figure class="align-center" id="id14">
<img alt="../_images/142.png" src="../_images/142.png" />
<figcaption>
<p><span class="caption-number">Fig. 71 </span><span class="caption-text">Transit Gateway Routing Tables</span><a class="headerlink" href="#id14" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="lab-3-2-connecting-aviatrix-edge-gateway-to-azure-and-aws">
<h2>Lab 3.2 - Connecting Aviatrix Edge Gateway to Azure and AWS<a class="headerlink" href="#lab-3-2-connecting-aviatrix-edge-gateway-to-azure-and-aws" title="Link to this heading">#</a></h2>
<p>In this activity we will establish connectivity from on-prem to cloud.</p>
<p>Go to <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric</span> <span class="pre">-&gt;</span> <span class="pre">Hybrid</span> <span class="pre">Cloud</span> <span class="pre">-&gt;</span> <span class="pre">Edge</span> <span class="pre">Gateways</span></code> and then choose the edge gateway to establish connectivity to the Aviatrix Transit gateways.</p>
<figure class="align-center" id="id15">
<img alt="../_images/152.png" src="../_images/152.png" />
<figcaption>
<p><span class="caption-number">Fig. 72 </span><span class="caption-text">Edge Gateway Configuration</span><a class="headerlink" href="#id15" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Click <code class="docutils literal notranslate"><span class="pre">+Attachment</span></code> button.</p>
<p>Choose the transit gateway that needs to be connected and click Save. Multiple connections can be configured at the same time.</p>
<figure class="align-center" id="id16">
<img alt="../_images/161.png" src="../_images/161.png" />
<figcaption>
<p><span class="caption-number">Fig. 73 </span><span class="caption-text">Edge to Cloud Connectivity</span><a class="headerlink" href="#id16" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Progress can be monitored in the notifications page.</p>
<figure class="align-center" id="id17">
<img alt="../_images/171.png" src="../_images/171.png" />
<figcaption>
<p><span class="caption-number">Fig. 74 </span><span class="caption-text">Edge to Cloud Connectivity Progress</span><a class="headerlink" href="#id17" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Topology will start building the connection and once it’s completed it will move from red to green in the map.</p>
<figure class="align-center" id="id18">
<img alt="../_images/181.png" src="../_images/181.png" />
<figcaption>
<p><span class="caption-number">Fig. 75 </span><span class="caption-text">Topology View</span><a class="headerlink" href="#id18" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Route tables on the transit gateways can also be observed in <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric-&gt;Hybrid</span> <span class="pre">Cloud-&gt;Edge</span> <span class="pre">Gateways</span></code> and then choose the gateway and go to <code class="docutils literal notranslate"><span class="pre">Gateway</span> <span class="pre">Routes</span></code>, there the routes can be observed.</p>
<figure class="align-center" id="id19">
<img alt="../_images/191.png" src="../_images/191.png" />
<figcaption>
<p><span class="caption-number">Fig. 76 </span><span class="caption-text">Edge Gateway Routes</span><a class="headerlink" href="#id19" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>After the connection is established and the routes are exchanged, the network will converge and there will be end-to-end reachability between the resources which reside  on On-Prem, Azure and AWS.</p>
<figure class="align-center" id="id20">
<img alt="../_images/201.png" src="../_images/201.png" />
<figcaption>
<p><span class="caption-number">Fig. 77 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id20" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id21">
<img alt="../_images/212.png" src="../_images/212.png" />
<figcaption>
<p><span class="caption-number">Fig. 78 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id21" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id22">
<img alt="../_images/221.png" src="../_images/221.png" />
<figcaption>
<p><span class="caption-number">Fig. 79 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id22" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="lab-3-3-resiliency">
<h2>Lab 3.3 - Resiliency<a class="headerlink" href="#lab-3-3-resiliency" title="Link to this heading">#</a></h2>
<p>Now we will dive into what-if scenarios a bit. In the real-world scenarios we can’t be certain about the connectivity we must be always prepared.</p>
</section>
<section id="what-if-connection-between-on-prem-to-azure-goes-down">
<h2><em>What if connection between On-Prem to Azure goes down?</em><a class="headerlink" href="#what-if-connection-between-on-prem-to-azure-goes-down" title="Link to this heading">#</a></h2>
<p>This is a very likely event for any on-prem to cloud connectivity to go down. We will demonstrate this by removing the connection from On-Prem to Azure and validate the traffic flow from the On-Prem Server.</p>
<p>Go to <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric</span> <span class="pre">-&gt;</span> <span class="pre">Hybrid</span> <span class="pre">Cloud</span> <span class="pre">-&gt;</span> <span class="pre">Edge</span> <span class="pre">Gateways</span></code> and choose the attachment and delete the azure connection from the corner and save.</p>
<figure class="align-center" id="id23">
<img alt="../_images/231.png" src="../_images/231.png" />
<figcaption>
<p><span class="caption-number">Fig. 80 </span><span class="caption-text">Edge Gateway Connections</span><a class="headerlink" href="#id23" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Change can be observed from topology map, route table.</p>
<figure class="align-center" id="id24">
<img alt="../_images/241.png" src="../_images/241.png" />
<figcaption>
<p><span class="caption-number">Fig. 81 </span><span class="caption-text">Topology View</span><a class="headerlink" href="#id24" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id25">
<img alt="../_images/251.png" src="../_images/251.png" />
<figcaption>
<p><span class="caption-number">Fig. 82 </span><span class="caption-text">Edge Gateway Routes</span><a class="headerlink" href="#id25" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>And as the result, there won’t be a problem with the traffic, because now the connection from Edge to Azure is sent towards AWS, so the traffic continues without an issue.</p>
<figure class="align-center" id="id26">
<img alt="../_images/261.png" src="../_images/261.png" />
<figcaption>
<p><span class="caption-number">Fig. 83 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id26" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id27">
<img alt="../_images/271.png" src="../_images/271.png" />
<figcaption>
<p><span class="caption-number">Fig. 84 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id27" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id28">
<img alt="../_images/281.png" src="../_images/281.png" />
<figcaption>
<p><span class="caption-number">Fig. 85 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id28" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now recover the connectivity back and wait until the connectivity is established correctly and reflected in the edge gateway’s route table accordingly.  It may take some time to reflect correctly.</p>
<figure class="align-center" id="id29">
<img alt="../_images/291.png" src="../_images/291.png" />
<figcaption>
<p><span class="caption-number">Fig. 86 </span><span class="caption-text">Recovery of Edge Gateway Connection</span><a class="headerlink" href="#id29" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="what-if-connection-between-on-prem-to-aws-goes-down">
<h2><em>What if connection between On-Prem to AWS goes down?</em><a class="headerlink" href="#what-if-connection-between-on-prem-to-aws-goes-down" title="Link to this heading">#</a></h2>
<p>This is a very likely event for any on-prem to cloud connectivity to go down. We will demonstrate this with removing the connection from On-Prem to AWS and validate the traffic flow from the On-Prem Server.</p>
<p>Go to <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric</span> <span class="pre">-&gt;</span> <span class="pre">Hybrid</span> <span class="pre">Cloud</span> <span class="pre">-&gt;</span> <span class="pre">Edge</span> <span class="pre">Gateways</span></code> and choose the attachment and delete the aws connection from the corner and save.</p>
<figure class="align-center" id="id30">
<img alt="../_images/301.png" src="../_images/301.png" />
<figcaption>
<p><span class="caption-number">Fig. 87 </span><span class="caption-text">Edge Gateway Connections</span><a class="headerlink" href="#id30" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Change can be observed from topology map, route table.</p>
<figure class="align-center" id="id31">
<img alt="../_images/311.png" src="../_images/311.png" />
<figcaption>
<p><span class="caption-number">Fig. 88 </span><span class="caption-text">Topology View</span><a class="headerlink" href="#id31" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id32">
<img alt="../_images/321.png" src="../_images/321.png" />
<figcaption>
<p><span class="caption-number">Fig. 89 </span><span class="caption-text">Edge Gateway Routes</span><a class="headerlink" href="#id32" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>And as the result, there won’t be a problem with the traffic, because now the connection from Edge to AWS is sent towards Azure, so the traffic continues without an issue.</p>
<figure class="align-center" id="id33">
<img alt="../_images/33.png" src="../_images/33.png" />
<figcaption>
<p><span class="caption-number">Fig. 90 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id33" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id34">
<img alt="../_images/34.png" src="../_images/34.png" />
<figcaption>
<p><span class="caption-number">Fig. 91 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id34" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id35">
<img alt="../_images/35.png" src="../_images/35.png" />
<figcaption>
<p><span class="caption-number">Fig. 92 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id35" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now recover the connectivity back and wait until the connectivity is established correctly and reflected in the edge gateway’s route table accordingly.  It may take some time to reflect correctly.</p>
<figure class="align-center" id="id36">
<img alt="../_images/36.png" src="../_images/36.png" />
<figcaption>
<p><span class="caption-number">Fig. 93 </span><span class="caption-text">Recovery of Edge Gateway Connection</span><a class="headerlink" href="#id36" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="what-if-connection-between-aws-to-azure-goes-down">
<h2><em>What if connection between AWS to Azure goes down?</em><a class="headerlink" href="#what-if-connection-between-aws-to-azure-goes-down" title="Link to this heading">#</a></h2>
<p>This is a very unlikely event to occur, but we can’t be more prepared than this. We’d expect that will take the traffic towards on-prem to other cloud. We will demonstrate this with removing the connection from Azure to AWS and validate whether the traffic flow from the either Azure or AWS server.</p>
<p>Go to <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric</span> <span class="pre">-&gt;</span> <span class="pre">Gateways-&gt;</span> <span class="pre">Transit</span> <span class="pre">Gateways</span></code> and choose the attachment and delete the other transit gateway connection from the corner and save.</p>
<figure class="align-center" id="id37">
<img alt="../_images/371.png" src="../_images/371.png" />
<figcaption>
<p><span class="caption-number">Fig. 94 </span><span class="caption-text">Transit Gateway Connections</span><a class="headerlink" href="#id37" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Change can be observed from topology map, route table.</p>
<figure class="align-center" id="id38">
<img alt="../_images/381.png" src="../_images/381.png" />
<figcaption>
<p><span class="caption-number">Fig. 95 </span><span class="caption-text">Topology View</span><a class="headerlink" href="#id38" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id39">
<img alt="../_images/391.png" src="../_images/391.png" />
<figcaption>
<p><span class="caption-number">Fig. 96 </span><span class="caption-text">Transit Gateway Routes</span><a class="headerlink" href="#id39" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>And as the result, there will be a problem with the traffic, because as that will not be an efficient way to work and may end-up with very suboptimal traffic flows as well as costly results. The default behaviour is not to make the Edge Gateway capable of moving traffic between transit gateways.</p>
<figure class="align-center" id="id40">
<img alt="../_images/401.png" src="../_images/401.png" />
<figcaption>
<p><span class="caption-number">Fig. 97 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id40" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id41">
<img alt="../_images/412.png" src="../_images/412.png" />
<figcaption>
<p><span class="caption-number">Fig. 98 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id41" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id42">
<img alt="../_images/421.png" src="../_images/421.png" />
<figcaption>
<p><span class="caption-number">Fig. 99 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id42" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>But that doesn’t mean Aviatrix is not coming up with a solution. In case of an urgent resolution requirement for this issue, edge gateway can provide connectivity to other cloud resources and relay the traffic with a small configuration change.
Go to <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric</span> <span class="pre">-&gt;</span> <span class="pre">Hybrid</span> <span class="pre">Cloud-&gt;</span> <span class="pre">Edge</span> <span class="pre">Gateways</span></code> and select the <code class="docutils literal notranslate"><span class="pre">aviatrix-edge-1</span></code> gateway, then click to the settings and enable <code class="docutils literal notranslate"><span class="pre">Transitive</span> <span class="pre">Routing</span></code>.</p>
<figure class="align-center" id="id43">
<img alt="../_images/431.png" src="../_images/431.png" />
<figcaption>
<p><span class="caption-number">Fig. 100 </span><span class="caption-text">Enabling Transitive Routing on Edge Gateway</span><a class="headerlink" href="#id43" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Once this option is enabled, the routing will re-converge and the traffic between Azure and AWS resources will continue using Edge Gateway as the transit. But very important to note that it should be assumed as a temporary solution.</p>
<figure class="align-center" id="id44">
<img alt="../_images/441.png" src="../_images/441.png" />
<figcaption>
<p><span class="caption-number">Fig. 101 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id44" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id45">
<img alt="../_images/45.png" src="../_images/45.png" />
<figcaption>
<p><span class="caption-number">Fig. 102 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id45" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id46">
<img alt="../_images/46.png" src="../_images/46.png" />
<figcaption>
<p><span class="caption-number">Fig. 103 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id46" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id47">
<img alt="../_images/47.png" src="../_images/47.png" />
<figcaption>
<p><span class="caption-number">Fig. 104 </span><span class="caption-text">Transit Gateway Routes</span><a class="headerlink" href="#id47" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now recover the connectivity back and wait until the connectivity is established correctly and reflected in the transit gateway’s route table accordingly.  It may take some time to reflect correctly.
Also remove the transitive routing configuration from the Edge Gateway.</p>
</section>
<section id="lab-3-4-route-filtering">
<h2>Lab 3.4 - Route Filtering<a class="headerlink" href="#lab-3-4-route-filtering" title="Link to this heading">#</a></h2>
<p>In case there is a business need to not allow routes to exchange in between Aviatrix Transit Gateways. For example, you have an on-prem site, but you want the on-prem to stay in a single region due to data protection law such as GDPR. Then this rule can be excluded on the link between the transits so the route can’t converge, and the traffic will stop flowing.</p>
<p>For this example, we will destroy the connection between on-prem and Azure. But the aim is not to allow traffic to flow from Azure to On-Prem.</p>
<p>Go to <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Fabric</span> <span class="pre">-&gt;</span> <span class="pre">Hybrid</span> <span class="pre">Cloud</span> <span class="pre">-&gt;</span> <span class="pre">Edge</span> <span class="pre">Gateways</span></code> and choose the attachment and delete the <code class="docutils literal notranslate"><span class="pre">azure</span> <span class="pre">connection</span></code> from the corner and save.</p>
<figure class="align-center" id="id48">
<img alt="../_images/48.png" src="../_images/48.png" />
<figcaption>
<p><span class="caption-number">Fig. 105 </span><span class="caption-text">Edge Gateway Connection</span><a class="headerlink" href="#id48" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Change can be observed from topology map, route table.</p>
<figure class="align-center" id="id49">
<img alt="../_images/49.png" src="../_images/49.png" />
<figcaption>
<p><span class="caption-number">Fig. 106 </span><span class="caption-text">Topology View</span><a class="headerlink" href="#id49" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id50">
<img alt="../_images/50.png" src="../_images/50.png" />
<figcaption>
<p><span class="caption-number">Fig. 107 </span><span class="caption-text">Edge Gateway Routes</span><a class="headerlink" href="#id50" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>And as the result, there won’t be a problem with the traffic, because now the connection from Edge to Azure is sent towards AWS, so the traffic continues without an issue.</p>
<figure class="align-center" id="id51">
<img alt="../_images/511.png" src="../_images/511.png" />
<figcaption>
<p><span class="caption-number">Fig. 108 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id51" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>But this doesn’t allow us to achieve the traffic to drop. So now we will filter the on-prem IP-block on the link between transit gateways, then the traffic from On-Prem to Azure should fail.</p>
<p>IP block can be found from the transit-aws gateway’s Gateway routes section, after filtering with edge as keyword. For this example, it’s <code class="docutils literal notranslate"><span class="pre">10.40.251.0/29</span></code> and <code class="docutils literal notranslate"><span class="pre">10.40.251.16/28</span></code>.</p>
<figure class="align-center" id="id52">
<img alt="../_images/521.png" src="../_images/521.png" />
<figcaption>
<p><span class="caption-number">Fig. 109 </span><span class="caption-text">Aviatrix Transit Gateway routes</span><a class="headerlink" href="#id52" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now we will go ahead to the connection between the transit gateways and exclude these 2 IP Blocks.</p>
<figure class="align-center" id="id53">
<img alt="../_images/53.png" src="../_images/53.png" />
<figcaption>
<p><span class="caption-number">Fig. 110 </span><span class="caption-text">IP Block Filtering</span><a class="headerlink" href="#id53" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>And as the result, Traffic between Edge and Azure will stop flowing while the traffic between AWS and Edge flows without any problems.</p>
<figure class="align-center" id="id54">
<img alt="../_images/54.png" src="../_images/54.png" />
<figcaption>
<p><span class="caption-number">Fig. 111 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id54" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id55">
<img alt="../_images/55.png" src="../_images/55.png" />
<figcaption>
<p><span class="caption-number">Fig. 112 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id55" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id56">
<img alt="../_images/56.png" src="../_images/56.png" />
<figcaption>
<p><span class="caption-number">Fig. 113 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id56" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now recover the connection and remove the excluded CIDRs for next lab activity.</p>
</section>
<section id="lab-3-5-macro-segmentation">
<h2>Lab 3.5 - Macro-Segmentation<a class="headerlink" href="#lab-3-5-macro-segmentation" title="Link to this heading">#</a></h2>
<p>Aviatrix gives flexibility to deploy macro-segmentation to keep resources isolated. Macro-Segmentation is a vrf-like solution which is defined in the system as Network domains. In case of need these domains can connect to each other to achieve vrf-leak type of scenario.</p>
<p>Go to <code class="docutils literal notranslate"><span class="pre">Networking-&gt;Network</span> <span class="pre">Segmentation-&gt;Network</span> <span class="pre">Domains</span></code>, then select <code class="docutils literal notranslate"><span class="pre">Transit</span> <span class="pre">Gateways</span></code> to check if Network Segmentation is enabled, if not enable them.</p>
<figure class="align-center" id="id57">
<img alt="../_images/57.png" src="../_images/57.png" />
<figcaption>
<p><span class="caption-number">Fig. 114 </span><span class="caption-text">Enabling Network Segmentation for Aviatrix Transit Gateways</span><a class="headerlink" href="#id57" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>For this deployment, we will create 3 network domains, and separate Azure, AWS, and Edge deployment from each other.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Field</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Name</strong></p></td>
<td><p>Azure</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Associations</strong></p></td>
<td><p>azure-rs-spoke</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Field</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Name</strong></p></td>
<td><p>AWS</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Associations</strong></p></td>
<td><p>aws-tgw</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Field</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Name</strong></p></td>
<td><p>edge</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Associations</strong></p></td>
<td><p>aviatrix-edge-site</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id58">
<img alt="../_images/58.png" src="../_images/58.png" />
<figcaption>
<p><span class="caption-number">Fig. 115 </span><span class="caption-text">AWS Network Domain Creation and Association</span><a class="headerlink" href="#id58" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id59">
<img alt="../_images/59.png" src="../_images/59.png" />
<figcaption>
<p><span class="caption-number">Fig. 116 </span><span class="caption-text">Edge Network Domain Creation and Association</span><a class="headerlink" href="#id59" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id60">
<img alt="../_images/60.png" src="../_images/60.png" />
<figcaption>
<p><span class="caption-number">Fig. 117 </span><span class="caption-text">Azure Network Domain Creation and Association</span><a class="headerlink" href="#id60" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>After this step, all the communication between Servers will fail, as now we separated the routing tables between each other, so became unreachable.</p>
<figure class="align-center" id="id61">
<img alt="../_images/611.png" src="../_images/611.png" />
<figcaption>
<p><span class="caption-number">Fig. 118 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id61" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id62">
<img alt="../_images/621.png" src="../_images/621.png" />
<figcaption>
<p><span class="caption-number">Fig. 119 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id62" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id63">
<img alt="../_images/63.png" src="../_images/63.png" />
<figcaption>
<p><span class="caption-number">Fig. 120 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id63" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id64">
<img alt="../_images/64.png" src="../_images/64.png" />
<figcaption>
<p><span class="caption-number">Fig. 121 </span><span class="caption-text">Network Domains Topology</span><a class="headerlink" href="#id64" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The newly created routing tables can be seen from the Gateway routes for each of the domain.</p>
<figure class="align-center" id="id65">
<img alt="../_images/65.png" src="../_images/65.png" />
<figcaption>
<p><span class="caption-number">Fig. 122 </span><span class="caption-text">Network Domain Routing Tables on Aviatrix Transit Gateways</span><a class="headerlink" href="#id65" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now we are going to create connections Edge and Azure, and Edge and AWS, which should allow Edge to communicate with Azure and AWS resources, but Azure and AWS won’t be able to communicate to each other.</p>
<figure class="align-center" id="id66">
<img alt="../_images/66.png" src="../_images/66.png" />
<figcaption>
<p><span class="caption-number">Fig. 123 </span><span class="caption-text">Network Domain Connectivity</span><a class="headerlink" href="#id66" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id67">
<img alt="../_images/67.png" src="../_images/67.png" />
<figcaption>
<p><span class="caption-number">Fig. 124 </span><span class="caption-text">Network Domain Connectivity Topology</span><a class="headerlink" href="#id67" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now the Edge Resources’ routes became visible and known to the Azure networking domain which enables the bi-directional communication between Edge and Azure Resources, the same will apply to the AWS network domain as well.</p>
<figure class="align-center" id="id68">
<img alt="../_images/68.png" src="../_images/68.png" />
<figcaption>
<p><span class="caption-number">Fig. 125 </span><span class="caption-text">Gateway Routes in Network Domains on Aviatrix Transit Gateways</span><a class="headerlink" href="#id68" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>So, as you can see below, while Edge Resources can reach to both AWS and Azure resources, there are no communications are allowed between AWS and Azure resources.</p>
<figure class="align-center" id="id69">
<img alt="../_images/69.png" src="../_images/69.png" />
<figcaption>
<p><span class="caption-number">Fig. 126 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id69" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id70">
<img alt="../_images/70.png" src="../_images/70.png" />
<figcaption>
<p><span class="caption-number">Fig. 127 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id70" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id71">
<img alt="../_images/711.png" src="../_images/711.png" />
<figcaption>
<p><span class="caption-number">Fig. 128 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id71" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>To continue next lab activity, we can follow 2 ways.</p>
<ul class="simple">
<li><p>Delete the network domains and everything will move back to default table</p></li>
<li><p>Add connection between AWS and Azure in the network domain which will keep all the network domains, but all will be converged.</p></li>
</ul>
<p>Once you apply your selection, confirm the servers’ dashboards for communication between all resources.</p>
<figure class="align-center" id="id72">
<img alt="../_images/721.png" src="../_images/721.png" />
<figcaption>
<p><span class="caption-number">Fig. 129 </span><span class="caption-text">Connectivity Recovered on Gatus Dashboards</span><a class="headerlink" href="#id72" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="lab-3-6-micro-segmentation-with-distributed-cloud-firewall">
<h2>Lab 3.6 - Micro-Segmentation with Distributed Cloud Firewall<a class="headerlink" href="#lab-3-6-micro-segmentation-with-distributed-cloud-firewall" title="Link to this heading">#</a></h2>
<p>Aviatrix also provides Zero-Trust in the resource level without agents. With help of SmartGroups, the resources can be identified, and rules can be applied.</p>
<p>We will define 3 SmartGroups for our test resources this time with another option; using CIDR.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Field</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Name</strong></p></td>
<td><p>AWS-Resources</p></td>
</tr>
<tr class="row-odd"><td><p><strong>IPs/CIDRs</strong></p></td>
<td><p>10.1.2.40</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Field</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Name</strong></p></td>
<td><p>Azure-Resources</p></td>
</tr>
<tr class="row-odd"><td><p><strong>IPs/CIDRs</strong></p></td>
<td><p>10.2.2.40</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Field</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Name</strong></p></td>
<td><p>OnPrem</p></td>
</tr>
<tr class="row-odd"><td><p><strong>IPs/CIDRs</strong></p></td>
<td><p>10.40.251.29</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id73">
<img alt="../_images/73.png" src="../_images/73.png" />
<figcaption>
<p><span class="caption-number">Fig. 130 </span><span class="caption-text">SmartGroup Creation based on CIDRs for AWS-Resources</span><a class="headerlink" href="#id73" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id74">
<img alt="../_images/74.png" src="../_images/74.png" />
<figcaption>
<p><span class="caption-number">Fig. 131 </span><span class="caption-text">SmartGroup Creation based on CIDRs for Azure-Resources</span><a class="headerlink" href="#id74" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id75">
<img alt="../_images/75.png" src="../_images/75.png" />
<figcaption>
<p><span class="caption-number">Fig. 132 </span><span class="caption-text">SmartGroups are created for all 3 sites</span><a class="headerlink" href="#id75" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>We will now create the DCF rules to allow traffic flows shown below:</p>
<ul>
<li><p>Edge-&gt;AWS port TCP:443</p></li>
<li><p>Edge-&gt;Azure port TCP:5000</p></li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Turn off enforcement on Greenfield-Rule
</pre></div>
</div>
</li>
</ul>
<figure class="align-center" id="id76">
<img alt="../_images/76.png" src="../_images/76.png" />
<figcaption>
<p><span class="caption-number">Fig. 133 </span><span class="caption-text">OnPrem to AWS Rules Creation</span><a class="headerlink" href="#id76" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id77">
<img alt="../_images/77.png" src="../_images/77.png" />
<figcaption>
<p><span class="caption-number">Fig. 134 </span><span class="caption-text">OnPrem to Azure Rules Creation</span><a class="headerlink" href="#id77" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Below the results can be seen, while Edge can reach out to Azure and AWS resources, the traffic initiated from either one will fail.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>OnPrem-to-AWS-443</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Source Groups</strong></p></td>
<td class="text-left"><p>OnPrem</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Destination Groups</strong></p></td>
<td class="text-left"><p>AWS-Resources</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Protocol</strong></p></td>
<td class="text-left"><p>TCP/443</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Enforcement</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Logging</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>SG Orchestration</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Action</strong></p></td>
<td class="text-left"><p>Permit</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Priority</strong></p></td>
<td class="text-left"><p>90</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p><strong>Field</strong></p></th>
<th class="head text-left"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Name</strong></p></td>
<td class="text-left"><p>OnPrem-to-Azure-5000</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Source Groups</strong></p></td>
<td class="text-left"><p>OnPrem</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Destination Groups</strong></p></td>
<td class="text-left"><p>Azure-Resources</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Protocol</strong></p></td>
<td class="text-left"><p>TCP/5000</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Enforcement</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Logging</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>SG Orchestration</strong></p></td>
<td class="text-left"><p>ON</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Action</strong></p></td>
<td class="text-left"><p>Permit</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Priority</strong></p></td>
<td class="text-left"><p>100</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-center" id="id78">
<img alt="../_images/78.png" src="../_images/78.png" />
<figcaption>
<p><span class="caption-number">Fig. 135 </span><span class="caption-text">DCF rules</span><a class="headerlink" href="#id78" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id79">
<img alt="../_images/79.png" src="../_images/79.png" />
<figcaption>
<p><span class="caption-number">Fig. 136 </span><span class="caption-text">Edge Gatus Dashboard</span><a class="headerlink" href="#id79" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id80">
<img alt="../_images/80.png" src="../_images/80.png" />
<figcaption>
<p><span class="caption-number">Fig. 137 </span><span class="caption-text">AWS Gatus Dashboard</span><a class="headerlink" href="#id80" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id81">
<img alt="../_images/811.png" src="../_images/811.png" />
<figcaption>
<p><span class="caption-number">Fig. 138 </span><span class="caption-text">Azure Gatus Dashboard</span><a class="headerlink" href="#id81" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="end-of-lab-3">
<h1>End of Lab 3<a class="headerlink" href="#end-of-lab-3" title="Link to this heading">#</a></h1>
<p>Ok, that’s the end of Lab 3. Great job!</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lab2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab-2: Aviatrix Cloud Firewall</p>
      </div>
    </a>
    <a class="right-next"
       href="lab4.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab-4: Observability and Troubleshooting</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lab-3: Secure High-Performance Datacenter Edge</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-1-connecting-aviatrix-gateways-on-azure-and-aws">Lab 3.1 - Connecting Aviatrix Gateways on Azure and AWS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-2-connecting-aviatrix-edge-gateway-to-azure-and-aws">Lab 3.2 - Connecting Aviatrix Edge Gateway to Azure and AWS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-3-resiliency">Lab 3.3 - Resiliency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-connection-between-on-prem-to-azure-goes-down"><em>What if connection between On-Prem to Azure goes down?</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-connection-between-on-prem-to-aws-goes-down"><em>What if connection between On-Prem to AWS goes down?</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-connection-between-aws-to-azure-goes-down"><em>What if connection between AWS to Azure goes down?</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-4-route-filtering">Lab 3.4 - Route Filtering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-5-macro-segmentation">Lab 3.5 - Macro-Segmentation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-3-6-micro-segmentation-with-distributed-cloud-firewall">Lab 3.6 - Micro-Segmentation with Distributed Cloud Firewall</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-lab-3">End of Lab 3</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aviatrix Flight School
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>