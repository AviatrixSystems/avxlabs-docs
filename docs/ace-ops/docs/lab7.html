
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab 7 - Aviatrix Cloud Firewall &#8212; ACE Operations Lab</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=1d85937c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/lab7';</script>
    <link rel="icon" href="../_static/aviatrix-favicon-32.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab 8 - Distributed Cloud Firewall" href="lab8.html" />
    <link rel="prev" title="Lab 6 - Site2Cloud" href="lab6.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Aviatrix_Logo_White_Gradient_RGB.svg" class="logo__image only-light" alt="ACE Operations Lab - Home"/>
    <script>document.write(`<img src="../_static/Aviatrix_Logo_White_Gradient_RGB.svg" class="logo__image only-dark" alt="ACE Operations Lab - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="home.html">
                    Welcome to ACE Operations Lab
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pod.html">POD Portal</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab1.html">Lab 1 - Network Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">Lab 2 - Connection Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">Lab 3 - FireNet - Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">Lab 4 - FireNet - Routes</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab5.html">Lab 5 - Routes Manipulation &amp; NAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab6.html">Lab 6 - Site2Cloud</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab 7 - Aviatrix Cloud Firewall</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab8.html">Lab 8 - Distributed Cloud Firewall</a></li>
<li class="toctree-l1"><a class="reference internal" href="pdfs.html">PDFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="CloudHeroes.html">CLOUD NETWORKING HEROES PROGRAM</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/lab7.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 7 - Aviatrix Cloud Firewall</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario">1. SCENARIO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-request">2. CHANGE REQUEST</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distributed-cloud-firewall">2.1 Distributed Cloud Firewall</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dcf-activation">2.1.1 DCF - Activation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ad-hoc-greenfield-rule">2.1.2 Ad-hoc Greenfield-Rule</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smart-groups">2.2 Smart Groups</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#updating-the-greenfield-rule">2.2.1 Updating the Greenfield Rule</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#egress-analyze-section">2.2.2 Egress - Analyze section</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dcf-rules">2.3 DCF Rules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ztna">2.4 ZTNA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#access-from-bu1-frontend-to-database-vms-bonus">2.5 ACCESS FROM BU1 FRONTEND TO DATABASE VMs <span style="color:#33ECFF">(BONUS)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#webgroup">2.6 WebGroup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-dcf-rules">2.7 NEW DCF RULES</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verification-using-gatus">2.8 Verification Using Gatus</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verification-using-ssh-client-bonus">2.9 Verification Using SSH client <span style="color:#33ECFF">(BONUS)</span></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-7-aviatrix-cloud-firewall">
<h1>Lab 7 - Aviatrix Cloud Firewall<a class="headerlink" href="#lab-7-aviatrix-cloud-firewall" title="Link to this heading">#</a></h1>
<p>In this lab you will activate the <code class="docutils literal notranslate"><span class="pre">Aviatrix</span> <span class="pre">Cloud</span> <span class="pre">Firewall</span></code>, a cloud-native security solution that provides distributed firewalling, traffic control, and network segmentation. Unlike centralized traditional firewalls, it simplifies security management across multi-cloud environments, automates policy enforcement, and can operate in either learning or enforcement modes, offering flexibility for securing both egress and east–west traffic.</p>
<section id="scenario">
<h2>1. SCENARIO<a class="headerlink" href="#scenario" title="Link to this heading">#</a></h2>
<p>The database VNet owner requires that prohibited egress traffic be dropped. Please review egress traffic for <strong>BU1-DB</strong> and <strong>BU2-DB</strong> and ensure any restricted destinations are blocked.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/lab7-topology.png"><img alt="../_images/lab7-topology.png" src="../_images/lab7-topology.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 235 </span><span class="caption-text">Lab 7 Scenario Topology</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In your POD Portal, open the Gatus Dashboard for <strong>BU1-DB</strong> and <strong>BU2-DB</strong> and examine the <code class="docutils literal notranslate"><span class="pre">External</span></code> section to identify prohibited traffic.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/lab7-newgatus01.png"><img alt="../_images/lab7-newgatus01.png" src="../_images/lab7-newgatus01.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 236 </span><span class="caption-text">BU1-DB Gatus</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/lab7-newgatus02.png"><img alt="../_images/lab7-newgatus02.png" src="../_images/lab7-newgatus02.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 237 </span><span class="caption-text">BU2-DB Gatus</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Even though the two virtual machines are deployed in private subnets, they can still access the public internet because the <code class="docutils literal notranslate"><span class="pre">Egress</span></code> feature was enabled when the POD was launched.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">Local</span> <span class="pre">Egress</span></code> is enabled, <strong>SNAT</strong> is automatically turned on. As a result, all outbound traffic from the Spoke VPC/VNet is translated to use the gateway’s public IP address. In addition, the VPC/VNet’s default route (<strong>0.0.0.0/0</strong>) is updated to point to the Spoke gateway.</p>
</div>
<ul class="simple">
<li><p>Navigate to <strong>CoPilot &gt; Security &gt; Egress &gt; Egress VPC/VNets</strong>. You’ll see that both <strong><em>ace-azure-east-us-spoke1</em></strong> and <strong><em>ace-azure-east-us-spoke2</em></strong> VNets are already configured with <em>Local Egress</em> enabled.</p></li>
</ul>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../_images/lab7-newgatus03.png"><img alt="../_images/lab7-newgatus03.png" src="../_images/lab7-newgatus03.png" style="height: 250px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 238 </span><span class="caption-text">Cloud Secure Egress</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This action adds a <strong>default route</strong> to each private route table in the Azure spoke VNets. The routes direct traffic to the Aviatrix Spoke Gateways.</p>
<p>To verify, go to <strong>CoPilot &gt; Cloud Fabric &gt; Gateways &gt; Spoke Gateways</strong>, select a spoke gateway (for example, ace-azure-east-us-spoke2), then open the <code class="docutils literal notranslate"><span class="pre">VPC/VNet</span> <span class="pre">Route</span> <span class="pre">Tables</span></code> tab. From the Route Table drop-down, select any private route table.</p>
<figure class="align-center" id="id5">
<img alt="../_images/lab7-defaultroute.png" src="../_images/lab7-defaultroute.png" />
<figcaption>
<p><span class="caption-number">Fig. 239 </span><span class="caption-text">Default Route injected by the AVX Controller</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
</section>
<section id="change-request">
<h2>2. CHANGE REQUEST<a class="headerlink" href="#change-request" title="Link to this heading">#</a></h2>
<section id="distributed-cloud-firewall">
<h3>2.1 Distributed Cloud Firewall<a class="headerlink" href="#distributed-cloud-firewall" title="Link to this heading">#</a></h3>
<p>To control and enforce egress traffic, you must enable the <code class="docutils literal notranslate"><span class="pre">Distributed</span> <span class="pre">Cloud</span> <span class="pre">Firewall</span></code>.</p>
<section id="dcf-activation">
<h4>2.1.1 DCF - Activation<a class="headerlink" href="#dcf-activation" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Enable the <strong>Distributed Cloud Firewall</strong> feature.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Navigate to <strong>CoPilot &gt; Security &gt; Distributed Cloud Firewall</strong>, click <code class="docutils literal notranslate"><span class="pre">Begin</span> <span class="pre">Using</span> <span class="pre">Distributed</span> <span class="pre">Cloud</span> <span class="pre">Firewall</span></code>, and then click <code class="docutils literal notranslate"><span class="pre">Begin</span></code> on the next screen.</p>
</div>
<figure class="align-center" id="id6">
<img alt="../_images/lab7-enabledcf01.png" src="../_images/lab7-enabledcf01.png" />
<figcaption>
<p><span class="caption-number">Fig. 240 </span><span class="caption-text">Begin Using Distributed Cloud Firewall</span><a class="headerlink" href="#id6" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id7">
<img alt="../_images/lab7-enabledcf0222.png" src="../_images/lab7-enabledcf0222.png" />
<figcaption>
<p><span class="caption-number">Fig. 241 </span><span class="caption-text">Begin</span><a class="headerlink" href="#id7" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The Aviatrix Controller has pushed a <code class="docutils literal notranslate"><span class="pre">Default</span> <span class="pre">Action</span> <span class="pre">Rule</span></code> permitting all traffic; you should observe the impact right away.</p>
<figure class="align-center" id="id8">
<img alt="../_images/lab7-enabledcf0411.png" src="../_images/lab7-enabledcf0411.png" />
<figcaption>
<p><span class="caption-number">Fig. 242 </span><span class="caption-text">Default Action Rule</span><a class="headerlink" href="#id8" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now, click <strong>Ruleset</strong> and select the <code class="docutils literal notranslate"><span class="pre">V1</span> <span class="pre">Policy</span> <span class="pre">List</span></code>.</p>
<figure class="align-center" id="id9">
<img alt="../_images/lab7-greenfield5666.png" src="../_images/lab7-greenfield5666.png" />
<figcaption>
<p><span class="caption-number">Fig. 243 </span><span class="caption-text">V1 Policy List</span><a class="headerlink" href="#id9" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="ad-hoc-greenfield-rule">
<h4>2.1.2 Ad-hoc Greenfield-Rule<a class="headerlink" href="#ad-hoc-greenfield-rule" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Create a new rule clicking on the <strong>“+ Rule”</strong> button.</p></li>
</ul>
<figure class="align-center" id="id10">
<img alt="../_images/lab7-greenfield56661.png" src="../_images/lab7-greenfield56661.png" />
<figcaption>
<p><span class="caption-number">Fig. 244 </span><span class="caption-text">New Rule</span><a class="headerlink" href="#id10" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Enter the following parameters:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>Greenfield-Rule</span></p></li>
<li><p><strong>Source Smartgroups</strong>: <span style='color:#479608'>Anywhere(0.0.0.0/0)</span></p></li>
<li><p><strong>Destination Smartgroups</strong>: <span style='color:#479608'>Anywhere(0.0.0.0/0)</span></p></li>
<li><p><strong>Protocol</strong>: <span style='color:#479608'>Any</span></p></li>
<li><p><strong>Logging</strong>: <span style='color:#479608'><strong>On</strong></span></p></li>
<li><p><strong>Action</strong>: <span style='color:#479608'>Permit</span></p></li>
</ul>
<p>Do not forget to click on <strong>Save In Drafts</strong>.</p>
<figure class="align-center" id="id11">
<img alt="../_images/lab7-greenfield566612.png" src="../_images/lab7-greenfield566612.png" />
<figcaption>
<p><span class="caption-number">Fig. 245 </span><span class="caption-text">Greenfield-Rule</span><a class="headerlink" href="#id11" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Click on <strong>Commit</strong>.</p>
<figure class="align-center" id="id12">
<img alt="../_images/lab7-greenfield5666123.png" src="../_images/lab7-greenfield5666123.png" />
<figcaption>
<p><span class="caption-number">Fig. 246 </span><span class="caption-text">Commit</span><a class="headerlink" href="#id12" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="smart-groups">
<h3>2.2 Smart Groups<a class="headerlink" href="#smart-groups" title="Link to this heading">#</a></h3>
<p>Create three Smart Groups to identify:</p>
<ol class="arabic simple">
<li><p><strong>BU1 Frontend</strong></p></li>
<li><p><strong>BU1 DB</strong></p></li>
<li><p><strong>BU2 DB</strong></p></li>
</ol>
<ul class="simple">
<li><p>Navigate to <strong>CoPilot &gt; Groups &gt; SmartGroups</strong>, then click the <code class="docutils literal notranslate"><span class="pre">“+</span> <span class="pre">SmartGroup”</span></code> button.</p></li>
</ul>
<figure class="align-center" id="id13">
<img alt="../_images/lab7-SGnew00.png" src="../_images/lab7-SGnew00.png" />
<figcaption>
<p><span class="caption-number">Fig. 247 </span><span class="caption-text">SmartGroup</span><a class="headerlink" href="#id13" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">SmartGroup&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>BU1-FRONTEND</span></p></li>
<li><p><strong>Matches all conditions (AND)/Name</strong>: <span style='color:#479608'>ace-aws-eu-west-1-spoke1-bu1-frontend</span></p></li>
</ul>
<figure class="align-center" id="id14">
<img alt="../_images/lab7-smart3.png" src="../_images/lab7-smart3.png" />
<figcaption>
<p><span class="caption-number">Fig. 248 </span><span class="caption-text">Name = ace-aws-eu-west-1-spoke1-bu1-frontend</span><a class="headerlink" href="#id14" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Before clicking <strong>Save</strong>, enable <code class="docutils literal notranslate"><span class="pre">&quot;Preview&quot;</span></code> to identify which instances match the condition.</p>
<figure class="align-center" id="id15">
<img alt="../_images/lab7-smart31.png" src="../_images/lab7-smart31.png" />
<figcaption>
<p><span class="caption-number">Fig. 249 </span><span class="caption-text">Resource Selection</span><a class="headerlink" href="#id15" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id16">
<img alt="../_images/lab7-smart311.png" src="../_images/lab7-smart311.png" />
<figcaption>
<p><span class="caption-number">Fig. 250 </span><span class="caption-text">Preview</span><a class="headerlink" href="#id16" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The CoPilot shows that there is one instance that perfectly matches the condition:</p>
<ul class="simple">
<li><p><strong><em>ace-aws-eu-west-1-spoke1-bu1-frontend</em></strong></p></li>
</ul>
<p>Create another Smart Group by clicking the <code class="docutils literal notranslate"><span class="pre">“+</span> <span class="pre">SmartGroup”</span></code> button again.</p>
<figure class="align-center" id="id17">
<img alt="../_images/lab7-SGnew10.png" src="../_images/lab7-SGnew10.png" />
<figcaption>
<p><span class="caption-number">Fig. 251 </span><span class="caption-text">SmartGroup</span><a class="headerlink" href="#id17" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">SmartGroup&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>BU1-DB</span></p></li>
<li><p><strong>Matches all conditions (AND)/Name</strong>: <span style='color:#479608'>ace-azure-east-us-spoke1-bu1-db</span></p></li>
</ul>
<figure class="align-center" id="id18">
<img alt="../_images/lab7-smart3.png" src="../_images/lab7-smart3.png" />
<figcaption>
<p><span class="caption-number">Fig. 252 </span><span class="caption-text">Name = ace-azure-east-us-spoke1-bu1-db</span><a class="headerlink" href="#id18" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Before clicking <strong>Save</strong>, enable <code class="docutils literal notranslate"><span class="pre">&quot;Preview&quot;</span></code> to identify which instances match the condition.</p>
<figure class="align-center" id="id19">
<img alt="../_images/lab7-smart41.png" src="../_images/lab7-smart41.png" />
<figcaption>
<p><span class="caption-number">Fig. 253 </span><span class="caption-text">Resource Selection</span><a class="headerlink" href="#id19" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id20">
<img alt="../_images/lab7-smart411.png" src="../_images/lab7-smart411.png" />
<figcaption>
<p><span class="caption-number">Fig. 254 </span><span class="caption-text">Preview</span><a class="headerlink" href="#id20" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The CoPilot shows that there is one instance that perfectly matches the condition:</p>
<ul class="simple">
<li><p><strong><em>ace-azure-east-us-spoke1-bu1-db</em></strong></p></li>
</ul>
<p>Add another Smart Group by tapping the <code class="docutils literal notranslate"><span class="pre">“+</span> <span class="pre">SmartGroup”</span></code> one more time.</p>
<figure class="align-center" id="id21">
<img alt="../_images/lab7-SGnew20.png" src="../_images/lab7-SGnew20.png" />
<figcaption>
<p><span class="caption-number">Fig. 255 </span><span class="caption-text">SmartGroup</span><a class="headerlink" href="#id21" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">SmartGroup&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>BU2-DB</span></p></li>
<li><p><strong>Matches all conditions (AND)/Name</strong>: <span style='color:#479608'>ace-azure-east-us-spoke2-bu2-db</span></p></li>
</ul>
<figure class="align-center" id="id22">
<img alt="../_images/lab7-smart3.png" src="../_images/lab7-smart3.png" />
<figcaption>
<p><span class="caption-number">Fig. 256 </span><span class="caption-text">Name = ace-azure-east-us-spoke2-bu2-db</span><a class="headerlink" href="#id22" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Before clicking <strong>Save</strong>, enable <code class="docutils literal notranslate"><span class="pre">&quot;Preview&quot;</span></code> to identify which instances match the condition.</p>
<figure class="align-center" id="id23">
<img alt="../_images/lab7-smart51.png" src="../_images/lab7-smart51.png" />
<figcaption>
<p><span class="caption-number">Fig. 257 </span><span class="caption-text">Resource Selection</span><a class="headerlink" href="#id23" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id24">
<img alt="../_images/lab7-smart511.png" src="../_images/lab7-smart511.png" />
<figcaption>
<p><span class="caption-number">Fig. 258 </span><span class="caption-text">Preview</span><a class="headerlink" href="#id24" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The CoPilot shows that there is one instance that perfectly matches the condition:</p>
<ul class="simple">
<li><p><strong><em>ace-azure-east-us-spoke2-bu2-db</em></strong></p></li>
</ul>
<section id="updating-the-greenfield-rule">
<h4>2.2.1 Updating the Greenfield Rule<a class="headerlink" href="#updating-the-greenfield-rule" title="Link to this heading">#</a></h4>
<p>Navigate to <strong>CoPilot &gt; Security &gt; Distributed Cloud Firewall</strong>, and click the <code class="docutils literal notranslate"><span class="pre">pencil</span> <span class="pre">icon</span></code> beside the <strong>Greenfield Rule</strong> to update its configuration.</p>
<figure class="align-center" id="id25">
<a class="reference internal image-reference" href="../_images/lab7-green00.png"><img alt="../_images/lab7-green00.png" src="../_images/lab7-green00.png" style="height: 200px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 259 </span><span class="caption-text">Edit the Greenfiled-Rule</span><a class="headerlink" href="#id25" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Select the <code class="docutils literal notranslate"><span class="pre">&quot;All-Web&quot;</span></code> WebGroup from the <strong><em>WebGroups</em></strong> field, then click <strong>“Save In Drafts”</strong>.</p>
<figure class="align-center" id="id26">
<img alt="../_images/lab7-green01.png" src="../_images/lab7-green01.png" />
<figcaption>
<p><span class="caption-number">Fig. 260 </span><span class="caption-text">All-Web</span><a class="headerlink" href="#id26" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Applying the <code class="docutils literal notranslate"><span class="pre">All-Web</span></code>  WebGroup to the Greenfield rule enables logging of the FQDNs accessed, specifically in the Egress section.</p>
</div>
<p>Proceed by enforcing the policy in the data plane and click <strong>Commit</strong>. From this point onward, East–West traffic will be blocked. However, you will still be able to intercept traffic generated by both databases, thanks to the WebGroup applied to the Greenfield-Rule.</p>
<figure class="align-center" id="id27">
<img alt="../_images/lab7-green02.png" src="../_images/lab7-green02.png" />
<figcaption>
<p><span class="caption-number">Fig. 261 </span><span class="caption-text">Commit</span><a class="headerlink" href="#id27" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="egress-analyze-section">
<h4>2.2.2 Egress - Analyze section<a class="headerlink" href="#egress-analyze-section" title="Link to this heading">#</a></h4>
<p>Now that the Distributed Cloud Firewall is enabled, we can gather useful insights from the Egress section. Navigate to <strong>Security &gt; Egress &gt; Analyze</strong>, and in <code class="docutils literal notranslate"><span class="pre">Top</span> <span class="pre">Domains</span></code>, identify the domains that are being blocked.</p>
<figure class="align-center" id="id28">
<a class="reference internal image-reference" href="../_images/lab7-green02aa.png"><img alt="../_images/lab7-green02aa.png" src="../_images/lab7-green02aa.png" style="height: 450px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 262 </span><span class="caption-text">Analyze</span><a class="headerlink" href="#id28" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Block the following domains and allow all others:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.ransomware.org">www.ransomware.org</a></p></li>
<li><p><a class="reference external" href="http://www.botnet.com">www.botnet.com</a></p></li>
<li><p><a class="reference external" href="http://www.malware.com">www.malware.com</a></p></li>
</ul>
</section>
</section>
<section id="dcf-rules">
<h3>2.3 DCF Rules<a class="headerlink" href="#dcf-rules" title="Link to this heading">#</a></h3>
<p>Let’s add two more rules to permit SSH traffic from the <strong>BU1 Frontend</strong> to the DB VMs.</p>
<p>Navigate to <strong>Security &gt; Distributed Cloud Firewall</strong>, then click <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">Rule&quot;</span></code>.</p>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">Rule&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>inter-ssh-bu1frontend-bu1db</span></p></li>
<li><p><strong>Source Smartgroups</strong>: <span style='color:#479608'>BU1-FRONTEND</span></p></li>
<li><p><strong>Destination Smartgroups</strong>: <span style='color:#479608'>BU1-DB</span></p></li>
<li><p><strong>Protocol</strong>: <span style='color:#479608'>TCP</span></p></li>
<li><p><strong>PORT</strong>: <span style='color:#479608'>22</span></p></li>
<li><p><strong>Logging</strong>: <span style='color:#479608'>On</span></p></li>
<li><p><strong>Action</strong>: <span style='color:#479608'><strong>Permit</strong></span></p></li>
</ul>
<p>Do not forget to click on <strong>Save In Drafts</strong>.</p>
<figure class="align-center" id="id29">
<img alt="../_images/lab7-interssh001.png" src="../_images/lab7-interssh001.png" />
<figcaption>
<p><span class="caption-number">Fig. 263 </span><span class="caption-text">inter-ssh</span><a class="headerlink" href="#id29" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Before clicking <strong>Commit</strong>, continue adding a new DCF Rule by clicking <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">Rule&quot;</span></code>.</p>
<figure class="align-center" id="id30">
<img alt="../_images/lab7-green03.png" src="../_images/lab7-green03.png" />
<figcaption>
<p><span class="caption-number">Fig. 264 </span><span class="caption-text">+Rule</span><a class="headerlink" href="#id30" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">Rule&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>inter-ssh-bu1frontend-bu2db</span></p></li>
<li><p><strong>Source Smartgroups</strong>: <span style='color:#479608'>BU1-FRONTEND</span></p></li>
<li><p><strong>Destination Smartgroups</strong>: <span style='color:#479608'>BU2-DB</span></p></li>
<li><p><strong>Protocol</strong>: <span style='color:#479608'>TCP</span></p></li>
<li><p><strong>PORT</strong>: <span style='color:#479608'>22</span></p></li>
<li><p><strong>Logging</strong>: <span style='color:#479608'>On</span></p></li>
<li><p><strong>Action</strong>: <span style='color:#479608'><strong>Permit</strong></span></p></li>
</ul>
<p>Do not forget to click on <strong>Save In Drafts</strong>.</p>
<figure class="align-center" id="id31">
<img alt="../_images/lab7-interssh002.png" src="../_images/lab7-interssh002.png" />
<figcaption>
<p><span class="caption-number">Fig. 265 </span><span class="caption-text">inter-ssh</span><a class="headerlink" href="#id31" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>You can now proceed and click <strong>Commit</strong> to enforce the policies in the data plane.</p>
<figure class="align-center" id="id32">
<img alt="../_images/lab7-interssh0023.png" src="../_images/lab7-interssh0023.png" />
<figcaption>
<p><span class="caption-number">Fig. 266 </span><span class="caption-text">Commit</span><a class="headerlink" href="#id32" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Once again, the last two policies enable secure SSH access from the BU1 Frontend to the Azure database VMs hosted in private subnets. Because these VMs have no public IP addresses, direct SSH access from your laptop is not possible.</p>
</div>
</section>
<section id="ztna">
<h3>2.4 ZTNA<a class="headerlink" href="#ztna" title="Link to this heading">#</a></h3>
<p>Now let’s enable the <code class="docutils literal notranslate"><span class="pre">Zero</span> <span class="pre">Trust</span></code> control by creating an explicit deny rule, which must be placed above the greenfield rule.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Zero trust</strong> in networking is a security approach that “trusts no one by default,” whether inside or outside the network perimeter. Instead of assuming that users or devices inside the network are trustworthy, it requires strict verification for every access attempt and continuous evaluation of risk.</p>
</div>
<ul class="simple">
<li><p>Clicking the <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">Rule&quot;</span></code> button.</p></li>
</ul>
<figure class="align-center" id="id33">
<img alt="../_images/lab7-green53.png" src="../_images/lab7-green53.png" />
<figcaption>
<p><span class="caption-number">Fig. 267 </span><span class="caption-text">+Rule</span><a class="headerlink" href="#id33" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">Rule&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>ExplicitDenyAll</span></p></li>
<li><p><strong>Source Smartgroups</strong>: <span style='color:#479608'>Anywhere (0.0.0.0/0)</span></p></li>
<li><p><strong>Destination Smartgroups</strong>: <span style='color:#479608'>Anywhere (0.0.0.0/0)</span></p></li>
<li><p><strong>Protocol</strong>: <span style='color:#479608'>Any</span></p></li>
<li><p><strong>Logging</strong>: <span style='color:#479608'><strong>On</strong></span></p></li>
<li><p><strong>Action</strong>: <span style='color:#479608'><strong>Deny</strong></span></p></li>
<li><p><strong>Place Rule</strong>: <span style='color:#479608'>Below</span></p>
<ul>
<li><p><strong>Existing Rule</strong>: <span style='color:#479608'>inter-ssh-bu1frontend-bu1db</span></p></li>
</ul>
</li>
</ul>
<p>Do not forget to click on <strong>Save In Drafts</strong>.</p>
<figure class="align-center" id="id34">
<img alt="../_images/lab7-exdeall.png" src="../_images/lab7-exdeall.png" />
<figcaption>
<p><span class="caption-number">Fig. 268 </span><span class="caption-text">ExplicitDenyAll</span><a class="headerlink" href="#id34" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Click <strong>Commit</strong> to enforce the policies in the data plane.</p>
<figure class="align-center" id="id35">
<a class="reference internal image-reference" href="../_images/lab7-xdeall00.png"><img alt="../_images/lab7-xdeall00.png" src="../_images/lab7-xdeall00.png" style="height: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 269 </span><span class="caption-text">Commit</span><a class="headerlink" href="#id35" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="access-from-bu1-frontend-to-database-vms-bonus">
<h3>2.5 ACCESS FROM BU1 FRONTEND TO DATABASE VMs <span style='color:#33ECFF'>(BONUS)</span></summary><a class="headerlink" href="#access-from-bu1-frontend-to-database-vms-bonus" title="Link to this heading">#</a></h3>
<p>Let’s verify the East–West traffic communication between the <strong>BU1 Frontend</strong> and the database VMs in Azure.</p>
<ul class="simple">
<li><p>SSH into the <strong>BU1 Frontend</strong> (retrieve its public IP address from either the <code class="docutils literal notranslate"><span class="pre">Topology</span></code> view or the <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Workloads</span></code> section). Then SSH to the private IP address of <strong>BU1 DB</strong> first, and then to <strong>BU2 DB</strong>.</p></li>
</ul>
<figure class="align-center" id="id36">
<a class="reference internal image-reference" href="../_images/lab7-sshbu2db.png"><img alt="../_images/lab7-sshbu2db.png" src="../_images/lab7-sshbu2db.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 270 </span><span class="caption-text">BU1 DB</span><a class="headerlink" href="#id36" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Navigate to <strong>CoPilot &gt; Security &gt; Distributed Cloud Firewall &gt; Monitor</strong> and search for <code class="docutils literal notranslate"><span class="pre">inter-ssh-bu1frontend-bu1db</span></code>. You’ll see that the policy was triggered by the SSH attempt you initiated from <strong>BU1 Frontend</strong> to <strong>BU1 DB</strong>.</p>
<figure class="align-center" id="id37">
<a class="reference internal image-reference" href="../_images/lab7-test-logs02.png"><img alt="../_images/lab7-test-logs02.png" src="../_images/lab7-test-logs02.png" style="height: 450px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 271 </span><span class="caption-text">inter-ssh-bu1frontend-bu1db</span><a class="headerlink" href="#id37" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Repeat the same check: try to SSH from <strong>BU1 Frontend</strong> to <strong>BU2 DB</strong>, then verify that the corresponding logs appear in the Monitor section of the <strong>Distributed Cloud Firewall</strong>.</p>
</div>
</section>
<section id="webgroup">
<h3>2.6 WebGroup<a class="headerlink" href="#webgroup" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Create two <strong>WebGroup</strong> that match the <em>allowed domains</em> identified previously.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Navigate to <strong>CoPilot &gt; Groups &gt; WebGroups</strong> and then click on <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">WebGroup&quot;</span></code>.</p>
<figure class="align-center" id="id38">
<img alt="../_images/lab7-webgroupp.png" src="../_images/lab7-webgroupp.png" />
<figcaption>
<p><span class="caption-number">Fig. 272 </span><span class="caption-text">WebGroup</span><a class="headerlink" href="#id38" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">WebGroup&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>bu1-allowed-domains</span></p></li>
<li><p><strong>Type</strong>: <span style='color:#479608'>Domains</span></p></li>
<li><p><strong>Domains/URLs</strong>: <span style='color:#479608'> <a class="reference external" href="http://www.digitalocean.com">www.digitalocean.com</a></span></p></li>
<li><p><strong>Domains/URLs</strong>: <span style='color:#479608'> <a class="reference external" href="http://www.microsoft.com">www.microsoft.com</a></span></p></li>
<li><p><strong>Domains/URLs</strong>: <span style='color:#479608'> <a class="reference external" href="http://www.terraform.com">www.terraform.com</a></span></p></li>
</ul>
<p>then click on <strong>Save</strong>.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>These are the domains identified before using the <code class="docutils literal notranslate"><span class="pre">Discovery</span> <span class="pre">Mode</span></code> (<strong>= Greenfield-Rule + All-Web</strong>).</p>
<figure class="align-center" id="id39">
<a class="reference internal image-reference" href="../_images/lab7-webgroup.png"><img alt="../_images/lab7-webgroup.png" src="../_images/lab7-webgroup.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 273 </span><span class="caption-text">bu1-allowed-domains</span><a class="headerlink" href="#id39" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<p>Let’s create another WebGroup—click the <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">WebGroup&quot;</span></code> button.</p>
<figure class="align-center" id="id40">
<img alt="../_images/lab7-webgrouppnew.png" src="../_images/lab7-webgrouppnew.png" />
<figcaption>
<p><span class="caption-number">Fig. 274 </span><span class="caption-text">A new WebGroup</span><a class="headerlink" href="#id40" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">WebGroup&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>bu2-allowed-domains</span></p></li>
<li><p><strong>Type</strong>: <span style='color:#479608'>Domains</span></p></li>
<li><p><strong>Domains/URLs</strong>: <span style='color:#479608'> cloud.google.com</span></p></li>
<li><p><strong>Domains/URLs</strong>: <span style='color:#479608'> *.amazon.com</span></p></li>
</ul>
<p>then click on <strong>Save</strong>.</p>
<figure class="align-center" id="id41">
<a class="reference internal image-reference" href="../_images/lab7-webgroup11.png"><img alt="../_images/lab7-webgroup11.png" src="../_images/lab7-webgroup11.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 275 </span><span class="caption-text">bu2-allowed-domains</span><a class="headerlink" href="#id41" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The FQDN <em><a class="reference external" href="http://www.aws.amazon.com">www.aws.amazon.com</a></em> can be matched using the wildcard <code class="docutils literal notranslate"><span class="pre">*.aws.amazon.com</span></code>, which covers any single-label subdomain under <em><a class="reference external" href="http://aws.amazon.com">aws.amazon.com</a></em> (e.g., <em><a class="reference external" href="http://foo.aws.amazon.com">foo.aws.amazon.com</a></em>), but not the apex <em><a class="reference external" href="http://amazon.com">amazon.com</a></em>.</p>
</div>
</section>
<section id="new-dcf-rules">
<h3>2.7 NEW DCF RULES<a class="headerlink" href="#new-dcf-rules" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Now create an <code class="docutils literal notranslate"><span class="pre">inter-rule</span></code> that allows <strong>BU1 DB</strong> to access the <strong>Internet</strong> only to reach the domains defined in the <code class="docutils literal notranslate"><span class="pre">bu1-allowed-domains</span> </code>WebGroup.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Navigate to <strong>CoPilot &gt; Security &gt; Distributed Cloud Firewall &gt; Policies</strong> and click on the <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">Rule&quot;</span></code> button.</p>
</div>
<figure class="align-center" id="id42">
<a class="reference internal image-reference" href="../_images/lab7-webgroup001.png"><img alt="../_images/lab7-webgroup001.png" src="../_images/lab7-webgroup001.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 276 </span><span class="caption-text">+Rule</span><a class="headerlink" href="#id42" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">Rule&quot;</span></code>:.</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>inter-bu1db-internet</span></p></li>
<li><p><strong>Source Smartgroups</strong>: <span style='color:#479608'>BU1-DB</span></p></li>
<li><p><strong>Destination Smartgroups</strong>: <span style='color:#479608'>Public internet</span></p></li>
<li><p><strong>WebGroups</strong>: <span style='color:#479608'>bu1-allowed-domains</span></p></li>
<li><p><strong>Protocol</strong>: <span style='color:#479608'>Any</span></p></li>
<li><p><strong>Logging</strong>: <span style='color:#479608'>On</span></p></li>
<li><p><strong>Action</strong>: <span style='color:#479608'><strong>Permit</strong></span></p></li>
</ul>
<p>Do not forget to click on <strong>Save In Drafts</strong>, and then <strong>Commit</strong> your rule once again!</p>
<figure class="align-center" id="id43">
<img alt="../_images/lab7-lastrule.png" src="../_images/lab7-lastrule.png" />
<figcaption>
<p><span class="caption-number">Fig. 277 </span><span class="caption-text">inter-bu1db-internet</span><a class="headerlink" href="#id43" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id44">
<img alt="../_images/lab7-lastcommit.png" src="../_images/lab7-lastcommit.png" />
<figcaption>
<p><span class="caption-number">Fig. 278 </span><span class="caption-text">DCF rules list</span><a class="headerlink" href="#id44" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Create another <code class="docutils literal notranslate"><span class="pre">inter-rule</span></code> that allows <strong>BU2 DB</strong> to access the <strong>Internet</strong> only for the domains defined in the <code class="docutils literal notranslate"><span class="pre">bu2-allowed-domains</span></code> WebGroup.</p></li>
</ul>
<figure class="align-center" id="id45">
<a class="reference internal image-reference" href="../_images/lab7-webgroup0012.png"><img alt="../_images/lab7-webgroup0012.png" src="../_images/lab7-webgroup0012.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 279 </span><span class="caption-text">+Rule</span><a class="headerlink" href="#id45" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">Rule&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>inter-bu2db-internet</span></p></li>
<li><p><strong>Source Smartgroups</strong>: <span style='color:#479608'>BU1-DB</span></p></li>
<li><p><strong>Destination Smartgroups</strong>: <span style='color:#479608'>Public internet</span></p></li>
<li><p><strong>WebGroups</strong>: <span style='color:#479608'>bu2-allowed-domains</span></p></li>
<li><p><strong>Protocol</strong>: <span style='color:#479608'>Any</span></p></li>
<li><p><strong>Logging</strong>: <span style='color:#479608'>On</span></p></li>
<li><p><strong>Action</strong>: <span style='color:#479608'><strong>Permit</strong></span></p></li>
</ul>
<p>Do not forget to click on <strong>Save In Drafts</strong>, and then <strong>Commit</strong>.</p>
<figure class="align-center" id="id46">
<img alt="../_images/lab7-lastrule22.png" src="../_images/lab7-lastrule22.png" />
<figcaption>
<p><span class="caption-number">Fig. 280 </span><span class="caption-text">inter-bu2db-internet</span><a class="headerlink" href="#id46" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id47">
<img alt="../_images/lab7-lastcommit.png" src="../_images/lab7-lastcommit.png" />
<figcaption>
<p><span class="caption-number">Fig. 281 </span><span class="caption-text">DCF rules list</span><a class="headerlink" href="#id47" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="verification-using-gatus">
<h3>2.8 Verification Using Gatus<a class="headerlink" href="#verification-using-gatus" title="Link to this heading">#</a></h3>
<p>Review the Gatus dashboards for both <strong>BU1 DB</strong> and <strong>BU2 DB</strong>.</p>
<p><strong>BU1-DB</strong> will be able to reach <em><a class="reference external" href="http://www.digitalocean.com">www.digitalocean.com</a></em>, <em><a class="reference external" href="http://www.microsoft.com">www.microsoft.com</a></em>, and <em><a class="reference external" href="http://www.terraform.com">www.terraform.com</a></em>. The domain <em><a class="reference external" href="http://www.ransomware.org">www.ransomware.org</a></em> will be blocked.</p>
<figure class="align-center" id="id48">
<a class="reference internal image-reference" href="../_images/lab7-newgatus02new012.png"><img alt="../_images/lab7-newgatus02new012.png" src="../_images/lab7-newgatus02new012.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 282 </span><span class="caption-text">BU1-DB Gatus</span><a class="headerlink" href="#id48" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><strong>BU2-DB</strong> will be able to access the following sites: <em><a class="reference external" href="http://www.google.com">www.google.com</a></em>, <em><a class="reference external" href="http://www.aws.amazon.com">www.aws.amazon.com</a></em>, and <em><a class="reference external" href="http://www.terraform.com">www.terraform.com</a></em>. The domains <em><a class="reference external" href="http://www.botnet.com">www.botnet.com</a></em> and <em><a class="reference external" href="http://www.malware.net">www.malware.net</a></em> will be blocked.</p>
<figure class="align-center" id="id49">
<a class="reference internal image-reference" href="../_images/lab7-newgatus02new022.png"><img alt="../_images/lab7-newgatus02new022.png" src="../_images/lab7-newgatus02new022.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 283 </span><span class="caption-text">BU2-DB Gatus</span><a class="headerlink" href="#id49" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="verification-using-ssh-client-bonus">
<h3>2.9 Verification Using SSH client <span style='color:#33ECFF'>(BONUS)</span></summary><a class="headerlink" href="#verification-using-ssh-client-bonus" title="Link to this heading">#</a></h3>
<p>With the BU1 SSH session active, please execute the curl commands toward the following domains:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>www.digitalocean.com

www.microsoft.com

www.terraform.com

www.ransomware.org
</pre></div>
</div>
<p>With the BU2 SSH session active, please execute the curl commands toward the following domains:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>www.aws.amazon.com

www.terraform.com

wwww.botnet.com<span class="w"> </span>

www.malware.net
</pre></div>
</div>
<ul class="simple">
<li><p>Now check the logs within the <strong>Egress</strong> section!</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Navigate to <strong>CoPilot &gt; Security &gt; Egress &gt; FQDN Monitor (Legacy)</strong> and select the <strong>ace-azure-east-us-spoke2</strong> VNet, then filter by <code class="docutils literal notranslate"><span class="pre">&quot;Allowed&quot;</span></code>.</p>
</div>
<figure class="align-center" id="id50">
<a class="reference internal image-reference" href="../_images/lab7-last.png"><img alt="../_images/lab7-last.png" src="../_images/lab7-last.png" style="height: 250px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 284 </span><span class="caption-text">ace-azure-east-us-spoke2</span><a class="headerlink" href="#id50" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id51">
<a class="reference internal image-reference" href="../_images/lab7-lastlog.png"><img alt="../_images/lab7-lastlog.png" src="../_images/lab7-lastlog.png" style="height: 450px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 285 </span><span class="caption-text">Allowed domains!</span><a class="headerlink" href="#id51" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In the logs, you’ll probably see an allowed entry for <code class="docutils literal notranslate"><span class="pre">&quot;api.snapcraft.io&quot;</span></code>. This domain was allowed <ins>before </ins>applying the ExplicitDenyAll rule and the specific inter-rule that uses the <code class="docutils literal notranslate"><span class="pre">ubuntu-update</span></code> WebGroup.</p>
</div>
<p>You have successfully applied Secure Egress Control, leveraging both the <code class="docutils literal notranslate"><span class="pre">Egress</span></code> feature and the <code class="docutils literal notranslate"><span class="pre">Distributed</span> <span class="pre">Cloud</span> <span class="pre">Firewall</span></code> policy.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lab6.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab 6 - Site2Cloud</p>
      </div>
    </a>
    <a class="right-next"
       href="lab8.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab 8 - Distributed Cloud Firewall</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario">1. SCENARIO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-request">2. CHANGE REQUEST</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distributed-cloud-firewall">2.1 Distributed Cloud Firewall</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dcf-activation">2.1.1 DCF - Activation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ad-hoc-greenfield-rule">2.1.2 Ad-hoc Greenfield-Rule</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smart-groups">2.2 Smart Groups</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#updating-the-greenfield-rule">2.2.1 Updating the Greenfield Rule</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#egress-analyze-section">2.2.2 Egress - Analyze section</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dcf-rules">2.3 DCF Rules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ztna">2.4 ZTNA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#access-from-bu1-frontend-to-database-vms-bonus">2.5 ACCESS FROM BU1 FRONTEND TO DATABASE VMs <span style="color:#33ECFF">(BONUS)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#webgroup">2.6 WebGroup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-dcf-rules">2.7 NEW DCF RULES</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verification-using-gatus">2.8 Verification Using Gatus</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verification-using-ssh-client-bonus">2.9 Verification Using SSH client <span style="color:#33ECFF">(BONUS)</span></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aviatrix ACE
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>