
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab 5 - AVIATRIX CLOUD FIREWALL (with Secure Egress) &#8212; ACE Operations Lab</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=1d85937c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/lab5';</script>
    <link rel="icon" href="../_static/aviatrix-favicon-32.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab 6 - FIRENET" href="lab6.html" />
    <link rel="prev" title="Lab 4 - HPE WITH ACTIVE MESH" href="lab4.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Aviatrix_Logo_White_Gradient_RGB.svg" class="logo__image only-light" alt="ACE Operations Lab - Home"/>
    <script>document.write(`<img src="../_static/Aviatrix_Logo_White_Gradient_RGB.svg" class="logo__image only-dark" alt="ACE Operations Lab - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="home.html">
                    Welcome to ACE Professional Lab
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pod.html">POD Portal</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab1.html">Lab 1 - VPCs/VNets CREATION</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">Lab 2 - TRANSIT NETWORKING</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">Lab 3 - NETWORK SEGMENTATION</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">Lab 4 - HPE WITH ACTIVE MESH</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab 5 - AVIATRIX CLOUD FIREWALL (with Secure Egress)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab6.html">Lab 6 - FIRENET</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab7.html">Lab 7 - SITE2CLOUD</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab8.html">Lab 8 - SECURE HIGH-PERFORMANCE DATACENTER EDGE</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab9.html">Lab 9 - THREAT PREVENTION</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab10.html">Lab 10 - COSTIQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab11.html">Lab 11 - DISTRIBUTED CLOUD FIREWALL</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab12.html">Lab 12 - IAC &amp; NETWORK INSIGHTS API</a></li>
<li class="toctree-l1"><a class="reference internal" href="logos-icons.html">LOGOS-ICONS</a></li>
<li class="toctree-l1"><a class="reference internal" href="PDFs.html">PDFs</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/lab5.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 5 - AVIATRIX CLOUD FIREWALL (with Secure Egress)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objective">1. Objective</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#topology">2. Topology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-connectivity-testing">3. Preliminary Connectivity Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-connectivity-testing-using-the-gatus-app">3.1 Preliminary Connectivity Testing Using the Gatus App</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-connectivity-testing-using-the-ssh-client-bonus">3.2 Preliminary Connectivity Testing Using the SSH Client <span style="color:#33ECFF">(BONUS)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aviatrix-cloud-firewall">4. Aviatrix Cloud Firewall</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enable-the-secure-local-egress-control">4.1 Enable the Secure Local Egress Control</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-private-rtb">4.2 Inspect the Private RTB</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enable-dcf">4.3 Enable DCF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-new-smartgroup">5. Define a new SmartGroup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-the-subnet-where-the-private-workload-resides">5.1 Identify the subnet where the private workload resides</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-an-ad-hoc-smartgroup">5.2 Create an ad-hoc SmartGroup</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-dcf-rule">6. Create a new DCF Rule</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#connectivity-testing-after-enabling-the-aviatrix-cloud-firewall">7. Connectivity Testing after enabling the Aviatrix Cloud Firewall</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#connectivity-testing-using-the-gatus-app">7.1 Connectivity Testing Using the Gatus App</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#connectivity-testing-using-the-ssh-client-bonus">7.2 Connectivity Testing Using the SSH Client <span style="color:#33ECFF">(BONUS)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#egress-overview">7.3 Egress Overview</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ztna-zero-trust-network-access">8. ZTNA - Zero Trust Network Access</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-webgroup">8.1 Create a New WebGroup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-the-egress-rule">8.2 Edit the Egress-Rule</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">8.3 Connectivity Testing after enabling the Aviatrix Cloud Firewall</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">8.3.1 Connectivity Testing Using the Gatus App</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">8.3.2 Connectivity Testing Using the SSH Client <span style="color:#33ECFF">(BONUS)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monitor">9. Monitor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remotion-of-the-aws-nat-gateway">10. Remotion of the AWS NAT Gateway</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aws-console">10.1 AWS Console</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-5-aviatrix-cloud-firewall-with-secure-egress">
<h1>Lab 5 - AVIATRIX CLOUD FIREWALL (with Secure Egress)<a class="headerlink" href="#lab-5-aviatrix-cloud-firewall-with-secure-egress" title="Link to this heading">#</a></h1>
<section id="objective">
<h2>1. Objective<a class="headerlink" href="#objective" title="Link to this heading">#</a></h2>
<p>In this lab, we will demonstrate how to enable the <code class="docutils literal notranslate"><span class="pre">Aviatrix</span> <span class="pre">Cloud</span> <span class="pre">Firewall</span></code>.</p>
<p>The Aviatrix Cloud Firewall enhances cloud security with enterprise-grade NAT, centralized management, and AI-driven threat detection. It offers comprehensive visibility and control, ensuring cost efficiency with a flat-rate billing model. Seamless integration and automated deployment make it ideal for scalable, resilient cloud environments.</p>
<p>In this lab, we will identify the target VPC. Of course, the selected VPC must have at least a subnet associated witho a <strong>Private Routing table</strong> (i.e., without a default route pointing to the IGW). The Controller will reroute the traffic through the Aviatrix Spoke Gateway. The Aviatrix Cloud Firewall provides enhanced visibility and control, effectively replacing the <strong>CSP Native NAT Gateways</strong>.</p>
</section>
<section id="topology">
<h2>2. Topology<a class="headerlink" href="#topology" title="Link to this heading">#</a></h2>
<p>Let’s pinpoint the right candidate VPC where it would be possible to enable <strong>Egress Control</strong>.</p>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../_images/lab6-initialtopology.png"><img alt="../_images/lab6-initialtopology.png" src="../_images/lab6-initialtopology.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 223 </span><span class="caption-text">Lab 6 Initial Topology</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The VPC <strong>aws-us-east-2-spoke1</strong> has a private subnet in its environment, whereby the Egress Control can be activated in this specific VPC.</p>
<p>At the moment, this private subnet is leveraging the <strong>AWS NAT Gateway</strong> to reach the Internet Public Zone.</p>
<figure class="align-center" id="id5">
<img alt="../_images/lab6-privateaws.png" src="../_images/lab6-privateaws.png" />
<figcaption>
<p><span class="caption-number">Fig. 224 </span><span class="caption-text">Private Subnet and AWS NAT GW</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Explore the <strong>Routing Table</strong> to see the private subnet where the <strong>test2</strong> instance resides.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Go to <strong>CoPilot &gt; Cloud Fabric &gt; Gateways &gt; Spoke Gateways</strong> and select the <strong><em>aws-us-east-2-spoke1</em></strong> GW. Then, click on the <strong>VPC/VNet Route Tables</strong> tab and select the following Private RTB from the <code class="docutils literal notranslate"><span class="pre">Route</span> <span class="pre">Table</span></code> field: <strong>aws-us-east-2-spoke1-Private-<span style='color:#33ECFF'>1</span></summary>-us-east-2a-rtb</strong>.</p>
</div>
<figure class="align-center" id="id6">
<img alt="../_images/lab6-spokegw.png" src="../_images/lab6-spokegw.png" />
<figcaption>
<p><span class="caption-number">Fig. 225 </span><span class="caption-text">Select the Spoke GW in US-EAST-2</span><a class="headerlink" href="#id6" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../_images/lab6-vpc.png"><img alt="../_images/lab6-vpc.png" src="../_images/lab6-vpc.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 226 </span><span class="caption-text">Check the private RTB</span><a class="headerlink" href="#id7" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>You will notice that this private RTB has its own <strong>CIDR</strong> pointing to local, the three <strong>RFC1918</strong> routes pointing to the Aviatrix Spoke Gateway (injected by the Aviatrix Controller) and a default route pointing to the AWS NAT Gateway.</p>
<p>With this scenario, the EC2 instance can reach the <strong>Internet Public Zone</strong>; however, the AWS NAT Gateway is limited and provided by the logs and flows, which might not be adequate in an Enterprise scenario. Moreover, it doesn’t provide any visibility.</p>
</section>
<section id="preliminary-connectivity-testing">
<h2>3. Preliminary Connectivity Testing<a class="headerlink" href="#preliminary-connectivity-testing" title="Link to this heading">#</a></h2>
<p>Let’s verify what traffic the instance in the private subnet is generating!</p>
<section id="preliminary-connectivity-testing-using-the-gatus-app">
<h3>3.1 Preliminary Connectivity Testing Using the Gatus App<a class="headerlink" href="#preliminary-connectivity-testing-using-the-gatus-app" title="Link to this heading">#</a></h3>
<p>Navigate to your POD Portal, locate the <code class="docutils literal notranslate"><span class="pre">Gatus</span> <span class="pre">widget</span></code>, and select both <strong><em>aws-us-east-2-spoke1-test2</em></strong>.</p>
<figure class="align-center" id="id8">
<img alt="../_images/lab6-gatus500.png" src="../_images/lab6-gatus500.png" />
<figcaption>
<p><span class="caption-number">Fig. 227 </span><span class="caption-text">aws-us-east-2-spoke1-test2</span><a class="headerlink" href="#id8" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The private workload is generating traffic to <strong>four</strong> domains:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="http://aviatrix.com">aviatrix.com</a></p></li>
<li><p><a class="reference external" href="http://www.espn.com">www.espn.com</a></p></li>
<li><p><a class="reference external" href="http://www.football.com">www.football.com</a></p></li>
<li><p><a class="reference external" href="http://www.wikipedia.org">www.wikipedia.org</a></p></li>
</ol>
<figure class="align-center" id="id9">
<a class="reference internal image-reference" href="../_images/lab6-gatus501.png"><img alt="../_images/lab6-gatus501.png" src="../_images/lab6-gatus501.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 228 </span><span class="caption-text">Egress traffic through the AWS NAT GW</span><a class="headerlink" href="#id9" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="preliminary-connectivity-testing-using-the-ssh-client-bonus">
<h3>3.2 Preliminary Connectivity Testing Using the SSH Client <span style='color:#33ECFF'>(BONUS)</span></summary><a class="headerlink" href="#preliminary-connectivity-testing-using-the-ssh-client-bonus" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>SSH to the <strong><em>aws-us-east-2-spoke1-test1</em></strong> instance from your laptop. Refer to your POD portal or alternatively, you can retrieve the Public IP from the CoPilot’s Topology.</p></li>
</ul>
<figure class="align-center" id="id10">
<a class="reference internal image-reference" href="../_images/lab6-publicip.png"><img alt="../_images/lab6-publicip.png" src="../_images/lab6-publicip.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 229 </span><span class="caption-text">SSH to aws-us-east-2-spoke1-test1</span><a class="headerlink" href="#id10" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Then from the <strong><em>aws-us-east-2-spoke1-test1</em></strong> instance SSH to the <strong><em>aws-us-east-2-spoke1-test2</em></strong> instance.</p></li>
</ul>
<figure class="align-center" id="id11">
<img alt="../_images/lab6-ssh.png" src="../_images/lab6-ssh.png" />
<figcaption>
<p><span class="caption-number">Fig. 230 </span><span class="caption-text">From test1 to test2</span><a class="headerlink" href="#id11" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Once again, the <strong><em>aws-us-east-2-spoke1-test2</em></strong> instance resides within a private subnet; therefore, you first need to SSH into a public workload that will be used as a jumphost.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Retrieve the Private IP of the <strong><em>aws-us-east-2-spoke1-test2</em></strong> from the Topology</p>
</div>
<figure class="align-center" id="id12">
<a class="reference internal image-reference" href="../_images/lab6-retrieve.png"><img alt="../_images/lab6-retrieve.png" src="../_images/lab6-retrieve.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 231 </span><span class="caption-text">Retrieve the private IP</span><a class="headerlink" href="#id12" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now, launch the following curl commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://aviatrix.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://www.espn.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://www.football.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://www.wikipedia.org
</pre></div>
</div>
<figure class="align-center" id="id13">
<a class="reference internal image-reference" href="../_images/lab6-curl.png"><img alt="../_images/lab6-curl.png" src="../_images/lab6-curl.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 232 </span><span class="caption-text">curl command-01</span><a class="headerlink" href="#id13" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id14">
<a class="reference internal image-reference" href="../_images/lab6-curl02.png"><img alt="../_images/lab6-curl02.png" src="../_images/lab6-curl02.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 233 </span><span class="caption-text">curl command-02</span><a class="headerlink" href="#id14" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id15">
<a class="reference internal image-reference" href="../_images/lab6-curl03.png"><img alt="../_images/lab6-curl03.png" src="../_images/lab6-curl03.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 234 </span><span class="caption-text">curl command-03</span><a class="headerlink" href="#id15" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id16">
<a class="reference internal image-reference" href="../_images/lab6-curl04.png"><img alt="../_images/lab6-curl04.png" src="../_images/lab6-curl04.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 235 </span><span class="caption-text">curl command-04</span><a class="headerlink" href="#id16" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="aviatrix-cloud-firewall">
<h2>4. Aviatrix Cloud Firewall<a class="headerlink" href="#aviatrix-cloud-firewall" title="Link to this heading">#</a></h2>
<section id="enable-the-secure-local-egress-control">
<h3>4.1 Enable the Secure Local Egress Control<a class="headerlink" href="#enable-the-secure-local-egress-control" title="Link to this heading">#</a></h3>
<p>Now let’s enable the egress within the VPC that is hosting the <strong><em>aws-us-east-2-spoke1-test2</em></strong> instance.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Go to <strong>CoPilot &gt; Security &gt; Egress &gt; Egress VPC/VNets</strong> and click on <code class="docutils literal notranslate"><span class="pre">&quot;Enable</span> <span class="pre">Local</span> <span class="pre">Egress</span> <span class="pre">on</span> <span class="pre">VPC/VNets&quot;</span></code>, then select the <strong><em>aws-us-east-2-spoke1</em></strong> VPC and click on <strong>Add</strong>.</p>
</div>
<figure class="align-center" id="id17">
<img alt="../_images/lab6-egress.png" src="../_images/lab6-egress.png" />
<figcaption>
<p><span class="caption-number">Fig. 236 </span><span class="caption-text">Enable Local Egress</span><a class="headerlink" href="#id17" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id18">
<img alt="../_images/lab6-vpcegress.png" src="../_images/lab6-vpcegress.png" />
<figcaption>
<p><span class="caption-number">Fig. 237 </span><span class="caption-text">Choose the correct VPC</span><a class="headerlink" href="#id18" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="inspect-the-private-rtb">
<h3>4.2 Inspect the Private RTB<a class="headerlink" href="#inspect-the-private-rtb" title="Link to this heading">#</a></h3>
<p>Upon enabling Local Egress on the specified VPC, the Aviatrix Controller will immediately execute two actions on the specified VPC:</p>
<ul class="simple">
<li><p>Injecting a <strong>Default Route</strong>: this route is added exclusively to the Private Route Tables (RTBs). Public Route Tables (RTBs) remain unaffected and will continue to have their default route pointing towards the native Cloud Service Provider (CSP) Internet Gateway (<strong>IGW</strong>).</p></li>
<li><p>Enabling <strong>Single IP SNAT</strong> on VPC Spoke Gateway: Source Network Address Translation (SNAT) will be enabled on the VPC spoke gateway using a single IP address.</p></li>
</ul>
<p>At this point, the Aviatrix  performs the same functions as the <strong>CSP NAT Gateway</strong>.</p>
<ul class="simple">
<li><p>Verify its presence in any Private RTBs inside the <strong><em>aws-us-east-2-spoke1</em></strong> VPC.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Go to <strong>CoPilot &gt; Cloud Fabric &gt; Gateways &gt; Spoke Gateways</strong> and select the <strong><em>aws-us-east-2-spoke1 GW</em></strong>, then click on the <strong>VPC/VNet Route Tables</strong> tab and then select the following Private RTB from the <code class="docutils literal notranslate"><span class="pre">Route</span> <span class="pre">Table</span></code> field: <strong>aws-us-east-2-spoke1-Private-<span style='color:#33ECFF'>1</span></summary>-us-east-2a-rtb</strong>.</p>
</div>
<figure class="align-center" id="id19">
<img alt="../_images/lab6-defaultroute.png" src="../_images/lab6-defaultroute.png" />
<figcaption>
<p><span class="caption-number">Fig. 238 </span><span class="caption-text">Default route has been injected</span><a class="headerlink" href="#id19" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Default</span> <span class="pre">Route</span></code> is now pointing to the Aviatrix Spoke Gateway.</p>
</div>
</section>
<section id="enable-dcf">
<h3>4.3 Enable DCF<a class="headerlink" href="#enable-dcf" title="Link to this heading">#</a></h3>
<p>You have successfully activated your <code class="docutils literal notranslate"><span class="pre">Aviatrix</span> <span class="pre">Cloud</span> <span class="pre">Firewall</span></code> without disrupting any resources on the private subnet. However, to obtain NetFlow information, you need to apply a <code class="docutils literal notranslate"><span class="pre">Distributed</span> <span class="pre">Cloud</span> <span class="pre">Firewall</span> <span class="pre">Rule</span></code>. This will allow you to evaluate the behavior of the private subnet and gain insights into which domains have been accessed from it.</p>
<ul class="simple">
<li><p>Enable the <strong>Distributed Cloud Firewall</strong>.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Navigate to <strong>CoPilot &gt; Security &gt; Distributed Cloud Firewall &gt; Rules</strong> and click on <code class="docutils literal notranslate"><span class="pre">&quot;Enable</span> <span class="pre">Distributed</span> <span class="pre">Cloud</span> <span class="pre">Firewall&quot;</span></code>.
Then, click on <code class="docutils literal notranslate"><span class="pre">&quot;Begin</span> <span class="pre">using</span> <span class="pre">Distributed</span> <span class="pre">Cloud</span> <span class="pre">Firewall&quot;</span></code> followed by <code class="docutils literal notranslate"><span class="pre">&quot;Begin&quot;</span></code>.</p>
</div>
<figure class="align-center" id="id20">
<img alt="../_images/lab6-activate.png" src="../_images/lab6-activate.png" />
<figcaption>
<p><span class="caption-number">Fig. 239 </span><span class="caption-text">Enable Distributed Cloud Firewall</span><a class="headerlink" href="#id20" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id21">
<img alt="../_images/lab6-newjoe.png" src="../_images/lab6-newjoe.png" />
<figcaption>
<p><span class="caption-number">Fig. 240 </span><span class="caption-text">Begin using Distributed Cloud Firewall</span><a class="headerlink" href="#id21" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id22">
<img alt="../_images/lab6-newjoe2.png" src="../_images/lab6-newjoe2.png" />
<figcaption>
<p><span class="caption-number">Fig. 241 </span><span class="caption-text">Begin</span><a class="headerlink" href="#id22" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>After enabling the DCF, two rules will be generated automatically:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Greendfield-Rule</span></code> = ALLOW EVERYTHING</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DefaultDenyAll</span></code> = it’s an EXPLICIT deny</p></li>
</ul>
<p>The first rule essentially allows all kind of traffic.</p>
<figure class="align-center" id="id23">
<a class="reference internal image-reference" href="../_images/lab6-greenfield.png"><img alt="../_images/lab6-greenfield.png" src="../_images/lab6-greenfield.png" style="height: 150px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 242 </span><span class="caption-text">Automatic rules injected by the Controller</span><a class="headerlink" href="#id23" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="define-a-new-smartgroup">
<h2>5. Define a new SmartGroup<a class="headerlink" href="#define-a-new-smartgroup" title="Link to this heading">#</a></h2>
<p>At this point, you can use the <strong>SmartGroup</strong> feature to identify the test2 instance.</p>
<section id="identify-the-subnet-where-the-private-workload-resides">
<h3>5.1 Identify the subnet where the private workload resides<a class="headerlink" href="#identify-the-subnet-where-the-private-workload-resides" title="Link to this heading">#</a></h3>
<p>First and foremost, you have to identify the <strong>public subnet</strong> where the <strong><em>aws-us-east-2-spoke1-test2</em></strong> instance resides.</p>
<figure class="align-center" id="id24">
<a class="reference internal image-reference" href="../_images/lab6-greenfieldneww.png"><img alt="../_images/lab6-greenfieldneww.png" src="../_images/lab6-greenfieldneww.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 243 </span><span class="caption-text">Private Subnet</span><a class="headerlink" href="#id24" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Go to <strong>CoPilot &gt; Cloud Resources &gt; Cloud Assets &gt; Virtual Machines</strong> and search for the <strong><em>aws-us-east-2-spoke1-test2</em></strong> instance in the search field on the right-hand side.</p>
<p>From the results, you need to identify the <code class="docutils literal notranslate"><span class="pre">Availability</span> <span class="pre">Zone</span></code>.</p>
<figure class="align-center" id="id25">
<a class="reference internal image-reference" href="../_images/lab6-greenfieldneww2.png"><img alt="../_images/lab6-greenfieldneww2.png" src="../_images/lab6-greenfieldneww2.png" style="height: 150px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 244 </span><span class="caption-text">AZ</span><a class="headerlink" href="#id25" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now that you know in which <code class="docutils literal notranslate"><span class="pre">Availability</span> <span class="pre">Zone</span></code> the private workload resides, you need to select the <code class="docutils literal notranslate"><span class="pre">VPC/VNets</span> <span class="pre">&amp;</span> <span class="pre">Subnets</span></code> tab and filter based on the <strong><em>aws-us-east-2-spoke1</em></strong> VPC.</p>
<p>Identify the <code class="docutils literal notranslate"><span class="pre">Private</span> <span class="pre">Subnet</span></code> that belongs to the <code class="docutils literal notranslate"><span class="pre">us-east-2a</span></code> AZ and copy the corresponding <strong><em><code class="docutils literal notranslate"><span class="pre">IP</span> <span class="pre">Address</span> <span class="pre">CIDR</span></code></em></strong> value!</p>
<figure class="align-center" id="id26">
<a class="reference internal image-reference" href="../_images/lab6-greenfieldneww3.png"><img alt="../_images/lab6-greenfieldneww3.png" src="../_images/lab6-greenfieldneww3.png" style="height: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 245 </span><span class="caption-text">Private Subnet</span><a class="headerlink" href="#id26" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="create-an-ad-hoc-smartgroup">
<h3>5.2 Create an ad-hoc SmartGroup<a class="headerlink" href="#create-an-ad-hoc-smartgroup" title="Link to this heading">#</a></h3>
<p>Go to <strong>CoPilot &gt; Groups</strong> and click on the <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">SmartGroup&quot;</span></code> button.</p>
<figure class="align-center" id="id27">
<a class="reference internal image-reference" href="../_images/lab6-newsg.png"><img alt="../_images/lab6-newsg.png" src="../_images/lab6-newsg.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 246 </span><span class="caption-text">SmartGroup</span><a class="headerlink" href="#id27" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now, click on the arrow icon  inside the <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">Resource</span> <span class="pre">Type&quot;</span></code> button and select <code class="docutils literal notranslate"><span class="pre">&quot;IP</span> <span class="pre">/</span> <span class="pre">CIDRs&quot;</span></code>.</p>
<figure class="align-center" id="id28">
<a class="reference internal image-reference" href="../_images/lab6-greenfieldneww4.png"><img alt="../_images/lab6-greenfieldneww4.png" src="../_images/lab6-greenfieldneww4.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 247 </span><span class="caption-text">Private Subnet</span><a class="headerlink" href="#id28" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure these parameters are entered in the pop-up window <code class="docutils literal notranslate"><span class="pre">&quot;Create</span> <span class="pre">SmartGroup&quot;</span></code>:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>us-east-2-private-subnet</span></p></li>
<li><p><strong>IPs / CIDRs</strong>: <span style='color:#479608'>10.0.1.0/27</span></p></li>
</ul>
<p>Before clicking on <strong>SAVE</strong>, delete the empty <code class="docutils literal notranslate"><span class="pre">&quot;Virtual</span> <span class="pre">Machines&quot;</span></code> additional condition.</p>
<figure class="align-center" id="id29">
<a class="reference internal image-reference" href="../_images/lab6-greenfieldneww45.png"><img alt="../_images/lab6-greenfieldneww45.png" src="../_images/lab6-greenfieldneww45.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 248 </span><span class="caption-text">New SG</span><a class="headerlink" href="#id29" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="create-a-new-dcf-rule">
<h2>6. Create a new DCF Rule<a class="headerlink" href="#create-a-new-dcf-rule" title="Link to this heading">#</a></h2>
<p>Go to <strong>CoPilot &gt; Security &gt; Distributed Cloud Firewall &gt; Rules (default tab)</strong> and create a new rule clicking on the <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">Rule&quot;</span></code> button.</p>
<figure class="align-center" id="id30">
<img alt="../_images/lab6-newrule10.png" src="../_images/lab6-newrule10.png" />
<figcaption>
<p><span class="caption-number">Fig. 249 </span><span class="caption-text">New Rule</span><a class="headerlink" href="#id30" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Insert the following parameters:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>Egress-Rule</span></p></li>
<li><p><strong>Source Smartgroups</strong>: <span style='color:#479608'>us-east-2-private-subnet</span></p></li>
<li><p><strong>Destination Smartgroups</strong>: <span style='color:#479608'>Public Internet</span></p></li>
<li><p><strong>WebGroups</strong>: <span style='color:#479608'><strong>All-Web</strong></span></p></li>
<li><p><strong>Protocol</strong>: <span style='color:#479608'>Any</span></p></li>
<li><p><strong>Logging</strong>: <span style='color:#479608'><strong>On</strong></span></p></li>
<li><p><strong>Action</strong>: <span style='color:#479608'>Permit</span></p></li>
</ul>
<p>Do not forget to click on <strong>Save In Drafts</strong>.</p>
<figure class="align-center" id="id31">
<img alt="../_images/lab6-new.png" src="../_images/lab6-new.png" />
<figcaption>
<p><span class="caption-number">Fig. 250 </span><span class="caption-text">Saving the new Rule</span><a class="headerlink" href="#id31" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><code class="docutils literal notranslate"><span class="pre">All-Web</span></code> <em>WebGroup</em> = this is an “allow-all” WebGroup that you must select in a Distributed Cloud Firewall rule if you do not want to limit the Internet-bound traffic for that rule, but you still want to log the FQDNs that are being accessed.</p>
<p>Ultimately , this Webgroup will limit Internet traffic solely for <strong>HTTP</strong> and <strong>HTTPS</strong> protocols.</p>
</div>
<p>Click on the <strong>Commit</strong> button, and the rule previously created will be enfored in to the <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Path</span></code>..</p>
<figure class="align-center" id="id32">
<a class="reference internal image-reference" href="../_images/lab6-newrule11.png"><img alt="../_images/lab6-newrule11.png" src="../_images/lab6-newrule11.png" style="height: 250px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 251 </span><span class="caption-text">Egress-Rule</span><a class="headerlink" href="#id32" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DefaultDenyAll</span></code> rule injected by the Aviatrix Controller is by default <ins>not editable</ins>.</p>
</div>
<figure class="align-center" id="id33">
<img alt="../_images/lab6-new010.png" src="../_images/lab6-new010.png" />
<figcaption>
<p><span class="caption-number">Fig. 252 </span><span class="caption-text">Not Editable</span><a class="headerlink" href="#id33" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Now Create an Explicit Deny rule that is <strong>editable</strong>:</p></li>
</ul>
<p>Click on the <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">Rule&quot;</span></code> button.</p>
<figure class="align-center" id="id34">
<img alt="../_images/lab6-newrule100.png" src="../_images/lab6-newrule100.png" />
<figcaption>
<p><span class="caption-number">Fig. 253 </span><span class="caption-text">New Rule</span><a class="headerlink" href="#id34" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Insert the following parameters:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>ExplicitDenyAll</span></p></li>
<li><p><strong>Source Smartgroups</strong>: <span style='color:#479608'>Anywhere(0.0.0.0/0)</span></p></li>
<li><p><strong>Destination Smartgroups</strong>: <span style='color:#479608'>Anywhere(0.0.0.0/0)</span></p></li>
<li><p><strong>Protocol</strong>: <span style='color:#479608'>Any</span></p></li>
<li><p><strong>Logging</strong>: <span style='color:#479608'>On</span></p></li>
<li><p><strong>Action</strong>: <span style='color:#479608'><strong>Deny</strong></span></p></li>
<li><p><strong>Place Rule</strong>: <span style='color:#479608'>Below</span></p>
<ul>
<li><p><strong>Existing Rule</strong>: <span style='color:#479608'>Egress-Rule</span></p></li>
</ul>
</li>
</ul>
<p>Do not forget to click on <strong>Save In Drafts</strong>.</p>
<figure class="align-center" id="id35">
<img alt="../_images/lab6-newrule1001.png" src="../_images/lab6-newrule1001.png" />
<figcaption>
<p><span class="caption-number">Fig. 254 </span><span class="caption-text">ExplicitDenyAll</span><a class="headerlink" href="#id35" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Do not forget to click on <strong>Commit</strong>.</p>
<figure class="align-center" id="id36">
<img alt="../_images/lab6-newrule10011.png" src="../_images/lab6-newrule10011.png" />
<figcaption>
<p><span class="caption-number">Fig. 255 </span><span class="caption-text">Commit</span><a class="headerlink" href="#id36" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="connectivity-testing-after-enabling-the-aviatrix-cloud-firewall">
<h2>7. Connectivity Testing after enabling the Aviatrix Cloud Firewall<a class="headerlink" href="#connectivity-testing-after-enabling-the-aviatrix-cloud-firewall" title="Link to this heading">#</a></h2>
<p>Let’s verify how the TCP traffic generated by the Gatus got affected by the activation of the Aviatrix Cloud Firewall.</p>
<section id="connectivity-testing-using-the-gatus-app">
<h3>7.1 Connectivity Testing Using the Gatus App<a class="headerlink" href="#connectivity-testing-using-the-gatus-app" title="Link to this heading">#</a></h3>
<p>Navigate to your POD Portal, locate the <code class="docutils literal notranslate"><span class="pre">Gatus</span> <span class="pre">widget</span></code>, and select both <strong><em>aws-us-east-2-spoke1-test2</em></strong>.</p>
<figure class="align-center" id="id37">
<a class="reference internal image-reference" href="../_images/lab6-gatus500.png"><img alt="../_images/lab6-gatus500.png" src="../_images/lab6-gatus500.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 256 </span><span class="caption-text">aws-us-east-2-spoke1-test2</span><a class="headerlink" href="#id37" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The private workload is still generating traffic to those four domains.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you want to expedite the results on the Gatus dashboard, feel free to adjust the timeout to <strong>10 seconds</strong> in the bottom left-hand corner.</p>
</div>
<figure class="align-center" id="id38">
<a class="reference internal image-reference" href="../_images/lab6-gatus5012.png"><img alt="../_images/lab6-gatus5012.png" src="../_images/lab6-gatus5012.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 257 </span><span class="caption-text">Egress traffic is now going through the Aviatrix Cloud Firewall embedded on the Spoke GW</span><a class="headerlink" href="#id38" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>On the other hand, the ICMP traffic tests will gradually start to fail, with the exception of the test directed towards <strong>aws-us-east-2-spoke1-test1</strong>. This exception is due to the intra-VPC traffic.</p>
<figure class="align-center" id="id39">
<a class="reference internal image-reference" href="../_images/lab6-gatuslab501.png"><img alt="../_images/lab6-gatuslab501.png" src="../_images/lab6-gatuslab501.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 258 </span><span class="caption-text">ICMP is ok only with aws-us-east-2-spoke1-test1</span><a class="headerlink" href="#id39" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="connectivity-testing-using-the-ssh-client-bonus">
<h3>7.2 Connectivity Testing Using the SSH Client <span style='color:#33ECFF'>(BONUS)</span></summary><a class="headerlink" href="#connectivity-testing-using-the-ssh-client-bonus" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>From your SSH client opened on the <strong><em>aws-us-east-2-spoke1-test1</em></strong> instance, launch again the following curl commands:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://aviatrix.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://www.espn.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://www.football.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://www.wikipedia.org
</pre></div>
</div>
<figure class="align-center" id="id40">
<a class="reference internal image-reference" href="../_images/lab6-curl.png"><img alt="../_images/lab6-curl.png" src="../_images/lab6-curl.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 259 </span><span class="caption-text">curl command-01</span><a class="headerlink" href="#id40" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id41">
<a class="reference internal image-reference" href="../_images/lab6-curl02.png"><img alt="../_images/lab6-curl02.png" src="../_images/lab6-curl02.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 260 </span><span class="caption-text">curl command-02</span><a class="headerlink" href="#id41" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id42">
<a class="reference internal image-reference" href="../_images/lab6-curl03.png"><img alt="../_images/lab6-curl03.png" src="../_images/lab6-curl03.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 261 </span><span class="caption-text">curl command-03</span><a class="headerlink" href="#id42" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id43">
<a class="reference internal image-reference" href="../_images/lab6-curl04.png"><img alt="../_images/lab6-curl04.png" src="../_images/lab6-curl04.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 262 </span><span class="caption-text">curl command-04</span><a class="headerlink" href="#id43" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="egress-overview">
<h3>7.3 Egress Overview<a class="headerlink" href="#egress-overview" title="Link to this heading">#</a></h3>
<p>Go to <strong>CoPilot &gt; Security &gt; Egress &gt; Overview</strong>, and you will see the visibility of the domain hits.</p>
<figure class="align-center" id="id44">
<a class="reference internal image-reference" href="../_images/lab6-newrul12.png"><img alt="../_images/lab6-newrul12.png" src="../_images/lab6-newrul12.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 263 </span><span class="caption-text">Overview</span><a class="headerlink" href="#id44" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>You now have complete <strong>Egress observability</strong>, along with a full list of domains accessed by the EC2 instance within that private subnet.</p>
<p>Furthermore, go to <strong>CoPilot &gt; Security &gt; Egress &gt; FQDN Monitor (Legacy)</strong> and from the <code class="docutils literal notranslate"><span class="pre">&quot;VPC/VNets&quot;</span></code> drop-down window, select the <strong><em>aws-us-east-2-spoke1 VPC</em></strong>.</p>
<figure class="align-center" id="id45">
<a class="reference internal image-reference" href="../_images/lab6-monitor.png"><img alt="../_images/lab6-monitor.png" src="../_images/lab6-monitor.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 264 </span><span class="caption-text">Monitor</span><a class="headerlink" href="#id45" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>You will get a granular Layer 7 visibility that allows you to get a good understanding of how the egress traffic has been consumed and also allows you to help make decisions on how to potentially optimize that.</p>
</section>
</section>
<section id="ztna-zero-trust-network-access">
<h2>8. ZTNA - Zero Trust Network Access<a class="headerlink" href="#ztna-zero-trust-network-access" title="Link to this heading">#</a></h2>
<p>Now we have enabled the <code class="docutils literal notranslate"><span class="pre">Zero</span> <span class="pre">Trust</span> <span class="pre">Network</span> <span class="pre">Access</span></code> approach, denying everything at the very bottom of the DCF rules list.</p>
<section id="create-a-new-webgroup">
<h3>8.1 Create a New WebGroup<a class="headerlink" href="#create-a-new-webgroup" title="Link to this heading">#</a></h3>
<p>Let’s move towards a posture where only specific egress domains are in place.</p>
<p>Go to <strong>CoPilot &gt; Groups &gt; WebGroups</strong> and click on <code class="docutils literal notranslate"><span class="pre">&quot;+</span> <span class="pre">WebGroup&quot;</span></code> button.</p>
<figure class="align-center" id="id46">
<img alt="../_images/lab6-webgroup.png" src="../_images/lab6-webgroup.png" />
<figcaption>
<p><span class="caption-number">Fig. 265 </span><span class="caption-text">+WebGroup</span><a class="headerlink" href="#id46" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Create a <strong><em>WebGroup</em></strong> with the following parameters:</p>
<ul class="simple">
<li><p><strong>Name</strong>: <span style='color:#479608'>two-domains</span></p></li>
<li><p><strong>Type</strong>: <span style='color:#479608'>Domains</span></p></li>
<li><p><strong>Domains/URLs</strong>: <span style='color:#479608'>aviatrix.com</span></p></li>
<li><p><strong>Domains/URLs</strong>: <span style='color:#479608'><a class="reference external" href="http://www.wikipedia.org">www.wikipedia.org</a></span></p></li>
</ul>
<p>Do not forget to click on <strong>Save</strong>.</p>
<figure class="align-center" id="id47">
<img alt="../_images/lab6-webgroup2.png" src="../_images/lab6-webgroup2.png" />
<figcaption>
<p><span class="caption-number">Fig. 266 </span><span class="caption-text">WebGroup creation</span><a class="headerlink" href="#id47" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The purpose of this <strong>WebGroup</strong> is to permit traffic exclusively to the domains <em><code class="docutils literal notranslate"><span class="pre">aviatrix.com</span></code></em> and <em><code class="docutils literal notranslate"><span class="pre">www.wikipedia.org</span></code></em>.org. Consequently, any curl commands directed at other domains will be blocked.”</p>
</div>
</section>
<section id="edit-the-egress-rule">
<h3>8.2 Edit the Egress-Rule<a class="headerlink" href="#edit-the-egress-rule" title="Link to this heading">#</a></h3>
<p>Go to <strong>CoPilot &gt; Security &gt; Distributed Cloud Firewall &gt; Rules</strong>, click on the <strong>pencil</strong> button on the right-hand side of the <code class="docutils literal notranslate"><span class="pre">Egress-Rule</span></code>.</p>
<figure class="align-center" id="id48">
<img alt="../_images/lab6-webgroup2346.png" src="../_images/lab6-webgroup2346.png" />
<figcaption>
<p><span class="caption-number">Fig. 267 </span><span class="caption-text">Pencil icon</span><a class="headerlink" href="#id48" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Now remove the WebGroup <code class="docutils literal notranslate"><span class="pre">&quot;All-Web&quot;</span></code> and then select the WebGroup <code class="docutils literal notranslate"><span class="pre">&quot;two-domains&quot;</span></code>.</p></li>
</ul>
<p>Do not forget to click on <strong>Save In Drafts</strong> and then <strong>Commit</strong> your changes!</p>
<figure class="align-center" id="id49">
<img alt="../_images/lab6-webgroup234.png" src="../_images/lab6-webgroup234.png" />
<figcaption>
<p><span class="caption-number">Fig. 268 </span><span class="caption-text">Editing the Egress-Rule</span><a class="headerlink" href="#id49" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id50">
<a class="reference internal image-reference" href="../_images/lab6-webgroup2345.png"><img alt="../_images/lab6-webgroup2345.png" src="../_images/lab6-webgroup2345.png" style="height: 200px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 269 </span><span class="caption-text">Commit the changes</span><a class="headerlink" href="#id50" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p><strong>Anywhere (0.0.0.0/0)</strong> = Represents all CIDR ranges or IP addresses.</p></li>
<li><p><strong>Publlic Internet</strong> = Represents non-RFC 1918 IP ranges, or the public Internet</p></li>
</ul>
</div>
</section>
<section id="id1">
<h3>8.3 Connectivity Testing after enabling the Aviatrix Cloud Firewall<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Let’s verify if the Egress Rule is now effectively dropping the traffic to both <strong><em><a class="reference external" href="http://www.espn.com">www.espn.com</a></em></strong> and <strong><em><a class="reference external" href="http://www.football.com">www.football.com</a></em></strong>.</p>
<section id="id2">
<h4>8.3.1 Connectivity Testing Using the Gatus App<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<p>Navigate to your POD Portal, locate the <code class="docutils literal notranslate"><span class="pre">Gatus</span> <span class="pre">widget</span></code>, and select both <strong><em>aws-us-east-2-spoke1-test2</em></strong>.</p>
<figure class="align-center" id="id51">
<a class="reference internal image-reference" href="../_images/lab6-gatus500.png"><img alt="../_images/lab6-gatus500.png" src="../_images/lab6-gatus500.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 270 </span><span class="caption-text">aws-us-east-2-spoke1-test2</span><a class="headerlink" href="#id51" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>You will gradually notice that the TCP traffic to <strong><em><a class="reference external" href="http://www.espn.com">www.espn.com</a></em></strong> and <strong><em><a class="reference external" href="http://www.football.com">www.football.com</a></em></strong> will start being blocked, which will cause it to turn red.</p>
<figure class="align-center" id="id52">
<a class="reference internal image-reference" href="../_images/lab6-gatus555.png"><img alt="../_images/lab6-gatus555.png" src="../_images/lab6-gatus555.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 271 </span><span class="caption-text">aws-us-east-2-spoke1-test2</span><a class="headerlink" href="#id52" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="id3">
<h4>8.3.2 Connectivity Testing Using the SSH Client <span style='color:#33ECFF'>(BONUS)</span></summary><a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Re-launch the following curl commands from the SSH session opened with the <strong><em>aws-us-east-2-spoke1-test1</em></strong> instance:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://aviatrix.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://www.espn.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://www.football.com
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>https://www.wikipedia.org
</pre></div>
</div>
<figure class="align-center" id="id53">
<a class="reference internal image-reference" href="../_images/lab6-curl.png"><img alt="../_images/lab6-curl.png" src="../_images/lab6-curl.png" style="height: 450px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 272 </span><span class="caption-text">curl command-01</span><a class="headerlink" href="#id53" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id54">
<img alt="../_images/lab6-curl021.png" src="../_images/lab6-curl021.png" />
<figcaption>
<p><span class="caption-number">Fig. 273 </span><span class="caption-text">curl command-02</span><a class="headerlink" href="#id54" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id55">
<img alt="../_images/lab6-curl031.png" src="../_images/lab6-curl031.png" />
<figcaption>
<p><span class="caption-number">Fig. 274 </span><span class="caption-text">curl command-03</span><a class="headerlink" href="#id55" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id56">
<a class="reference internal image-reference" href="../_images/lab6-curl04.png"><img alt="../_images/lab6-curl04.png" src="../_images/lab6-curl04.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 275 </span><span class="caption-text">curl command-04</span><a class="headerlink" href="#id56" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
</section>
<section id="monitor">
<h2>9. Monitor<a class="headerlink" href="#monitor" title="Link to this heading">#</a></h2>
<p>Navigate to <strong>CoPilot &gt; Security &gt; Egress &gt; FQDN Monitor (Legacy)</strong> and from the <code class="docutils literal notranslate"><span class="pre">&quot;VPC/VNets&quot;</span></code> drop-down window, select the <strong><em>aws-us-east-2-spoke1 VPC</em></strong>.</p>
<p>Enter the word <strong>“denied”</strong> in the <code class="docutils literal notranslate"><span class="pre">Search</span></code> field to identify the domains that were blocked after attaching the WebGroup <code class="docutils literal notranslate"><span class="pre">two-domains</span></code> to the rule named <code class="docutils literal notranslate"><span class="pre">Egress-Rule</span></code>.</p>
<figure class="align-center" id="id57">
<a class="reference internal image-reference" href="../_images/lab6-monitor989.png"><img alt="../_images/lab6-monitor989.png" src="../_images/lab6-monitor989.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 276 </span><span class="caption-text">Action Denied</span><a class="headerlink" href="#id57" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="remotion-of-the-aws-nat-gateway">
<h2>10. Remotion of the AWS NAT Gateway<a class="headerlink" href="#remotion-of-the-aws-nat-gateway" title="Link to this heading">#</a></h2>
<p>Now that you have successfully enabled the <code class="docutils literal notranslate"><span class="pre">Aviatrix</span> <span class="pre">Cloud</span> <span class="pre">Firewall</span></code>, you can get rid of the AWS NAT Gateway.</p>
<section id="aws-console">
<h3>10.1 AWS Console<a class="headerlink" href="#aws-console" title="Link to this heading">#</a></h3>
<p>Login to <strong>AWS console</strong></a>. Refer to your pod info for login information (<ins>Please always refer to your personal POD Portal</ins>).</p>
<figure class="align-center" id="id58">
<img alt="../_images/lab5-deleteaws.png" src="../_images/lab5-deleteaws.png" />
<figcaption>
<p><span class="caption-number">Fig. 277 </span><span class="caption-text">AWS NAT GW</span><a class="headerlink" href="#id58" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id59">
<img alt="../_images/lab5-newone.png" src="../_images/lab5-newone.png" />
<figcaption>
<p><span class="caption-number">Fig. 278 </span><span class="caption-text">AWS URL and credentials</span><a class="headerlink" href="#id59" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id60">
<img alt="../_images/lab5-awsconsole.png" src="../_images/lab5-awsconsole.png" />
<figcaption>
<p><span class="caption-number">Fig. 279 </span><span class="caption-text">AWS console</span><a class="headerlink" href="#id60" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Change the region to <strong>Ohio</strong> and invoke <strong>VPC</strong> service.</p>
<figure class="align-center" id="id61">
<a class="reference internal image-reference" href="../_images/lab5-region22.png"><img alt="../_images/lab5-region22.png" src="../_images/lab5-region22.png" style="height: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 280 </span><span class="caption-text">Change the Region</span><a class="headerlink" href="#id61" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id62">
<a class="reference internal image-reference" href="../_images/lab5-region01.png"><img alt="../_images/lab5-region01.png" src="../_images/lab5-region01.png" style="height: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 281 </span><span class="caption-text">Invoke the VPC service</span><a class="headerlink" href="#id62" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now click on the <code class="docutils literal notranslate"><span class="pre">NAT</span> <span class="pre">Gateways</span></code> section in the Navigation Panel on the right-hand side.</p>
<figure class="align-center" id="id63">
<a class="reference internal image-reference" href="../_images/lab5-region012.png"><img alt="../_images/lab5-region012.png" src="../_images/lab5-region012.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 282 </span><span class="caption-text">NAT gateways section</span><a class="headerlink" href="#id63" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Select the <strong><em>aws-region-2-spoke1-nat</em></strong> NAT Gateway, then click on thwe <code class="docutils literal notranslate"><span class="pre">&quot;Actions&quot;</span></code> button on the right-hand side and choose the option <code class="docutils literal notranslate"><span class="pre">&quot;Delete</span> <span class="pre">NAT</span> <span class="pre">gateway&quot;</span></code>. Afterwards, type <code class="docutils literal notranslate"><span class="pre">&quot;delete&quot;</span></code> to confirm the deletion of the AWS NAT Gateway and click on <strong>Delete</strong>.</p></li>
</ul>
<figure class="align-center" id="id64">
<a class="reference internal image-reference" href="../_images/lab5-region99.png"><img alt="../_images/lab5-region99.png" src="../_images/lab5-region99.png" style="height: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 283 </span><span class="caption-text">Selection of the AWS NAT GW</span><a class="headerlink" href="#id64" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id65">
<a class="reference internal image-reference" href="../_images/lab5-region9991.png"><img alt="../_images/lab5-region9991.png" src="../_images/lab5-region9991.png" style="height: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 284 </span><span class="caption-text">Actions</span><a class="headerlink" href="#id65" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id66">
<a class="reference internal image-reference" href="../_images/lab5-region999.png"><img alt="../_images/lab5-region999.png" src="../_images/lab5-region999.png" style="height: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 285 </span><span class="caption-text">Deletion of the AWS NAT GW</span><a class="headerlink" href="#id66" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>After completing this lab, the overall topology will appear as follows:</p>
<figure class="align-center" id="id67">
<a class="reference internal image-reference" href="../_images/lab6-finaltopo.png"><img alt="../_images/lab6-finaltopo.png" src="../_images/lab6-finaltopo.png" style="height: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 286 </span><span class="caption-text">Final Topology for Lab 5</span><a class="headerlink" href="#id67" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>At the end of this lab <ins>the <strong>East-West traffic</strong> wll be blocked</ins>, due to the current configuration of the Distributed Cloud Firewall!</p>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lab4.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab 4 - HPE WITH ACTIVE MESH</p>
      </div>
    </a>
    <a class="right-next"
       href="lab6.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab 6 - FIRENET</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objective">1. Objective</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#topology">2. Topology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-connectivity-testing">3. Preliminary Connectivity Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-connectivity-testing-using-the-gatus-app">3.1 Preliminary Connectivity Testing Using the Gatus App</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-connectivity-testing-using-the-ssh-client-bonus">3.2 Preliminary Connectivity Testing Using the SSH Client <span style="color:#33ECFF">(BONUS)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aviatrix-cloud-firewall">4. Aviatrix Cloud Firewall</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enable-the-secure-local-egress-control">4.1 Enable the Secure Local Egress Control</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-the-private-rtb">4.2 Inspect the Private RTB</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enable-dcf">4.3 Enable DCF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-new-smartgroup">5. Define a new SmartGroup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-the-subnet-where-the-private-workload-resides">5.1 Identify the subnet where the private workload resides</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-an-ad-hoc-smartgroup">5.2 Create an ad-hoc SmartGroup</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-dcf-rule">6. Create a new DCF Rule</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#connectivity-testing-after-enabling-the-aviatrix-cloud-firewall">7. Connectivity Testing after enabling the Aviatrix Cloud Firewall</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#connectivity-testing-using-the-gatus-app">7.1 Connectivity Testing Using the Gatus App</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#connectivity-testing-using-the-ssh-client-bonus">7.2 Connectivity Testing Using the SSH Client <span style="color:#33ECFF">(BONUS)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#egress-overview">7.3 Egress Overview</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ztna-zero-trust-network-access">8. ZTNA - Zero Trust Network Access</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-webgroup">8.1 Create a New WebGroup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-the-egress-rule">8.2 Edit the Egress-Rule</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">8.3 Connectivity Testing after enabling the Aviatrix Cloud Firewall</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">8.3.1 Connectivity Testing Using the Gatus App</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">8.3.2 Connectivity Testing Using the SSH Client <span style="color:#33ECFF">(BONUS)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monitor">9. Monitor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remotion-of-the-aws-nat-gateway">10. Remotion of the AWS NAT Gateway</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aws-console">10.1 AWS Console</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aviatrix ACE
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>